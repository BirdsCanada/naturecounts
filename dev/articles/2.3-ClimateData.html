<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 3 - Climate Data • naturecounts</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Chapter 3 - Climate Data">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">naturecounts</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.4.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/1.1-Introduction.html">Chapter 1 - Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/1.2-LoadPackage.html">Chapter 2 - Loading R Packages</a></li>
    <li><a class="dropdown-item" href="../articles/1.3-ViewData.html">Chapter 3 - Understanding and Viewing Data</a></li>
    <li><a class="dropdown-item" href="../articles/1.4-DownloadData.html">Chapter 4 - Downloading and Filtering Data</a></li>
    <li><a class="dropdown-item" href="../articles/1.5-ManipData.html">Chapter 5 - Data Manipulation</a></li>
    <li><a class="dropdown-item" href="../articles/1.6-VisualData.html">Chapter 6 - Data Visualization</a></li>
    <li><a class="dropdown-item" href="../articles/1.7-Answers.html">Chapter 7 - Answers</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BirdsCanada/naturecounts/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Chapter 3 - Climate Data</h1>
            
            <h4 data-toc-skip class="date">2024-11-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/BirdsCanada/naturecounts/blob/docs-update/vignettes/articles/2.3-ClimateData.Rmd" class="external-link"><code>vignettes/articles/2.3-ClimateData.Rmd</code></a></small>
      <div class="d-none name"><code>2.3-ClimateData.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="chapter-3-climate-data">Chapter 3: Climate Data<a class="anchor" aria-label="anchor" href="#chapter-3-climate-data"></a>
</h2>
<div class="section level6">
<h6 id="authors-dimitrios-markou-danielle-ethier">Authors: Dimitrios Markou, Danielle Ethier<a class="anchor" aria-label="anchor" href="#authors-dimitrios-markou-danielle-ethier"></a>
</h6>
<div class="line-block">In <a href="02-SpatialSubsets.Rmd">Chapter
2</a>, you applied geoprocessing functions to spatial (vector) objects,
and filtered and visualized NatureCounts data within KBAs and Priority
Places. Now you are ready to explore your NatureCounts data in relation
to environmental covariates. In this tutorial, you will use NatureCounts
and climate data to explore possible patterns in Whooping Crane
observations, annual mean temperature, and annual mean precipitation
within the Wood Buffalo National Park, the province of Alberta, and
beyond.</div>
</div>
</div>
<div class="section level2">
<h2 id="learning-objectives">3.0 Learning Objectives<a class="anchor" aria-label="anchor" href="#learning-objectives"></a>
</h2>
<p>By the end of <strong>Chapter 3 - Climate Data</strong>, users will
know how to:</p>
<ul>
<li>Download and preprocess vector and raster climate data</li>
<li>Combine NatureCounts observations with climate data</li>
<li>Visualize NatureCounts and climate data using plots and
spatio-temporal maps</li>
</ul>
<p>This tutorial utilizes the following bird occurrence, spatial, and
climate data sources:</p>
<table class="table">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th>Data</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><a href="https://naturecounts.ca/nc/default/datasets.jsp?code=EBIRD-CA-PR" class="external-link">eBird
Canada (Prairies)</a></td>
<td>NatureCounts, EBIRD-CA-PR (1800-2024)</td>
</tr>
<tr class="even">
<td>Alberta Breeding Bird Atlas</td>
<td>NatureCounts, ABATLAS1 (<a href="https://naturecounts.ca/nc/default/datasets.jsp?code=ABATLAS1" class="external-link">1987-1992</a>)
and ABATLAS2 (<a href="https://naturecounts.ca/nc/default/datasets.jsp?code=ABATLAS2" class="external-link">2000-2005</a>)</td>
</tr>
<tr class="odd">
<td><a href="https://naturecounts.ca/nc/default/datasets.jsp?code=ABBIRDRECS" class="external-link">Alberta
Bird Records</a></td>
<td>NatureCounts, ABIRDRECS (1941-2006)</td>
</tr>
<tr class="even">
<td><a href="https://kbacanada.org/site/?SiteCode=NT002" class="external-link">Whooping Crane
Nesting Area and Summer Range</a></td>
<td>Key Biodiversity Area boundary (<strong>.shp</strong>) and site
attributes</td>
</tr>
<tr class="odd">
<td><a href="https://climate.weather.gc.ca/historical_data/search_historic_data_e.html" class="external-link">Environment
and Climate Change Canada</a></td>
<td>Historical (vector) weather data, accessed through the
<code>weathercan</code> R package</td>
</tr>
<tr class="even">
<td><a href="https://www.worldclim.org/data/bioclim.html" class="external-link">WorldClim</a></td>
<td>Historical (raster) climate data. Includes nineteen bioclimatic
variables representing the 1970-2000 average</td>
</tr>
</tbody>
</table>
<p>This tutorial requires the following <strong>packages</strong>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/BirdsCanada/naturecounts" class="external-link">naturecounts</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/" class="external-link">leaflet</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># weathercan is in the R-Universe rather than on CRAN, </span></span>
<span><span class="co"># so we install the package a little differently</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># install.packages("weathercan",</span></span>
<span><span class="co">#                  repos = c("https://ropensci.r-universe.dev",</span></span>
<span><span class="co">#                            "https://cloud.r-project.org"))</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">weathercan</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-setup">3.1 Data Setup<a class="anchor" aria-label="anchor" href="#data-setup"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">collections</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/meta.html">meta_collections</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="fu"><a href="../reference/meta.html">meta_collections</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/search_species.html">search_species</a></span><span class="op">(</span><span class="st">"whooping crane"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="fu"><a href="../reference/search_species.html">search_species</a></span><span class="op">(</span><span class="st">"whooping crane"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To download the NatureCounts data, you can specify the collection and
species code relevant to your research. Replace <code>testuser</code>
with your user name.</p>
<blockquote>
<p>The data download will not work unless you replace
<code>"testuser"</code> with your actual user name. You will be prompted
to enter your password.</p>
</blockquote>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">whooping_crane_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nc_data_dl.html">nc_data_dl</a></span><span class="op">(</span></span>
<span>  collections <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ABATLAS1"</span>, <span class="st">"ABATLAS2"</span>, <span class="st">"ABBIRDRECS"</span><span class="op">)</span>, species <span class="op">=</span> <span class="fl">4030</span>, </span>
<span>  username <span class="op">=</span> <span class="st">"testuser"</span>, info <span class="op">=</span> <span class="st">"spatial_data_tutorial"</span><span class="op">)</span></span></code></pre></div>
<p>eBird has the greatest number of Whooping Crane records, however,
this collection comprise data of Access Level 4. If you wish to access
this collection you must sign up for a free account and make a <a href="https://naturecounts.ca/nc/default/explore.jsp#table" class="external-link">data
request</a>. Otherwise, you can carry forward with the tutorial without
these data and skip this code chunk.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">whooping_crane_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nc_data_dl.html">nc_data_dl</a></span><span class="op">(</span></span>
<span>  collections <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ABATLAS1"</span>, <span class="st">"ABATLAS2"</span>, <span class="st">"ABBIRDRECS"</span>,<span class="st">"EBIRD-CA-PR"</span><span class="op">)</span>, species <span class="op">=</span> <span class="fl">4030</span>, </span>
<span>  username <span class="op">=</span> <span class="st">"testuser"</span>, info <span class="op">=</span> <span class="st">"spatial_data_tutorial"</span><span class="op">)</span></span></code></pre></div>
<p>Grouping the NatureCounts data might provide more meaningful insight
on species occurrences at each site and how they might vary across time
and space. You can achieve this by summarizing species occurrence by
SiteCode and survey year, while keeping the coordinate information for
each site using the <code>group_by</code> and <code>summarise</code>
functions:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">species_occurrence_summary</span> <span class="op">&lt;-</span> <span class="va">whooping_crane_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/format_dates.html">format_dates</a></span><span class="op">(</span><span class="op">)</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">SiteCode</span>, <span class="va">survey_year</span>, <span class="va">longitude</span>, <span class="va">latitude</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>total_count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">ObservationCount</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Lastly, you can summarize the NatureCounts data once more to get the
annual total counts of Whooping Cranes, say between 1985 and 2011. To do
so, we can 1) produce a regular dataframe called
<strong>cranes_summary</strong> by dropping the geometry column
(<code>st_drop_geometry</code>) 2) calculate the
<strong>annual_count</strong> by using the <code>summarise</code> and
<code>sum</code> functions and 3) filter for NA values and by
<strong>year:</strong></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cranes_summary</span> <span class="op">&lt;-</span> <span class="va">species_occurrence_summary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">survey_year</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>annual_count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">total_count</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">survey_year</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">survey_year</span> <span class="op">&gt;=</span> <span class="fl">1985</span> <span class="op">&amp;</span> <span class="va">survey_year</span> <span class="op">&lt;=</span> <span class="fl">2011</span><span class="op">)</span></span>
<span><span class="va">cranes_summary</span></span>
<span><span class="co">#&gt; # A tibble: 11 × 2</span></span>
<span><span class="co">#&gt;     year annual_count</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1  1987            0</span></span>
<span><span class="co">#&gt;  2  1988            0</span></span>
<span><span class="co">#&gt;  3  1990            0</span></span>
<span><span class="co">#&gt;  4  1991            0</span></span>
<span><span class="co">#&gt;  5  1996            1</span></span>
<span><span class="co">#&gt;  6  2000           24</span></span>
<span><span class="co">#&gt;  7  2001           14</span></span>
<span><span class="co">#&gt;  8  2002           26</span></span>
<span><span class="co">#&gt;  9  2003           14</span></span>
<span><span class="co">#&gt; 10  2004           18</span></span>
<span><span class="co">#&gt; 11  2005          180</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="weathercan-vector-data">3.2 Weathercan (Vector) Data<a class="anchor" aria-label="anchor" href="#weathercan-vector-data"></a>
</h2>
<p><code>weathercan</code> is an R package designed to help access
historical weather data from ECCC. Steffi LaZerte’s online tutorial, <a href="https://ropensci.org/blog/2018/03/06/weathercan/" class="external-link">Integrating data
from weathercan</a>, provides more details on how to download, filter,
and visualize weather data in R.</p>
<p>First, let’s take a look at the built in <strong>stations</strong>
dataset:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">stations</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 26,382 × 17</span></span>
<span><span class="co">#&gt;    prov  station_name       station_id climate_id WMO_id TC_id   lat   lon  elev tz    interval start   end normals</span></span>
<span><span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;  </span></span>
<span><span class="co">#&gt;  1 AB    DAYSLAND                 1795 301AR54        NA &lt;NA&gt;   52.9 -112.  689. Etc/… day       1908  1922 FALSE  </span></span>
<span><span class="co">#&gt;  2 AB    DAYSLAND                 1795 301AR54        NA &lt;NA&gt;   52.9 -112.  689. Etc/… hour        NA    NA FALSE  </span></span>
<span><span class="co">#&gt;  3 AB    DAYSLAND                 1795 301AR54        NA &lt;NA&gt;   52.9 -112.  689. Etc/… month     1908  1922 FALSE  </span></span>
<span><span class="co">#&gt;  4 AB    EDMONTON CORONATI…       1796 301BK03        NA &lt;NA&gt;   53.6 -114.  671. Etc/… day       1978  1979 FALSE  </span></span>
<span><span class="co">#&gt;  5 AB    EDMONTON CORONATI…       1796 301BK03        NA &lt;NA&gt;   53.6 -114.  671. Etc/… hour        NA    NA FALSE  </span></span>
<span><span class="co">#&gt;  6 AB    EDMONTON CORONATI…       1796 301BK03        NA &lt;NA&gt;   53.6 -114.  671. Etc/… month     1978  1979 FALSE  </span></span>
<span><span class="co">#&gt;  7 AB    FLEET                    1797 301B6L0        NA &lt;NA&gt;   52.2 -112.  838. Etc/… day       1987  1990 FALSE  </span></span>
<span><span class="co">#&gt;  8 AB    FLEET                    1797 301B6L0        NA &lt;NA&gt;   52.2 -112.  838. Etc/… hour        NA    NA FALSE  </span></span>
<span><span class="co">#&gt;  9 AB    FLEET                    1797 301B6L0        NA &lt;NA&gt;   52.2 -112.  838. Etc/… month     1987  1990 FALSE  </span></span>
<span><span class="co">#&gt; 10 AB    GOLDEN VALLEY            1798 301B8LR        NA &lt;NA&gt;   53.2 -110.  640  Etc/… day       1987  1998 FALSE  </span></span>
<span><span class="co">#&gt; # ℹ 26,372 more rows</span></span>
<span><span class="co">#&gt; # ℹ 3 more variables: normals_1991_2020 &lt;lgl&gt;, normals_1981_2010 &lt;lgl&gt;, normals_1971_2000 &lt;lgl&gt;</span></span></code></pre></div>
<p>You are ready to download weather data! For the purpose of this
tutorial, let’s perform a smaller weather data download by specifying
specific station IDs. The weather stations closest to Wood Buffalo
National Park are BIRCH MOUNTAIN LO (station_id = 2481) and BUCKTON LO
(station_id = 2486). These stations were identified using the the ECCC
<a href="https://climate.weather.gc.ca/historical_data/search_historic_data_stations_e.html?searchType=stnProx&amp;timeframe=1&amp;txtRadius=25&amp;selCity=&amp;optProxType=park&amp;selPark=57%7C39%7C112%7C0%7CWood+Buffalo+National+Park&amp;txtCentralLatDeg=&amp;txtCentralLatMin=&amp;txtCentralLatSec=&amp;txtCentralLongDeg=&amp;txtCentralLongMin=&amp;txtCentralLongSec=&amp;txtLatDecDeg=&amp;txtLongDecDeg=&amp;optLimit=yearRange&amp;StartYear=1840&amp;EndYear=2024&amp;Year=2024&amp;Month=10&amp;Day=1&amp;selRowPerPage=25" class="external-link">search
option</a> which helps you search for historical weather data based on
proximity to a city, coordinate, or National Park.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">birch_station</span> <span class="op">&lt;-</span> <span class="fu">stations_search</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"BIRCH MOUNTAIN LO"</span>, interval <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span></span>
<span><span class="va">buckton_station</span> <span class="op">&lt;-</span> <span class="fu">stations_search</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"BUCKTON LO"</span>, interval <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span></span>
<span><span class="va">wood_buff_stations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">birch_station</span>, <span class="va">buckton_station</span><span class="op">)</span> <span class="co"># combine </span></span></code></pre></div>
<p>Now you can perform the weather data download (give it a few
minutes).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span> <span class="op">&lt;-</span> <span class="fu">weather_dl</span><span class="op">(</span>station_ids <span class="op">=</span> <span class="va">wood_buff_stations</span><span class="op">$</span><span class="va">station_id</span>,</span>
<span>                      start <span class="op">=</span> <span class="st">"1985-01-01"</span>,</span>
<span>                      end <span class="op">=</span> <span class="st">"2011-12-31"</span>,</span>
<span>                      interval <span class="op">=</span> <span class="st">"day"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>NOTE - Larger data downloads can be performed based on filtered
stations datasets as well as start, end, and interval specifications.
Large historical weather downloads can take a while!</p>
<p>Here is an example where we filtered based on province, interval,
station operation period, and elevation to exclude extreme measurements
in the weather data download:</p>
<blockquote>
<p>To execute this code chunk, remove the #</p>
</blockquote>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#prov_stations &lt;- stations %&gt;%</span></span>
<span><span class="co">#  filter(prov %in% c("AB"),</span></span>
<span><span class="co">#         interval == "day",</span></span>
<span><span class="co">#         start &gt;= 1960,</span></span>
<span><span class="co">#         end &lt;= 2023,</span></span>
<span><span class="co">#         elev &lt; 1000)</span></span></code></pre></div>
<blockquote>
<p>To execute this code chunk, remove the #</p>
</blockquote>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># weather &lt;- weather_dl(station_ids = prov_stations$station_id,</span></span>
<span><span class="co">#                       start = "2000-01-01",</span></span>
<span><span class="co">#                       end = "2023-12-31",</span></span>
<span><span class="co">#                       interval = "day", quiet = TRUE)</span></span></code></pre></div>
<p>Next, convert the date column to Date data type. This will allow you
to apply more filters based on month and survey year:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weather</span><span class="op">$</span><span class="va">date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">weather</span><span class="op">$</span><span class="va">date</span><span class="op">)</span></span></code></pre></div>
<p>Finally, to summarize the weather data by calculating the annual mean
summer temperature and precipitation we can use the familiar
<code>filter</code>, <code>group_by</code>, and <code>summarise</code>
functions:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yearly_climate</span> <span class="op">&lt;-</span> <span class="va">weather</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fl">5</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  <span class="co"># Filter for summer months May (5) through August (8)</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span>survey_year <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>   <span class="co"># Group by year</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    yearly_avg_temp <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mean_temp</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    yearly_avg_precip <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">total_precip</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">yearly_climate</span></span>
<span><span class="co">#&gt; # A tibble: 27 × 3</span></span>
<span><span class="co">#&gt;     year yearly_avg_temp yearly_avg_precip</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt;           &lt;dbl&gt;             &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1  1985            11.6              1.14</span></span>
<span><span class="co">#&gt;  2  1986            11.7              2.96</span></span>
<span><span class="co">#&gt;  3  1987            11.8              2.71</span></span>
<span><span class="co">#&gt;  4  1988            12.1              3.40</span></span>
<span><span class="co">#&gt;  5  1989            13.0              1.85</span></span>
<span><span class="co">#&gt;  6  1990            13.1              2.44</span></span>
<span><span class="co">#&gt;  7  1991            13.4              3.40</span></span>
<span><span class="co">#&gt;  8  1992            11.2              2.40</span></span>
<span><span class="co">#&gt;  9  1993            10.7              3.00</span></span>
<span><span class="co">#&gt; 10  1994            13.2              3.39</span></span>
<span><span class="co">#&gt; # ℹ 17 more rows</span></span></code></pre></div>
<p>Now that you have prepared the NatureCounts and weathercan climate
data you can combine the data together for analysis.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cranes_climate_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">cranes_summary</span>, <span class="va">yearly_climate</span>, by <span class="op">=</span> <span class="st">"survey_year"</span><span class="op">)</span></span>
<span><span class="va">cranes_climate_summary</span></span>
<span><span class="co">#&gt; # A tibble: 11 × 4</span></span>
<span><span class="co">#&gt;     year annual_count yearly_avg_temp yearly_avg_precip</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt;        &lt;dbl&gt;           &lt;dbl&gt;             &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1  1987            0            11.8              2.71</span></span>
<span><span class="co">#&gt;  2  1988            0            12.1              3.40</span></span>
<span><span class="co">#&gt;  3  1990            0            13.1              2.44</span></span>
<span><span class="co">#&gt;  4  1991            0            13.4              3.40</span></span>
<span><span class="co">#&gt;  5  1996            1            11.7              3.37</span></span>
<span><span class="co">#&gt;  6  2000           24            10.6              3.83</span></span>
<span><span class="co">#&gt;  7  2001           14            13.7              2.76</span></span>
<span><span class="co">#&gt;  8  2002           26            11.3              3.18</span></span>
<span><span class="co">#&gt;  9  2003           14            12.9              2.72</span></span>
<span><span class="co">#&gt; 10  2004           18            10.6              2.08</span></span>
<span><span class="co">#&gt; 11  2005          180            10.7              2.89</span></span></code></pre></div>
<p>To visualize average annual summer temperature and total count, you
can use a scatterplot.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cranes_climate_summary</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yearly_avg_temp</span>, y <span class="op">=</span> <span class="va">annual_count</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Simple blue points</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Add linear regression line</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Avg Temperature (°C)"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Total Count"</span>, </span>
<span>       title <span class="op">=</span> <span class="st">"Whooping Crane Count vs. Annual Avg Summer Temp"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Center the title</span></span>
<span><span class="co">#&gt; `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre></div>
<p><img src="figures%2Fnc_sp3_annual_temp-1.png" alt="Scatterplot showing a decreasing relationship between the total count of whooping crans and average summer temperature"></p>
<p>And do the same for annual summer precipitation:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cranes_climate_summary</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yearly_avg_precip</span>, y <span class="op">=</span> <span class="va">annual_count</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Simple blue points</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Add linear regression line</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Avg Precipitation"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Total Count"</span>, </span>
<span>       title <span class="op">=</span> <span class="st">"Whooping Crane Count vs. Annual Avg Summer Precip"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Center the title</span></span>
<span><span class="co">#&gt; `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre></div>
<p><img src="figures%2Fnc_sp3_annual_precip-1.png" alt="Scatterplot showing no relationship between the total count of whooping crans and average summer precipitation, with one extremely high precipation point."></p>
</div>
<div class="section level2">
<h2 id="worldclim-raster-data">3.3 WorldClim (Raster) Data<a class="anchor" aria-label="anchor" href="#worldclim-raster-data"></a>
</h2>
<p><a href="https://www.worldclim.org/data/index.html" class="external-link">WorldClim</a>
provides high spatial resolution global weather and climate data. Their
data is in raster GeoTiff (.tif) file format and comprises a variety of
variables including 19 <a href="https://www.worldclim.org/data/bioclim.html" class="external-link">bioclimatic</a>
variables representing annual trends, seasonality, and extreme
environmental factors.</p>
<p>Download the bioclimatic data on <a href="https://www.worldclim.org/data/worldclim21.html" class="external-link">this webpage</a>.
The data are available at the four spatial resolutions, between 30
seconds (~1 km2) to 10 minutes (~340 km2). Each download is a “zip” file
containing 19 GeoTiff (.tif) files, one for each month of the variables.
For this tutorial, we recommend you download the 10 minute
resolution.</p>
<p>After dowloading the WorldClim data to your working directory, list
all the files in the raster stack by specifying the path to your folder
(use <code>list.files</code> function) and read them into R using the
<code>rast</code> function.</p>
<p>This code will get the path to your working directory.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/home/steffi/Projects/Business/Birds Canada/NatureCounts/naturecounts/vignettes/articles"</span></span></code></pre></div>
<p>Now point the <code>list.file</code> to this directory using the
sample code below.</p>
<pre><code><span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 1080, 2160, 19  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 0.1666667, 0.1666667  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : lon/lat WGS 84 (EPSG:4326) </span></span>
<span><span class="co">#&gt; sources     : wc2.1_10m_bio_1.tif  </span></span>
<span><span class="co">#&gt;               wc2.1_10m_bio_10.tif  </span></span>
<span><span class="co">#&gt;               wc2.1_10m_bio_11.tif  </span></span>
<span><span class="co">#&gt;               ... and 16 more source(s)</span></span>
<span><span class="co">#&gt; names       : wc2.1~bio_1, wc2.1~io_10, wc2.1~io_11, wc2.1~io_12, wc2.1~io_13, wc2.1~io_14, ... </span></span>
<span><span class="co">#&gt; min values  :   -54.72435,   -37.78142,   -66.31125,           0,           0,           0, ... </span></span>
<span><span class="co">#&gt; max values  :    30.98764,    38.21617,    29.15299,       11191,        2381,         484, ...</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">worldclim_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"YOUR/PATH/HERE"</span>, pattern <span class="op">=</span> <span class="st">"\\.tif$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read and stack the raster files</span></span>
<span><span class="va">worldclim_stack</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">worldclim_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print information about the stack</span></span>
<span><span class="va">worldclim_stack</span></span></code></pre></div>
<p>Great! The raster stack which includes the 19 bio-climatic variables
has been read into R successfully. We can simplify the layer names which
represent each variable, respectively:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">worldclim_stack</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"bio"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">19</span><span class="op">)</span></span></code></pre></div>
<p>Let’s take a look at the first layer ‘bio1’ which is Annual Mean
Temperature. To do so, you can subset the layers of the SpatRaster with
$ or two sets of square brackets [ [ ] ].</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the first bio-climatic layer (e.g., bio1: Annual Mean Temperature)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">worldclim_stack</span><span class="op">[[</span><span class="st">"bio1"</span><span class="op">]</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"Annual Mean Temperature (bio1)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures%2Fnc_sp3_raster_bio1-1.png" alt="World map with Annual mean temperatures overlaid in blues, greens and yellows. Showing cooler poles and warmer equatorial regions."></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Summary statistics for each layer</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">worldclim_stack</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: [summary] used a sample</span></span>
<span><span class="co">#&gt;       bio1             bio2             bio3             bio4             bio5             bio6       </span></span>
<span><span class="co">#&gt;  Min.   :-54.72   Min.   :-37.72   Min.   :-66.19   Min.   :   0.0   Min.   :   0.0   Min.   :  0.00  </span></span>
<span><span class="co">#&gt;  1st Qu.:-22.81   1st Qu.:-10.58   1st Qu.:-34.22   1st Qu.: 110.0   1st Qu.:  28.0   1st Qu.:  0.00  </span></span>
<span><span class="co">#&gt;  Median : -0.53   Median : 13.82   Median :-15.20   Median : 337.0   Median :  60.0   Median :  5.00  </span></span>
<span><span class="co">#&gt;  Mean   : -4.05   Mean   :  7.19   Mean   :-13.90   Mean   : 550.3   Mean   :  93.5   Mean   : 15.39  </span></span>
<span><span class="co">#&gt;  3rd Qu.: 19.02   3rd Qu.: 24.80   3rd Qu.: 12.13   3rd Qu.: 690.0   3rd Qu.: 112.0   3rd Qu.: 18.00  </span></span>
<span><span class="co">#&gt;  Max.   : 30.71   Max.   : 38.18   Max.   : 28.62   Max.   :7011.0   Max.   :1965.0   Max.   :471.00  </span></span>
<span><span class="co">#&gt;  NA's   :65591    NA's   :65591    NA's   :65591    NA's   :65591    NA's   :65591    NA's   :65591   </span></span>
<span><span class="co">#&gt;       bio7             bio8             bio9             bio10            bio11            bio12      </span></span>
<span><span class="co">#&gt;  Min.   :  0.00   Min.   :   0.0   Min.   :   0.00   Min.   :   0.0   Min.   :   0.0   Min.   : 1.00  </span></span>
<span><span class="co">#&gt;  1st Qu.: 41.41   1st Qu.:  56.0   1st Qu.:   2.00   1st Qu.:   7.0   1st Qu.:  17.0   1st Qu.: 7.38  </span></span>
<span><span class="co">#&gt;  Median : 64.80   Median : 152.0   Median :  23.00   Median : 107.0   Median :  47.0   Median : 9.34  </span></span>
<span><span class="co">#&gt;  Mean   : 74.63   Mean   : 241.8   Mean   :  55.47   Mean   : 156.5   Mean   : 108.8   Mean   : 9.94  </span></span>
<span><span class="co">#&gt;  3rd Qu.:100.13   3rd Qu.: 298.0   3rd Qu.:  66.00   3rd Qu.: 225.0   3rd Qu.: 109.0   3rd Qu.:12.36  </span></span>
<span><span class="co">#&gt;  Max.   :228.88   Max.   :4503.0   Max.   :1477.00   Max.   :3159.0   Max.   :3849.0   Max.   :20.28  </span></span>
<span><span class="co">#&gt;  NA's   :65591    NA's   :65591    NA's   :65591     NA's   :65591    NA's   :65591    NA's   :65591  </span></span>
<span><span class="co">#&gt;      bio13            bio14            bio15            bio16            bio17           bio18       </span></span>
<span><span class="co">#&gt;  Min.   :  9.65   Min.   :   0.0   Min.   :-29.60   Min.   :-72.40   Min.   : 1.00   Min.   :-66.19  </span></span>
<span><span class="co">#&gt;  1st Qu.: 20.97   1st Qu.: 569.8   1st Qu.: -6.01   1st Qu.:-39.30   1st Qu.:26.11   1st Qu.:-26.12  </span></span>
<span><span class="co">#&gt;  Median : 26.57   Median : 897.1   Median : 21.53   Median :-21.61   Median :33.38   Median : 10.69  </span></span>
<span><span class="co">#&gt;  Mean   : 34.54   Mean   : 880.0   Mean   : 13.93   Mean   :-19.80   Mean   :33.72   Mean   : -0.93  </span></span>
<span><span class="co">#&gt;  3rd Qu.: 45.35   3rd Qu.:1206.6   3rd Qu.: 31.35   3rd Qu.:  4.63   3rd Qu.:41.31   3rd Qu.: 21.46  </span></span>
<span><span class="co">#&gt;  Max.   :100.00   Max.   :2342.4   Max.   : 47.95   Max.   : 26.20   Max.   :71.58   Max.   : 37.70  </span></span>
<span><span class="co">#&gt;  NA's   :65591    NA's   :65591    NA's   :65591    NA's   :65591    NA's   :65591   NA's   :65591   </span></span>
<span><span class="co">#&gt;      bio19       </span></span>
<span><span class="co">#&gt;  Min.   :-54.26  </span></span>
<span><span class="co">#&gt;  1st Qu.:-24.25  </span></span>
<span><span class="co">#&gt;  Median : -9.26  </span></span>
<span><span class="co">#&gt;  Mean   : -5.38  </span></span>
<span><span class="co">#&gt;  3rd Qu.: 18.52  </span></span>
<span><span class="co">#&gt;  Max.   : 37.04  </span></span>
<span><span class="co">#&gt;  NA's   :65591</span></span></code></pre></div>
<p>Convert the <strong>species_occurences_summary</strong>, which
summarizes species occurrence by SiteCode, into a spatial object using
the <code>st_as_sf</code> function:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cranes_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">species_occurrence_summary</span>,</span>
<span>                      coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span></code></pre></div>
<p>Extract the bio-climatic variable values for each bird observation
site, respectively.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bioclim_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">worldclim_stack</span>, <span class="va">cranes_sf</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in UseMethod("extract"): no applicable method for 'extract' applied to an object of class "SpatRaster"</span></span></code></pre></div>
<p>Then combine the bio-climatic values with the NatureCounts data.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bioclim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">cranes_sf</span>, <span class="va">bioclim_values</span>, </span>
<span>                      longitude <span class="op">=</span> <span class="va">species_occurrence_summary</span><span class="op">$</span><span class="va">longitude</span>, </span>
<span>                      latitude <span class="op">=</span>  <span class="va">species_occurrence_summary</span><span class="op">$</span><span class="va">latitude</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in eval(expr, envir, enclos): object 'bioclim_values' not found</span></span></code></pre></div>
<p>Filter the data to only include observations made post 1970 to match
the temporal resolution of the climate dataset:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bioclim_data</span> <span class="op">&lt;-</span> <span class="va">bioclim_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="st">"1970"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in eval(expr, envir, enclos): object 'bioclim_data' not found</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">bioclim_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'object' in selecting a method for function 'summary': object 'bioclim_data' not found</span></span></code></pre></div>
<p>Visualize the distribution of <strong>bio1</strong> compared to
<strong>total_count</strong>:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Scatter plot of bird observations against a bioclimatic variable (bio1 = Annual Mean Temperature)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bioclim_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bio1</span>, y <span class="op">=</span> <span class="va">total_count</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Bird Observations vs. Bioclimatic Variable (bio1)"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Annual Mean Temperature"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"ObservationCount"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in eval(expr, envir, enclos): object 'bioclim_data' not found</span></span></code></pre></div>
<p>Map the NatureCounts data by grouping it by
<strong>SiteCode</strong>, sizing the points by
<strong>total_count</strong> and colorizing them by a bio-climatic
variable (<strong>bio1</strong>):</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bioclim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">bioclim_data</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in eval(expr, envir, enclos): object 'bioclim_data' not found</span></span></code></pre></div>
<p>To make an interactive map of total counts per site.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Group by SiteCode and summarize total_count</span></span>
<span><span class="va">bioclim_data</span> <span class="op">&lt;-</span> <span class="va">bioclim_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">SiteCode</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>total_count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">total_count</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            bio1 <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">bio1</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            latitude <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first</a></span><span class="op">(</span><span class="va">latitude</span><span class="op">)</span>,</span>
<span>            longitude <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first</a></span><span class="op">(</span><span class="va">longitude</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define color palette for bio1</span></span>
<span><span class="va">pal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/colorNumeric.html" class="external-link">colorNumeric</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"YlOrRd"</span>, domain <span class="op">=</span> <span class="va">bioclim_data</span><span class="op">$</span><span class="va">bio1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a scaling factor for total_count</span></span>
<span><span class="va">scaling_factor</span> <span class="op">&lt;-</span> <span class="fl">2</span>  <span class="co"># Adjust this to scale the circle size</span></span>
<span></span>
<span><span class="co"># Plot using leaflet</span></span>
<span><span class="fu"><a href="https://rstudio.github.io/leaflet/reference/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span><span class="va">bioclim_data</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addTiles</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addCircleMarkers</a></span><span class="op">(</span></span>
<span>    <span class="op">~</span><span class="va">longitude</span>, <span class="op">~</span><span class="va">latitude</span>,</span>
<span>    radius <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">total_count</span><span class="op">)</span> <span class="op">*</span> <span class="va">scaling_factor</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fl">15</span><span class="op">)</span>,  <span class="co"># Scale and limit radius</span></span>
<span>    fillColor <span class="op">=</span> <span class="op">~</span><span class="fu">pal</span><span class="op">(</span><span class="va">bio1</span><span class="op">)</span>,      <span class="co"># Color points by bio1</span></span>
<span>    color <span class="op">=</span> <span class="st">"black"</span>, stroke <span class="op">=</span> <span class="cn">TRUE</span>, fillOpacity <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>    popup <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"&lt;strong&gt;SiteCode:&lt;/strong&gt; "</span>, <span class="va">SiteCode</span>, <span class="st">"&lt;br&gt;"</span>, </span>
<span>                    <span class="st">"&lt;strong&gt;Total Count:&lt;/strong&gt; "</span>, <span class="va">total_count</span>, <span class="st">"&lt;br&gt;"</span>,      </span>
<span>                    <span class="st">"&lt;strong&gt;Bio1:&lt;/strong&gt; "</span>, <span class="va">bio1</span><span class="op">)</span> <span class="co"># creates info popup labels</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/addLegend.html" class="external-link">addLegend</a></span><span class="op">(</span>pal <span class="op">=</span> <span class="va">pal</span>, values <span class="op">=</span> <span class="op">~</span><span class="va">bio1</span>, title <span class="op">=</span> <span class="st">"Bio1"</span>, position <span class="op">=</span> <span class="st">"bottomright"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/addScaleBar.html" class="external-link">addScaleBar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"bottomleft"</span>, options <span class="op">=</span> <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/addScaleBar.html" class="external-link">scaleBarOptions</a></span><span class="op">(</span>imperial <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>Congratulations</strong>! You’ve completed <strong>Chapter 3
- Climate Data</strong>. Here, you successfully combined NatureCounts
data with vector and raster climate data in R. In <a href="04-ElevationData.Rmd">Chapter 4</a> you can explore how-to link
NatureCounts observations with elevation data.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Steffi LaZerte, Denis Lepage.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
