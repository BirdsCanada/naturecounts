<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 4 - Elevation Data • naturecounts</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Chapter 4 - Elevation Data">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">naturecounts</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.4.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/1.1-Introduction.html">Chapter 1 - Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/1.2-LoadPackage.html">Chapter 2 - Loading R Packages</a></li>
    <li><a class="dropdown-item" href="../articles/1.3-ViewData.html">Chapter 3 - Understanding and Viewing Data</a></li>
    <li><a class="dropdown-item" href="../articles/1.4-DownloadData.html">Chapter 4 - Downloading and Filtering Data</a></li>
    <li><a class="dropdown-item" href="../articles/1.5-ManipData.html">Chapter 5 - Data Manipulation</a></li>
    <li><a class="dropdown-item" href="../articles/1.6-VisualData.html">Chapter 6 - Data Visualization</a></li>
    <li><a class="dropdown-item" href="../articles/1.7-Answers.html">Chapter 7 - Answers</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BirdsCanada/naturecounts/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Chapter 4 - Elevation Data</h1>
            
            <h4 data-toc-skip class="date">2025-04-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/BirdsCanada/naturecounts/blob/docs-update/vignettes/articles/2.4-ElevationData.Rmd" class="external-link"><code>vignettes/articles/2.4-ElevationData.Rmd</code></a></small>
      <div class="d-none name"><code>2.4-ElevationData.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="chapter-4-digital-elevation-data">Chapter 4: Digital Elevation Data<a class="anchor" aria-label="anchor" href="#chapter-4-digital-elevation-data"></a>
</h2>
<div class="section level6">
<h6 id="authors-dimitrios-markou-danielle-ethier">Authors: Dimitrios Markou, Danielle Ethier<a class="anchor" aria-label="anchor" href="#authors-dimitrios-markou-danielle-ethier"></a>
</h6>
<blockquote>
<p>In <a href="03-ClimateData.Rmd">Chapter 3</a>, you processed vector
and raster climate data, combined them with NatureCounts observations,
and visualized them using plots and spatiotemporal maps. In this
tutorial, you will process <strong>LiDAR</strong>-derived Digital
Terrain Models, apply cropping and masking procedures, and extract
elevation values to combine with NatureCounts data. Your focus will be
on the NatureCounts and spatial data within <a href="https://parks.canada.ca/pn-np/qc/mauricie/nature" class="external-link">La Mauricie
National Park</a>.</p>
</blockquote>
<p>La Mauricie National Park is situated in the Laurentian mountains and
covers 536 km2 within the Eastern Canadian Temperate-Boreal Forest
transition ecoregion. The environment is characterized by mixed forests,
lakes, rivers, and hills that range from from 150 m to over 500 m in
elevation. The park provides suitable habitat for a variety of wildlife
including at least 215 bird species.</p>
<p>Light Detection and Ranging (<strong>LiDAR</strong>) is an active
remote sensing technology. It is performed using laser scanners that
emit pulses of light and determine the position of target 3D objects by
measuring the amount of time between pulses being emitted and received.
It is a revolutionary technology that helps in the acquisition of
extremely accurate digital elevation data over wide spatial and temporal
scales. For more info and examples of LiDAR data resources specific to
your province, see <a href="#id_4.5LiDAR">LiDAR Data Resources</a> at
the end of this Chapter.</p>
</div>
</div>
<div class="section level2">
<h2 id="id_4-0LearningObjectives">4.0 Learning Objectives<a class="anchor" aria-label="anchor" href="#id_4-0LearningObjectives"></a>
</h2>
<p>By the end of <strong>Chapter 4 - Elevation Data</strong>, users will
know how to:</p>
<ul>
<li>Distinguish between different types of digital elevation datasets:
<a href="#id_4.2ElevationModels">Elevation Models</a>
</li>
<li>Process Digital Terrain Models (DTMs), including cropping and
masking: <a href="#id_4.3Crop-Mask">Spatial Extents - Crop and
Mask</a>
</li>
<li>Extract elevation data (raster values) at observation sites (vector
points): <a href="#id_4.4Map-Extract">Map &amp; Extract Digital
Elevation Data</a>
</li>
<li>Know how to access LiDAR-derived data products: <a href="#id_4.5LiDAR">LiDAR Data Resources</a> and <a href="#id_4.6LiDAR">Manual Data Download</a>
</li>
</ul>
<p>Load the necessary packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/BirdsCanada/naturecounts" class="external-link">naturecounts</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/" class="external-link">stars</a></span><span class="op">)</span>  <span class="co"># Another package for working with raster data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<p>This tutorial uses the following spatial data.</p>
<ol style="list-style-type: decimal">
<li><p><a href="https://open.canada.ca/data/en/dataset/e1f0c975-f40c-4313-9be2-beb951e35f4e/resource/0744186a-449b-4f1f-9f1e-952a94c6d5ca" class="external-link">Places
administered by Parks Canada</a> - Boundary shapefiles</p></li>
<li><p><a href="https://naturecounts.ca/nc/default/datasets.jsp?code=QCATLAS2PC&amp;sec=bmdr" class="external-link">Quebec
Breeding Bird Atlas (2010 - 2014)</a> - NatureCounts bird
observations</p></li>
<li><p><a href="https://www.donneesquebec.ca/recherche/fr/dataset/produits-derives-de-base-du-lidar" class="external-link">Forêt
ouverte (lidar-derived products)</a> - Digital Terrain Models
(DTMs)</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="id_4-1DataSetup">4.1 Data Setup<a class="anchor" aria-label="anchor" href="#id_4-1DataSetup"></a>
</h2>
<p>To read the National Park polygons into R, navigate to <a href="https://open.canada.ca/data/en/dataset/e1f0c975-f40c-4313-9be2-beb951e35f4e/resource/0744186a-449b-4f1f-9f1e-952a94c6d5ca" class="external-link">Places
administered by Parks Canada</a>, click “Go to Resource” to download. If
you haven’t already, return to the <a href="02-SpatialSubsets">Chapter
2</a> Learning Objectives to view (<code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd()</a></code>) and set
(<code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd()</a></code>) your working directory and create a folder within
this directory called <code>data</code>. This is where you will store
all data used in this tutorial series.</p>
<p>Create a subdirectory called <code>nationalparks</code> to neatly
store the parks spatial data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"data/nationalparks"</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Move the files from your Downloads to the <code>nationalparks</code>
subdirectory before applying the <code><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read()</a></code> function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># specify the path to your shapefile</span></span>
<span><span class="va">national_parks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="st">"path/to/your/shapefile.shp"</span><span class="op">)</span></span></code></pre></div>
<p>Filter the <strong>national_parks</strong> dataset for La Mauricie
National Park.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">national_parks</span><span class="op">)</span> <span class="co"># to find the correct object ID</span></span>
<span></span>
<span><span class="va">mauricie_boundary</span> <span class="op">&lt;-</span> <span class="va">national_parks</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">OBJECTID</span> <span class="op">==</span> <span class="st">"21"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Drop the Z-dimension (3D component) to make it 2D</span></span>
<span><span class="va">mauricie_boundary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_zm.html" class="external-link">st_zm</a></span><span class="op">(</span><span class="va">mauricie_boundary</span>, drop <span class="op">=</span> <span class="cn">TRUE</span>, what <span class="op">=</span> <span class="st">"ZM"</span><span class="op">)</span></span></code></pre></div>
<p>OPTIONAL: To save the boundary as a shapefile to your working
directory, use the <code><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write()</a></code> function. <strong>The
boundary files are used again in subsequent chapters</strong>. We have
uploaded them to the <a href="https://drive.google.com/drive/folders/1gLUC6fROl4kNBvTGselhZif-arPexZbY?usp=sharing" class="external-link"><strong>Google
Drive data folder</strong></a> for your convenience.</p>
<p>Create a subdirectory called <code>boundary</code> to neatly store
the boundary files.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"data/boundary"</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>To execute this code chunk, remove the #</p>
</blockquote>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># st_write(mauricie_boundary, "data/boundary/mauricie_boundary.shp") </span></span>
<span></span>
<span><span class="co"># st_write(mauricie_boundary, "data/boundary/mauricie_boundary.kml", driver="KML")</span></span></code></pre></div>
<p>To assess the species distribution within the National Park, download
data from the <a href="https://naturecounts.ca/nc/default/datasets.jsp?code=QCATLAS2PC&amp;sec=bmdr" class="external-link">Quebec
Breeding Bird Atlas (2010 - 2014)</a> which is a 5 year census that
collects data on the distribution and abundance of all species breeding
in the province.</p>
<p>Don’t forget to replace <code>testuser</code> with your NatureCounts
username. You will be prompted for your password.</p>
<p>Download NatureCounts data:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">quebec_atlas</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nc_data_dl.html">nc_data_dl</a></span><span class="op">(</span></span>
<span>  collections <span class="op">=</span> <span class="st">"QCATLAS2PC"</span>,  </span>
<span>  username <span class="op">=</span> <span class="st">"testuser"</span>, info <span class="op">=</span> <span class="st">"spatial_data_tutorial"</span>, timeout <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
<p>Read in the list of species names from NatureCounts which can be
linked to the species id:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">species_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_species.html">search_species</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>To create date and doy columns and ensure that the ObservationCount
column is in the correct numeric format we can apply the
<code><a href="../reference/format_dates.html">format_dates()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code> functions. We will
also filter the dataset to exclude rows with missing coordinates.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">quebec_atlas</span> <span class="op">&lt;-</span> <span class="va">quebec_atlas</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/format_dates.html">format_dates</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  <span class="co"># create the date and doy columns </span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ObservationCount <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">ObservationCount</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  <span class="co"># convert to numeric format</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">longitude</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">latitude</span><span class="op">)</span><span class="op">)</span>  <span class="co"># remove rows with missing coordinates</span></span></code></pre></div>
<p>To convert the NatureCounts data to a spatial object and transform
its coordinate reference system (CRS) to match the National Park
boundary we can use the <code><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf()</a></code> and
<code><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform()</a></code> functions, respectively.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">quebec_atlas_sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">quebec_atlas</span>,</span>
<span>                        coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span> <span class="co"># converts the quebec_atlas data to an sf object, crs = 4326 is WGS84 which corresponds to the NatureCounts data</span></span>
<span></span>
<span><span class="va">mauricie_boundary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">mauricie_boundary</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">quebec_atlas_sf</span><span class="op">)</span><span class="op">)</span> <span class="co"># match the CRS between the polygon and point data</span></span></code></pre></div>
<p>Clip the NatureCounts point data to the National Park boundary using
<code><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_intersection()</a></code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mauricie_birds_sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_intersection</a></span><span class="op">(</span><span class="va">quebec_atlas_sf</span>, <span class="va">mauricie_boundary</span><span class="op">)</span></span></code></pre></div>
<p>Append the species names to the clipped NatureCounts dataset based on
<code>species_id</code> code.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mauricie_birds_sf</span> <span class="op">&lt;-</span> <span class="va">mauricie_birds_sf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">species_names</span>, by <span class="op">=</span> <span class="st">"species_id"</span><span class="op">)</span></span></code></pre></div>
<p>Tidyverse functions can help us summarize our data in a variety of
ways. For example, we can determine the annual total count of birds for
each year across all sites. To do this we use the
<code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by()</a></code> function to group the observations by year, and
<code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise()</a></code> to calculate and create the
<strong>annual_count</strong> column.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mauricie_birds_summary</span> <span class="op">&lt;-</span> <span class="va">mauricie_birds_sf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">survey_year</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>annual_count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">ObservationCount</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># calculates the annual_count</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">survey_year</span><span class="op">)</span><span class="op">)</span>  <span class="co"># remove rows with missing year</span></span>
<span></span>
<span><span class="va">mauricie_birds_summary</span></span>
<span><span class="co">#&gt; Simple feature collection with 4 features and 2 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -73.12685 ymin: 46.65015 xmax: -72.77968 ymax: 46.82687</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 3</span></span>
<span><span class="co">#&gt;   survey_year annual_count                                                                                  geometry</span></span>
<span><span class="co">#&gt; *       &lt;int&gt;        &lt;dbl&gt;                                                                          &lt;MULTIPOINT [°]&gt;</span></span>
<span><span class="co">#&gt; 1        2011          909 ((-72.83548 46.76367), (-72.83824 46.76044), (-72.84852 46.75341), (-72.85742 46.74331...</span></span>
<span><span class="co">#&gt; 2        2012          578 ((-72.77968 46.74193), (-72.80576 46.75797), (-72.80941 46.75672), (-72.83613 46.77124...</span></span>
<span><span class="co">#&gt; 3        2013          517 ((-72.80942 46.75671), (-72.83614 46.77124), (-72.84853 46.75341), (-72.82786 46.74054...</span></span>
<span><span class="co">#&gt; 4        2014         1396 ((-72.77968 46.74193), (-72.80576 46.75797), (-72.80941 46.75672), (-72.83613 46.77124...</span></span></code></pre></div>
<p>If you wanted to summarize total count for each species at each Atlas
Block you could adjust the pipe using <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider()</a></code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mauricie_species_summary</span> <span class="op">&lt;-</span> <span class="va">mauricie_birds_sf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  <span class="co"># drop the geometry column</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">english_name</span>, <span class="va">Locality</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>total_count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">ObservationCount</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># calculates the total_count column</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">english_name</span>, <span class="co"># populates the column names with each species common name</span></span>
<span>              values_from <span class="op">=</span> <span class="va">total_count</span>, <span class="co"># populates each cell with total_count</span></span>
<span>              values_fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>total_count <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="co"># missing values are zero-filled</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'english_name'. You can override using the `.groups` argument.</span></span>
<span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">mauricie_species_summary</span><span class="op">)</span></span></code></pre></div>
<p>Drop the geometry column and convert the filtered NatureCounts data
back to a regular dataframe. Select key attributes to reduce the
dataframe.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mauricie_birds_df</span> <span class="op">&lt;-</span> <span class="va">mauricie_birds_sf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  <span class="co"># Drops the geometry column</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">mauricie_birds_sf</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  <span class="co"># Extract coordinates</span></span>
<span>      <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># Convert the coordinates to a data.frame</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>longitude <span class="op">=</span> <span class="va">X</span>, latitude <span class="op">=</span> <span class="va">Y</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mauricie_birds_df</span> <span class="op">&lt;-</span> <span class="va">mauricie_birds_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">record_id</span>, <span class="va">species_id</span>, <span class="va">english_name</span>, <span class="va">SiteCode</span>, <span class="va">survey_year</span>, <span class="va">survey_month</span>, <span class="va">survey_day</span>, <span class="va">ObservationCount</span>, <span class="va">longitude</span>, <span class="va">latitude</span><span class="op">)</span> <span class="co"># reduce the dataframe to the columns needed for your analysis</span></span></code></pre></div>
<p>OPTIONAL: To save the NatureCounts data as a <em>.csv</em> to your
disk, use the <code><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv()</a></code> function, specify the name of
your .csv file, and use the row.names = FALSE argument to exclude row
numbers from the output. <strong>The filtered NatureCounts dataset will
be used again in subsequent chapters</strong>. We have uploaded this
file to the <a href="https://drive.google.com/drive/folders/1gLUC6fROl4kNBvTGselhZif-arPexZbY?usp=sharing" class="external-link"><strong>Google
Drive data folder</strong></a> for your convenience.</p>
<blockquote>
<p>To execute this code chunk, remove the #</p>
</blockquote>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># write.csv(mauricie_birds_df, "data/mauricie_birds_df.csv", row.names = FALSE)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="id_4-2ElevationModels">4.2 Elevation Models<a class="anchor" aria-label="anchor" href="#id_4-2ElevationModels"></a>
</h2>
<p>Digital elevation datasets store topographic information like
elevation or slope and are often used in landscape ecology. These
datasets, i.e., Digital Elevation Models (DEMs), Digital Surface Models
(DSMs), and Digital Terrain Models (DTMs) are derived through a variety
of remote sensing and spatial interpolation techniques and all help
describe land features.</p>
<p><strong>Digital Elevation Model</strong> - represents the bare-Earth
surface and <u>excludes</u> all terrain vector features (i.e., streams,
breaklines, and ridges), and all ground objects (power lines, buildings,
trees, and vegetation).</p>
<p><strong>Digital Surface Model</strong> - represents the heights of
the Earth’s surface and <u>includes</u> all natural and artificial
features or ground objects.</p>
<p><strong>Digital Terrain Model</strong> - represents the bare-Earth
surface topography and includes all terrain vector features. It does not
include natural or artificial ground objects. In other words, it is a
DEM that is augmented by the presence of streams, breaklines, and
ridges.</p>
<p>For quick-access to the elevation data, download the .tif files from
their URL using the hyperlinks below. If you wish to gain experience in
how-to access LiDAR data yourself, follow the steps <a href="#id_4.6LiDAR">at the end of this Chapter</a>.</p>
<p><strong>Click the following hyperlinks to download the LiDAR-derived
elevation data for tiles <a href="https://diffusion.mffp.gouv.qc.ca/Diffusion/DonneeGratuite/Foret/IMAGERIE/Produits_derives_LiDAR/31I/31I14NE/MNT_31I14NE.tif" class="external-link">31I14NE</a>,
<a href="https://diffusion.mffp.gouv.qc.ca/Diffusion/DonneeGratuite/Foret/IMAGERIE/Produits_derives_LiDAR/31I/31I15NO/MNT_31I15NO.tif" class="external-link">31I15NO</a>,
<a href="https://diffusion.mffp.gouv.qc.ca/Diffusion/DonneeGratuite/Foret/IMAGERIE/Produits_derives_LiDAR/31I/31I14SE/MNT_31I14SE.tif" class="external-link">31I14SE</a>,
<a href="https://diffusion.mffp.gouv.qc.ca/Diffusion/DonneeGratuite/Foret/IMAGERIE/Produits_derives_LiDAR/31I/31I15SO/MNT_31I15SO.tif" class="external-link">31I15SO</a>,
<a href="https://diffusion.mffp.gouv.qc.ca/Diffusion/DonneeGratuite/Foret/IMAGERIE/Produits_derives_LiDAR/31I/31I11NE/MNT_31I11NE.tif" class="external-link">31I11NE</a>,
and <a href="https://diffusion.mffp.gouv.qc.ca/Diffusion/DonneeGratuite/Foret/IMAGERIE/Produits_derives_LiDAR/31I/31I10NO/MNT_31I10NO.tif" class="external-link">31I10NO</a>,
respectively and then move them to their own folder named
<code>dtm</code> stored in your <code>data</code>
subdirectory.</strong></p>
<p>Create a subdirectory called <code>dtm</code> to neatly store your
downloaded TIF files. Move them from your Downloads to the
<code>dtm</code> folder.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"data/dtm"</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Set the path to your TIF file subdirectory.</p>
<p>Create a mosaic of the adjacent DTM rasters.</p>
<p><strong>Reminder: You should store the DTM’s in their own folder
after download. The code below will produce an error if there are other
.tif files in your subdirectory (like the ones you downloaded in Chapter
3).</strong></p>
<p>Here we use the <code>stars</code> package which allows us to create
‘proxy’ objects, meaning that the files aren’t loaded into memory until
the absolutely must be. This allows us to work much more quickly with
the files, especially for plotting.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># list all the TIFF files in your directory</span></span>
<span><span class="va">dtm_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">output_dir</span>, pattern <span class="op">=</span> <span class="st">"\\.tif$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Combine into a single stars object (use proxy to only load what we need)</span></span>
<span><span class="va">dtm_mosaic</span> <span class="op">&lt;-</span> <span class="fu">st_mosaic</span><span class="op">(</span><span class="va">dtm_files</span><span class="op">)</span></span>
<span><span class="va">dtm_mosaic</span> <span class="op">&lt;-</span> <span class="fu">read_stars</span><span class="op">(</span><span class="va">dtm_mosaic</span>, proxy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Let’s check if the DTM and National Park boundary have the same crs
by using the <code><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs()</a></code> function and equality operator
(<strong>==</strong>) which will generate either TRUE or FALSE.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">dtm_mosaic</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">mauricie_boundary</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>To reproject the spatial data with the same CRS, we can use the
<code><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform()</a></code> function.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mauricie_boundary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">mauricie_boundary</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">dtm_mosaic</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="id_4-3Crop-Mask">4.3 Spatial Extents: Crop &amp; Mask<a class="anchor" aria-label="anchor" href="#id_4-3Crop-Mask"></a>
</h2>
<ul>
<li>
<strong>Cropping</strong> reduces the extent of a raster to the
extent of another raster or vector.</li>
<li>
<strong>Masking</strong> assigns NA values to cells of a raster not
covered by a vector extent.</li>
</ul>
<p>The <code>stars</code> package function <code><a href="https://r-spatial.github.io/sf/reference/st_crop.html" class="external-link">st_crop()</a></code>
performs both of these steps in one.</p>
<p>Here, we crop the extent of the raster to the National Park
Boundary.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dtm_crop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html" class="external-link">st_crop</a></span><span class="op">(</span><span class="va">dtm_mosaic</span>, <span class="va">mauricie_boundary</span><span class="op">)</span></span></code></pre></div>
<p>OPTIONAL: To write the masked raster to your disk, you can use the
<code>write_stars()</code> function from <code>stars</code> (this will
take a while as it is a large file). <strong>This raster will be used
in</strong> <a href="07-SummaryTools.Rmd">Chapter 7: Summary Tools</a>.
We have uploaded this file to the <a href="https://drive.google.com/drive/folders/1gLUC6fROl4kNBvTGselhZif-arPexZbY?usp=sharing" class="external-link"><strong>Google
Drive data folder</strong></a> for your convenience.</p>
<blockquote>
<p>To execute this code chunk, remove the #</p>
</blockquote>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># output_dir &lt;- "path/to/your/subdirectory/data/dtm_mask.tif" # include the masked raster name and '.tif' argument </span></span>
<span></span>
<span><span class="co"># write_stars(dtm_crop, output_dir)</span></span></code></pre></div>
<p><strong>Note: Make sure to include the ‘.tif’ argument when
specifying the <code>output_dir</code> and name of your masked raster
file. This specifies the file type while using
<code><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster()</a></code> which will, otherwise, produce an
error.</strong></p>
</div>
<div class="section level2">
<h2 id="id_4-4Map-Extract">4.4 Map and Extract Digital Elevation Data<a class="anchor" aria-label="anchor" href="#id_4-4Map-Extract"></a>
</h2>
<p>Visualize the regional and masked DTM’s with a two-panel plot.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot dtm_mosaic</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dtm_mosaic</span>, main <span class="op">=</span> <span class="st">"regional DTM"</span>, </span>
<span>     col <span class="op">=</span> <span class="fu">viridisLite</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, reset <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># reset = FALSE allows us to stack plots</span></span>
<span><span class="co">#&gt; downsample set to 37</span></span>
<span></span>
<span><span class="co"># Overlay the National Park boundary on the first plot</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="va">mauricie_boundary</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures%2Fnc_sp4_masked_dem-1.png" alt="Two-panel plot visualizing the regional and masked DTM's"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Plot dtm_mask</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dtm_crop</span>, main <span class="op">=</span> <span class="st">"masked DTM"</span>, </span>
<span>     col <span class="op">=</span> <span class="fu">viridisLite</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, reset <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; downsample set to 28</span></span></code></pre></div>
<p><img src="figures%2Fnc_sp4_masked_dem-2.png" alt="Two-panel plot visualizing the regional and masked DTM's"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Overlay the National Park boundary on the second plot</span></span>
<span><span class="co">#plot(st_as_sfc(mauricie_boundary), add = TRUE, border = "red", lwd = 2, col = NA, reset = FALSE)</span></span></code></pre></div>
<p>Summarize the NatureCounts data for mapping. Here we will determine
the number of species observed at each site.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Group by SiteCode and summarize mean annual count across all species</span></span>
<span><span class="va">mauricie_site_summary</span> <span class="op">&lt;-</span> <span class="va">mauricie_birds_sf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">SiteCode</span>, <span class="va">geometry</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n_species <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">english_name</span><span class="op">)</span><span class="op">)</span> <span class="co"># count the number of unique species</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'SiteCode'. You can override using the `.groups` argument.</span></span></code></pre></div>
<p>Now we can map the NatureCounts summary output with the DTM data.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Match the CRS</span></span>
<span><span class="va">mauricie_site_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">mauricie_site_summary</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">dtm_crop</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the dtm_mask raster</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dtm_crop</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"Elevation with Species Diversity Summary Points across La Mauricie"</span>,</span>
<span>     col <span class="op">=</span> <span class="fu">viridisLite</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, reset <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; downsample set to 28</span></span>
<span></span>
<span><span class="co"># Overlay the National Park boundary in red</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">mauricie_boundary</span><span class="op">)</span>, </span>
<span>     col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, </span>
<span>     reset <span class="op">=</span> <span class="cn">FALSE</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#scale the n_species column to range from 0-5 for plotting</span></span>
<span><span class="va">mauricie_site_summary</span><span class="op">$</span><span class="va">n_species_scale</span> <span class="op">&lt;-</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/rescale.html" class="external-link">rescale</a></span><span class="op">(</span><span class="va">mauricie_site_summary</span><span class="op">$</span><span class="va">n_species</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Overlay mauricie_site_summary points</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">mauricie_site_summary</span><span class="op">)</span>, </span>
<span>     pch <span class="op">=</span> <span class="fl">19</span>,        <span class="co"># Solid circle</span></span>
<span>     col <span class="op">=</span> <span class="st">"black"</span>,   <span class="co"># Point color</span></span>
<span>     cex <span class="op">=</span> <span class="va">mauricie_site_summary</span><span class="op">$</span><span class="va">n_species_scale</span>, <span class="co"># Point size based on total</span></span>
<span>     reset <span class="op">=</span> <span class="cn">FALSE</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>      </span>
<span></span>
<span><span class="co"># Define legend values for the point size scale</span></span>
<span><span class="va">legend_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">mauricie_site_summary</span><span class="op">$</span><span class="va">n_species</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>                   <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">median</a></span><span class="op">(</span><span class="va">mauricie_site_summary</span><span class="op">$</span><span class="va">n_species</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">mauricie_site_summary</span><span class="op">$</span><span class="va">n_species</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">legend_sizes</span> <span class="op">&lt;-</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/rescale.html" class="external-link">rescale</a></span><span class="op">(</span><span class="va">legend_values</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add legend for the point size scale beside elevation scale</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,                     <span class="co"># Position</span></span>
<span>       inset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.10</span>, <span class="fl">0</span><span class="op">)</span>,            <span class="co"># Moves the legend outside the map extent</span></span>
<span>       legend <span class="op">=</span> <span class="va">legend_values</span>, </span>
<span>       pch <span class="op">=</span> <span class="fl">19</span>, col <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>       pt.cex <span class="op">=</span> <span class="va">legend_sizes</span>, </span>
<span>       title <span class="op">=</span> <span class="st">"Species Richness"</span>,</span>
<span>       title.cex <span class="op">=</span> <span class="fl">0.7</span>,                <span class="co"># Adjust legend title size</span></span>
<span>       bty <span class="op">=</span> <span class="st">"y"</span>,                      <span class="co"># Place box around legend</span></span>
<span>       xpd <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>                     <span class="co"># Allows placing legend outside the plot</span></span></code></pre></div>
<p><img src="figures%2Fnc_sp4_elevation_map-1.png" alt="Map depicts species diversity summary points and cropped DTM in La Mauricie National Park"></p>
<p>Rename the elevation raster layer.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dtm_crop</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"elevation"</span></span></code></pre></div>
<p>Extract elevation values for each bird observation record and append
it to <code>mauricie_birds</code>. First, make sure the CRS of both
spatial data match and then use <code>st_extract()</code>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Match the CRS</span></span>
<span><span class="va">mauricie_birds_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">mauricie_birds_sf</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">dtm_crop</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the elevation values for each site</span></span>
<span><span class="va">elevation_values_sf</span> <span class="op">&lt;-</span> <span class="fu">stars</span><span class="fu">::</span><span class="fu">st_extract</span><span class="op">(</span><span class="va">dtm_crop</span>, <span class="va">mauricie_birds_sf</span><span class="op">)</span></span></code></pre></div>
<p>Add in the data columns we want</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">elevation_values_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">elevation_values_sf</span>, </span>
<span>                                 <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">mauricie_birds_sf</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">SiteCode</span>, <span class="va">elevation</span><span class="op">)</span></span></code></pre></div>
<p>Assign a point id identifier to each location based on its unique
geometry and return the result as a dataframe.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">elevation_values_df</span> <span class="op">&lt;-</span> <span class="va">elevation_values_sf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">SiteCode</span>, <span class="va">geometry</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>point_id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">cur_group_id</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">point_id</span>, <span class="va">elevation</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  <span class="co"># drop the geometry column</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># convert to a regular dataframe</span></span>
<span></span>
<span></span>
<span><span class="co"># Note that usually the SiteCode is the unique identifier for each observation site. However, this was not the case for the Quebec Breeding Bird Atlas data. We therefore use the geometry to create a unique identifier for each point.</span></span></code></pre></div>
<p>OPTIONAL: To save the elevation data as a <em>.csv</em> to your disk,
use the <code><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv()</a></code> function, specify the name of your .csv
file, and use the row.names = FALSE argument to exclude row numbers from
the output. <strong>The extracted elevation values will be required to
complete <a href="07-SummaryTools.Rmd">Chapter 7: Summary
Tools</a></strong>. We have uploaded this file to the <a href="https://drive.google.com/drive/folders/1gLUC6fROl4kNBvTGselhZif-arPexZbY?usp=sharing" class="external-link"><strong>Google
Drive data folder</strong></a> for your convenience.</p>
<p>Create a subdirectory called <code>env_covariates</code> to neatly
store the output environmental data.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"data/env_covariates"</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>To execute this code chunk, remove the #</p>
</blockquote>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># write.csv(elevation_values_df, "data/env_covariates/elevation_values_df.csv", row.names = FALSE)</span></span></code></pre></div>
<p>Now, let’s combine the elevation dataframe with the NatureCounts
summary data you previously created in order to assess how elevation
influences your metric of species diversity.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mauricie_site_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">mauricie_site_summary</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">dtm_crop</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the elevation values for each site</span></span>
<span><span class="va">elevation_sitesum_sf</span> <span class="op">&lt;-</span> <span class="fu">stars</span><span class="fu">::</span><span class="fu">st_extract</span><span class="op">(</span><span class="va">dtm_crop</span>, <span class="va">mauricie_site_summary</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">mauricie_site_summary</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the relationship between elevation and species diversity </span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">elevation_sitesum_sf</span><span class="op">$</span><span class="va">elevation</span>, <span class="va">elevation_sitesum_sf</span><span class="op">$</span><span class="va">n_species</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"Elevation (m)"</span>, ylab <span class="op">=</span> <span class="st">"Number of Species"</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"Species Diversity vs. Elevation"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures%2Fnc_sp4_richness_plots_elevation-1.png" alt="Plot explores the relationship between species richness and elevation"></p>
<p>There does not appear to be a clear relationship between species
diversity and elevation in La Mauricie National Park.</p>
<hr>
<p><strong>Congratulations!</strong> You completed <strong>Chapter 4 -
Digital Elevation Data</strong>. In this chapter, you successfully 1)
processed raster DTM’s 2) performed cropping and masking procedures and
3) extracted elevation data over vector data points. In <a href="05-LandcoverData.Rmd">Chapter 5</a>, you will explore how to
extract unique pixel values from landcover data and link it to
NatureCounts data.</p>
<p>Below are some additional resources you may find useful to further
your understanding of LiDAR data.</p>
</div>
<div class="section level2">
<h2 id="id_4-5LiDAR">4.5 LiDAR Data Resources<a class="anchor" aria-label="anchor" href="#id_4-5LiDAR"></a>
</h2>
<p><a href="https://natural-resources.canada.ca/sites/nrcan/files/mapstoolspublications/lidar-Nov-2023-EN.pdf" class="external-link">LiDAR</a>
systems help produce extremely accurate measurements of surface
elevation to digital terrain and elevation models across landscapes.
These systems use instruments (sensors) that are commonly flown on
aircraft and incorporate laser ranging for distance, GPS for geographic
position and height, and aircraft altitude for the orientation of the
instrument. The accuracy of LiDAR measurements depends on the strength
of point returns, instrument precision &amp; accuracy, and terrain
characteristics, among other factors.</p>
<p><img src="figures_other%2Fspatdata11.png" alt="LiDAR infographic." width="700px" style="display: block; margin: auto;"></p>
<p>Conceptual figure depicts an airborne LiDAR system (‘LiDAR-i lend’,
<a href="https://commons.wikimedia.org/wiki/File:LiDAR-i_lend.gif" class="external-link">Marek9134
(2012)</a> CC-BY-SA-3.0).</p>
<p>As of June 2022, Natural Resources Canada has produced their largest
release of LiDAR-derived data made publicly available on <a href="https://search.open.canada.ca/openmap/957782bf-847c-4644-a757-e383c0057995" class="external-link">Open
Maps</a>. This data is complementary to previous CanElevation Series
products: the <a href="https://open.canada.ca/data/en/dataset/957782bf-847c-4644-a757-e383c0057995" class="external-link">HRDEM</a>
and <a href="https://open.canada.ca/data/en/dataset/0fe65119-e96e-4a57-8bfe-9d9245fba06b" class="external-link">HRDEM
Mosaic</a>. The HRDEM download procedure can be found <a href="https://ftp.maps.canada.ca/pub/elevation/dem_mne/highresolution_hauteresolution/HRDEM_Download_Instructions.pdf" class="external-link">here</a>.
Some notable open LiDAR data resources on the provincial-level include
<a href="https://lidar.gov.bc.ca/" class="external-link">LidarBC</a> - British Columbia and <a href="https://www.donneesquebec.ca/recherche/dataset/produits-derives-de-base-du-lidar" class="external-link">Forêt
ouverte</a> - Québec.</p>
<p>The USGS provides LiDAR and its derived products through the <a href="https://www.usgs.gov/tools/lidarexplorer" class="external-link">LidarExplorer</a> online
application. <a href="https://www.usgs.gov/programs/national-geospatial-program/national-map" class="external-link">The
National Map</a> also represents the primary repository for geospatial
data in the U.S.</p>
</div>
<div class="section level2">
<h2 id="id_4-6LiDAR">4.6 Manual Data Download<a class="anchor" aria-label="anchor" href="#id_4-6LiDAR"></a>
</h2>
<p>If you wish to access LiDAR data for La Mauricie National Park
yourself to gain experience with the process, follow the steps below.
The data are available on the <a href="https://www.donneesquebec.ca/recherche/dataset/produits-derives-de-base-du-lidar" class="external-link">Forêt
ouverte</a> platform.</p>
<p><strong>Step 1</strong>: Navigate to the Lidar data site. Under
<strong>Données et ressources</strong> &gt; <strong>Carte
interactive</strong> &gt; <strong>Forêt ouverte</strong> select
(<strong>Explorer &gt; Accéder</strong>) next to the
<strong>Téléchargement</strong> option to explore the Lidar tiles on an
interactive map .</p>
<p><img src="figures_other%2Fspatdata1.png" alt="Data download step 1." width="700px" style="display: block; margin: auto;"></p>
<p><strong>Step 2</strong>: Using the search bar, search for
<strong>Parc national de la Mauricie</strong>. Under Layers, toggle on
<strong>Parc nationaux du Canada</strong> to visualize the park
boundary.</p>
<p><img src="figures_other%2Fspatdata0.png" alt="Data download step 2." width="700px" style="display: block; margin: auto;"></p>
<p>Alternatively, you can import your own <strong>.shp</strong> or
<strong>.kml</strong> file using the <strong>Import and Export</strong>
tab.</p>
<p><img src="figures_other%2Fspatdata2.png" alt="Data download step 2." width="700px" style="display: block; margin: auto;"></p>
<p>Specify the coordinate reference system (WGS84), click
<strong>Import</strong>, and select your <strong>.shp</strong> or
<strong>.kml</strong> file to display on the map.</p>
<p><img src="figures_other%2Fspatdata3.png" alt="Data download step 2." width="700px" style="display: block; margin: auto;"></p>
<p><strong>Step 3</strong>: Download the Modèle num. terrain (MNT)
(Résolution spatiale 1 m) for each of the six Lidar tiles that intersect
with the park (14NE, 15NO, 14SE, 15SO, 11NE, 10NO).</p>
<p>First, navigate to the <strong>Map</strong> tab and toggle on the
visibility for the boundary and Lidar MNT layers by clicking on the eye
symbol, if necessary. Hovering over this icon will display either the
<strong>Show Layer</strong> or <strong>Hide layer</strong> option.</p>
<p><img src="figures_other%2Fspatdata4.png" alt="Data download step 3." width="700px" style="display: block; margin: auto;"></p>
<p>Your interactive map should now look something like this:</p>
<p><img src="figures_other%2Fspatdata5.png" alt="Data download step 3." width="700px" style="display: block; margin: auto;"></p>
<p>One by one, click and download the terrain data for each of the 6
Lidar tiles that intersect with the park boundary. Click your target
tile, expand the <strong>Téléchargement</strong> window and click
<strong>Accéder</strong> next to the MNT (1 m spatial resolution) data
to download. Repeat for each tile.</p>
<p><img src="figures_other%2Fspatdata6.png" alt="Data download step 3." width="700px" style="display: block; margin: auto;"></p>
<p>This will open a webpage directory displaying a list of spatial data
files available for the selected tile. Choose the MNT (.tif) file that
includes the tile code in its name. For instance, for the first tile
covering northern tip of the national park), select “MNT_31I14NE.tif.”
Repeat this process for each respective tile.</p>
<p><img src="figures_other%2Fspatdata10.png" alt="Data download step 3." width="700px" style="display: block; margin: auto;"></p>
<p>Save these files in your working directory for easy access during
this tutorial.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Steffi LaZerte, Denis Lepage.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
