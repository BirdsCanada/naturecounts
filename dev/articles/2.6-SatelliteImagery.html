<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 6 - Satellite Imagery • naturecounts</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Chapter 6 - Satellite Imagery">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">naturecounts</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.4.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/1.1-Introduction.html">Chapter 1 - Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/1.2-LoadPackage.html">Chapter 2 - Loading R Packages</a></li>
    <li><a class="dropdown-item" href="../articles/1.3-ViewData.html">Chapter 3 - Understanding and Viewing Data</a></li>
    <li><a class="dropdown-item" href="../articles/1.4-DownloadData.html">Chapter 4 - Downloading and Filtering Data</a></li>
    <li><a class="dropdown-item" href="../articles/1.5-ManipData.html">Chapter 5 - Data Manipulation</a></li>
    <li><a class="dropdown-item" href="../articles/1.6-VisualData.html">Chapter 6 - Data Visualization</a></li>
    <li><a class="dropdown-item" href="../articles/1.7-Answers.html">Chapter 7 - Answers</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BirdsCanada/naturecounts/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Chapter 6 - Satellite Imagery</h1>
            
            <h4 data-toc-skip class="date">2025-03-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/BirdsCanada/naturecounts/blob/docs-update/vignettes/articles/2.6-SatelliteImagery.Rmd" class="external-link"><code>vignettes/articles/2.6-SatelliteImagery.Rmd</code></a></small>
      <div class="d-none name"><code>2.6-SatelliteImagery.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="chapter-6-satellite-imagery">Chapter 6: Satellite Imagery<a class="anchor" aria-label="anchor" href="#chapter-6-satellite-imagery"></a>
</h2>
<div class="section level6">
<h6 id="authors-dimitrios-markou-danielle-ethier">Authors: Dimitrios Markou, Danielle Ethier<a class="anchor" aria-label="anchor" href="#authors-dimitrios-markou-danielle-ethier"></a>
</h6>
<blockquote>
<p>In <a href="05-LandcoverData.Rmd">Chapter 5</a>, you processed land
cover (raster) data, calculated landscape metrics derived from land
cover, and combined them with NatureCounts data. In this tutorial, you
will use satellite imagery from the Copernicus Sentinel-2 mission to
calculate spectral index values (NDVI, NDWI) over <a href="https://parks.canada.ca/pn-np/qc/mauricie/nature" class="external-link">La Mauricie
National Park</a> and combine these values to NatureCounts data from the
<a href="https://naturecounts.ca/nc/default/datasets.jsp?code=QCATLAS2PC&amp;sec=bmdr" class="external-link">Quebec
Breeding Bird Atlas (2010 - 2014)</a>.</p>
</blockquote>
<p>The Copernicus Sentinel-2 mission comprises twin satellites flying in
polar sun-synchronous orbit phased at 180° to each other. The satellites
carry multispectral sensors with 13 spectral bands and have a revisit
frequency of 5 days and orbital swath width of 290 km. Their high
resolution products support a variety of services and applications
including land management, agriculture, forestry, disaster control,
humanitarian relief operations, risk mapping, and security concerns.</p>
<p><strong>For this tutorial, complete section 4.1 Data Setup from <a href="04-ElevationData.Rmd">Chapter 4: Elevation Data</a>. It helps you
download the National Park boundary and NatureCounts data which are used
in this chapter. Alternatively, you can access these files in the <a href="https://drive.google.com/drive/folders/1gLUC6fROl4kNBvTGselhZif-arPexZbY?usp=sharing" class="external-link">Google
Drive data folder</a>.</strong></p>
</div>
</div>
<div class="section level2">
<h2 id="id_6-0LearningObjectives">6.0 Learning Objectives<a class="anchor" aria-label="anchor" href="#id_6-0LearningObjectives"></a>
</h2>
<p>By the end of <strong>Chapter 6 - Satellite Imagery</strong>, users
will know how to:</p>
<ul>
<li>Plot true and false color composites of satellite imagery: <a href="#id_6.1ColorComposites">Color Composite Images</a>
</li>
<li>Create digital water masks and calculate NDWI and NDVI indices: <a href="#id_6.2SpectralIndices">Calculate Spectral Indices</a>
</li>
<li>Combine NatureCounts data with spectral index values for analysis:
<a href="#id_6.3Map-Extract">Map &amp; Extract Spectral Indices</a>
</li>
<li>Explore and download satellite imagery data: <a href="#id_6.4CopernicusDataDownload">Copernicus Data Download</a>
</li>
</ul>
<p>Load the necessary packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/BirdsCanada/naturecounts" class="external-link">naturecounts</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<p>This tutorial uses the following spatial data.</p>
<ol style="list-style-type: decimal">
<li><p><a href="https://open.canada.ca/data/en/dataset/e1f0c975-f40c-4313-9be2-beb951e35f4e/resource/0744186a-449b-4f1f-9f1e-952a94c6d5ca" class="external-link">Places
administered by Parks Canada</a> - Boundary shapefiles</p></li>
<li><p><a href="https://naturecounts.ca/nc/default/datasets.jsp?code=QCATLAS2PC&amp;sec=bmdr" class="external-link">Quebec
Breeding Bird Atlas (2010 - 2014)</a> - NatureCounts bird
observations</p></li>
<li><p><a href="https://www.copernicus.eu/en" class="external-link">Copernicus</a> Satellite
Data - SENTINEL2 imagery</p></li>
</ol>
<p>Quick access to the Copernicus satellite data is also available
through <a href="https://drive.google.com/drive/folders/1gLUC6fROl4kNBvTGselhZif-arPexZbY?usp=sharing" class="external-link">Google
Drive</a>. Download and extract the <strong>copernicus_R10m</strong>
(.<em>zip)</em> file to your directory. If you wish to gain experience
in how-to access Copernicus satellite imagery yourself, follow the steps
<a href="#id_6.1CopernicusDataDownload">at the end of this
Chapter</a>.</p>
</div>
<div class="section level2">
<h2 id="id_6-1ColorComposites">6.1 Color Composite Images<a class="anchor" aria-label="anchor" href="#id_6-1ColorComposites"></a>
</h2>
<p>Multispectral sensors measure the amount of light energy reflected
off surface features. How this reflection occurs depends on factors like
the surface roughness of the object (relative to the wavelength of
energy) or the incidence angle at which the energy strikes. Every
surface material will have a distinct spectral signature which describes
the percentage of radiation reflected from an object at different
wavelengths.</p>
<p>For vegetation, spectral reflectance also depends on the structural
components of leaves: pigments like chrolophyll <em>a</em> &amp;
<em>b</em>, and beta-carotene in the palisade mesophyll (outer leaf),
near-infrared (NIR) scattering in the spongy mesophyll (inner leaf), and
water content. Healthy vegetation (<em>more chlorophyll, high water
content</em>) absorbs more visible light, reflects more NIR, and absorbs
more middle-infrared (MIR). These type of interactions are the basis for
calculating spectral indices, as explored in the <a href="#id_6.2SpectralIndices">next section</a>.</p>
<p>These interactions also mean that we can represent multispectral
imagery through color composites to strategically emphasize surface
properties using combinations of different bands (range of
wavelengths):</p>
<blockquote>
<p><strong>Natural (True) Color Composites</strong> - use visible red,
green, and blue (RGB) bands in their respective color channels to depict
what the human eye would naturally see.</p>
<p><strong>False Color Composites</strong> - use non-visible band like
NIR, MIR, or SWIR for RGB color channels to depict wavelengths invisible
to the naked eye. Different band combinations help highlight surface
features.</p>
</blockquote>
<p>Specify the path to your folder containing the satellite images in
the code chunk below. Each image represents a distinct band. If you
downloaded the data by following <a href="#id_6.3CopernicusDataDownload">Section 6.3</a>, look for the
folder labeled S2A_MSIL2A. Copy the file path to S2A_MSIL2A… &gt;
GRANULE &gt; L2A… &gt; IMG_DATA &gt; R10m which contains the satellite
images we will use here.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bands</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"misc/data/R10m"</span><span class="op">)</span>, <span class="co"># drop `here::here()` and specify the path to your folder</span></span>
<span>                    pattern <span class="op">=</span> <span class="st">"\\.jp2$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read all the bands into a raster stack </span></span>
<span><span class="va">sentinel_imagery</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">bands</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assign meaningful names to the bands</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sentinel_imagery</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AOT"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"red"</span>, <span class="st">"nir"</span>, <span class="st">"TCI_r"</span>, <span class="st">"TCI_g"</span>, <span class="st">"TCI_b"</span>, <span class="st">"WVP"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check the assigned names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sentinel_imagery</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "AOT"   "blue"  "green" "red"   "nir"   "TCI_r" "TCI_g" "TCI_b" "WVP"</span></span>
<span></span>
<span><span class="co"># Check resolution, number of layers, and extent</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">res</a></span><span class="op">(</span><span class="va">sentinel_imagery</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 10 10</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nlyr</a></span><span class="op">(</span><span class="va">sentinel_imagery</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 9</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">sentinel_imagery</span><span class="op">)</span></span>
<span><span class="co">#&gt; SpatExtent : 6e+05, 709800, 5090220, 5200020 (xmin, xmax, ymin, ymax)</span></span></code></pre></div>
<p>Read in the National Park boundary you saved or downloaded from <a href="04-ElevationData.Rmd">Chapter 4: Elevation Data</a>.</p>
<pre><code><span><span class="co">#&gt; Reading layer `mauricie_boundary' from data source `C:\Users\dimit\Birds Canada\naturecounts\misc\data\boundary\mauricie_boundary.shp' using driver `ESRI Shapefile'</span></span>
<span><span class="co">#&gt; Simple feature collection with 1 feature and 9 fields</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -73.17948 ymin: 46.64563 xmax: -72.76572 ymax: 46.91888</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mauricie_boundary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="st">"path/to/your/mauricie_boundary.shp"</span><span class="op">)</span></span></code></pre></div>
<p>Transform the coordinate reference system (CRS) of the National Park
boundary to match that of the <code>sentinel_imagery</code>
SpatRaster.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mauricie_boundary</span> <span class="op">&lt;-</span> <span class="va">mauricie_boundary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html" class="external-link">st_make_valid</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># fix performance issues with layer + faster computation</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">sentinel_imagery</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Crop <code>sentinel_imagery</code> to the extent of
<code>mauricie_boundary</code> then plot the cropped image in true
color.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mauricie_sl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">sentinel_imagery</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">mauricie_boundary</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the RGB composite</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plotRGB.html" class="external-link">plotRGB</a></span><span class="op">(</span><span class="va">mauricie_sl</span>, r <span class="op">=</span> <span class="fl">4</span>, g <span class="op">=</span> <span class="fl">3</span>, b <span class="op">=</span> <span class="fl">2</span>, stretch <span class="op">=</span> <span class="st">"lin"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add the boundary shapefile to the plot</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">mauricie_boundary</span><span class="op">)</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span><span class="st">"red"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures%2Fnc_sp6_true_color_comp-1.png" alt="Plot shows the cropped Mauricie park in true color."></p>
<p>Now plot the cropped image in false color. Here, we’ll use the
standard false color composite where red, green, and blue channels are
used to visualize NIR, red, and green respectively.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the false color composite</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plotRGB.html" class="external-link">plotRGB</a></span><span class="op">(</span><span class="va">mauricie_sl</span>, r <span class="op">=</span> <span class="fl">5</span>, g <span class="op">=</span> <span class="fl">4</span>, b <span class="op">=</span> <span class="fl">3</span>, stretch <span class="op">=</span> <span class="st">"lin"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add the boundary shapefile to the plot</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">mauricie_boundary</span><span class="op">)</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span><span class="st">"green"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures%2Fnc_sp6_false_color_comp-1.png" alt="Plot shows the cropped Mauricie park in false color."></p>
</div>
<div class="section level2">
<h2 id="id_6-2SpectralIndices">6.2 Calculate Spectral Indices<a class="anchor" aria-label="anchor" href="#id_6-2SpectralIndices"></a>
</h2>
<p>The Normalized Difference Vegetation Index (NDVI; <a href="https://link.springer.com/article/10.1007/s11676-020-01155-1" class="external-link">Huang
et al., 2021</a>) is a common proxy for primary productivity collected
using remote sensing. It is a measure of vegetation health that
describes the greenness and the density of vegetation captured in a
satellite image. Healthy vegetation will absorb most visible light and
reflect most near-infrared light, depending on its structural integrity
and the amount of chlorophyll found in its biomass.</p>
<p>The Normalized Difference Water Index (NDWI; <a href="https://www.tandfonline.com/doi/abs/10.1080/01431169608948714" class="external-link">McFeeters,
1996</a>) is a spectral index that can be used to detect water bodies
from multispectral imagery. <strong>NDWI</strong> can be used to create
a water mask which will help minimize the effect of water and avoid
skewed vegetation index values by removing water values from an image.
In other words, this will help make the calculation of NDVI more
accurate. Applying a <strong>mode</strong> filter to a water mask
creates more uniformity across the water by eliminating areas that might
be confused for other land cover types.</p>
<p>Annual cumulative NDVI has a strong positive relationship with
species richness and bird diversity over time, making it a useful
covariate to describe trends in NatureCounts data. In this section, we
will calculate two spectral indices: 1) NDWI to create a water mask and
2) NDVI as a measure of vegetation health.</p>
<p>Create a water mask using the following function:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>D</mi><mi>W</mi><mi>I</mi><mo>=</mo><mfrac><mrow><mi>G</mi><mi>R</mi><mi>E</mi><mi>E</mi><mi>N</mi><mo>−</mo><mi>N</mi><mi>I</mi><mi>R</mi></mrow><mrow><mi>G</mi><mi>R</mi><mi>E</mi><mi>E</mi><mi>N</mi><mo>+</mo><mi>N</mi><mi>I</mi><mi>R</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">NDWI = \frac{GREEN - NIR}{GREEN + NIR}</annotation></semantics></math></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calc_ndwi</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">green</span>, <span class="va">nir</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ndwi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">(</span><span class="va">green</span> <span class="op">-</span> <span class="va">nir</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">green</span> <span class="op">+</span> <span class="va">nir</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">ndwi</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Calculate NDWI</span></span>
<span><span class="va">mauricie_sl_ndwi</span> <span class="op">&lt;-</span> <span class="fu">calc_ndwi</span><span class="op">(</span><span class="va">mauricie_sl</span><span class="op">$</span><span class="va">green</span>, <span class="va">mauricie_sl</span><span class="op">$</span><span class="va">nir</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create water mask</span></span>
<span><span class="va">water_mask</span> <span class="op">&lt;-</span> <span class="va">mauricie_sl_ndwi</span> <span class="op">&gt;=</span> <span class="fl">0</span></span></code></pre></div>
<p>Plot NDWI and the water mask.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set up the plot area for 1 row and 2 columns</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot NDWI</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mauricie_sl_ndwi</span>, main <span class="op">=</span> <span class="st">"NDWI"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add National Park boundary</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">mauricie_boundary</span><span class="op">)</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span><span class="st">"red"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot water mask </span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">water_mask</span>, main <span class="op">=</span> <span class="st">"Water mask"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add National Park boundary</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">mauricie_boundary</span><span class="op">)</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span><span class="st">"red"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures%2Fnc_sp6_ndwi_water_mask-1.png" alt="Plot shows the Normalized Difference Water Index distribution and water mask for La Mauricie."></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Reset plotting layout to default</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Use the function <code><a href="https://rspatial.github.io/terra/reference/focal.html" class="external-link">focal()</a></code> to apply a convolution filter
returning the <strong>mode</strong> of each pixel of
<code>water_mask</code> in a 3 x 3 windows of equal weights (argument
<code>w = 3</code>). Name the output raster
<code>water_mask_mode</code>. The <em>mode</em> of a vector
<code>x</code> is the value that appears the most often in
<code>x</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_mode</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">na.rm</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">na.rm</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">ux</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">ux</span><span class="op">[</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">which.max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tabulate.html" class="external-link">tabulate</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">ux</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Calculate <code>water_mask_mode</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">water_mask_mode</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/focal.html" class="external-link">focal</a></span><span class="op">(</span><span class="va">water_mask</span>, w <span class="op">=</span> <span class="fl">3</span>, fun <span class="op">=</span> <span class="va">get_mode</span><span class="op">)</span></span></code></pre></div>
<p>Combine the <code>water_mask</code> and
<code>water_mask_mode</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">water_mask_combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">water_mask</span>, <span class="va">water_mask_mode</span><span class="op">)</span></span></code></pre></div>
<p>Assign meaningful names to each raster mask and plot them.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">water_mask_combined</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"water mask"</span>, <span class="st">"water mask mode"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">water_mask_combined</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures%2Fnc_sp6_water_mask_combo-1.png" alt="Plot shows the difference between the water mask and water mask mode images of La Mauricie park."></p>
<blockquote>
<p>Look very closely at the side-by-side depictions of the water mask
and water mask mode above. Notice how some tiny yellow areas previously
identified as water in the water mask extent are now absent from the
water mask mode extent?</p>
</blockquote>
<p>Apply the <code>water_mask_mode</code> to
<code>mauricie_sl</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>mauricie_sl_water_mask <span class="ot">&lt;-</span> <span class="fu">mask</span>(mauricie_sl, water_mask_mode, <span class="at">maskvalues =</span> <span class="dv">1</span>)</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="sc">|---------</span><span class="er">|</span><span class="sc">---------</span><span class="er">|</span><span class="sc">---------</span><span class="er">|</span><span class="sc">---------</span><span class="er">|</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="er">=========================================</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>                                          </span></code></pre></div>
<p>Apply another mask to assign NA values to those pixels outside of the
National Park boundary.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>mauricie_sl_mask <span class="ot">&lt;-</span> <span class="fu">mask</span>(mauricie_sl_water_mask, <span class="fu">vect</span>(mauricie_boundary))</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="sc">|---------</span><span class="er">|</span><span class="sc">---------</span><span class="er">|</span><span class="sc">---------</span><span class="er">|</span><span class="sc">---------</span><span class="er">|</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="er">=========================================</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>                                          </span></code></pre></div>
<p>Plot a true color composite of <code>mauricie_sl_mask</code> and the
National Park boundary.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot RGB with both water and boundary masks applied</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plotRGB.html" class="external-link">plotRGB</a></span><span class="op">(</span><span class="va">mauricie_sl_mask</span>, r <span class="op">=</span> <span class="fl">4</span>, g <span class="op">=</span> <span class="fl">3</span>, b <span class="op">=</span> <span class="fl">2</span>, stretch <span class="op">=</span> <span class="st">"lin"</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add the National Park boundary</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">mauricie_boundary</span><span class="op">)</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span><span class="st">"red"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures%2Fnc_sp6_true_color_mask-1.png" alt="Plot depicts a true color composite image of the masked National Park boundary area."></p>
<p>To calculate NDVI, we will create and apply the following function on
the masked satellite image:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>D</mi><mi>V</mi><mi>I</mi><mo>=</mo><mfrac><mrow><mi>N</mi><mi>I</mi><mi>R</mi><mo>−</mo><mi>R</mi><mi>E</mi><mi>D</mi></mrow><mrow><mi>N</mi><mi>I</mi><mi>R</mi><mo>+</mo><mi>R</mi><mi>E</mi><mi>D</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">NDVI = \frac{NIR - RED}{NIR + RED}</annotation></semantics></math></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calc_ndvi</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">nir</span>, <span class="va">red</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ndvi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">(</span><span class="va">nir</span> <span class="op">-</span> <span class="va">red</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">nir</span>  <span class="op">+</span> <span class="va">red</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">ndvi</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Calculate NDVI </span></span>
<span><span class="va">mauricie_sl_ndvi</span> <span class="op">&lt;-</span> <span class="fu">calc_ndvi</span><span class="op">(</span><span class="va">mauricie_sl_mask</span><span class="op">$</span><span class="va">nir</span>, <span class="va">mauricie_sl_mask</span><span class="op">$</span><span class="va">red</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="id_6-3Map-Extract">6.3 Map &amp; Extract Spectral Indices<a class="anchor" aria-label="anchor" href="#id_6-3Map-Extract"></a>
</h2>
<p>Plot <code>mauricie_sl_ndvi</code> and the National Park
boundary.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot NDVI</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mauricie_sl_ndvi</span>, main <span class="op">=</span> <span class="st">"NDVI values across La Mauricie National Park"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add the National Park boundary</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">mauricie_boundary</span><span class="op">)</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span><span class="st">"red"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures%2Fnc_sp6_ndvi_plot-1.png" alt="Plot shows the NDVI values within La Mauricie park."></p>
<p>Rename the NDVI raster layer.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mauricie_sl_ndvi</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"ndvi"</span></span></code></pre></div>
<p>Read in the NatureCounts data you saved or downloaded from <a href="04-ElevationData.Rmd">Chapter 4: Elevation Data</a> or the <a href="https://drive.google.com/drive/folders/1gLUC6fROl4kNBvTGselhZif-arPexZbY?usp=sharing" class="external-link">Google
Drive</a> data folder.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mauricie_birds_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"path/to/your/mauricie_birds_df.csv"</span><span class="op">)</span></span></code></pre></div>
<p>To convert the NatureCounts data to a spatial object and transform
its CRS to match the National Park boundary we can use the
<code><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf()</a></code> and <code><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform()</a></code> functions,
respectively.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mauricie_birds_sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">mauricie_birds_df</span>, </span>
<span>                        coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span>              <span class="co"># convert to sf object</span></span>
<span></span>
<span><span class="va">mauricie_boundary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">mauricie_boundary</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">mauricie_birds_sf</span><span class="op">)</span><span class="op">)</span> <span class="co"># match the CRS</span></span></code></pre></div>
<p>Transform the CRS of the National Park boundary to match the
NatureCounts data.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mauricie_boundary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">mauricie_boundary</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">mauricie_birds_sf</span><span class="op">)</span><span class="op">)</span> <span class="co"># match the CRS</span></span></code></pre></div>
<p>Summarize the NatureCounts data for mapping. Here we will determine
the number of species observed at each site like we did in <a href="04-ElevationData.Rmd">Chapter 4</a> and <a href="05-LandcoverData.Rmd">Chapter 5</a>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Group by SiteCode and summarize mean annual count across all species</span></span>
<span><span class="va">mauricie_site_summary</span> <span class="op">&lt;-</span> <span class="va">mauricie_birds_sf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">SiteCode</span>, <span class="va">geometry</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n_species <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">english_name</span><span class="op">)</span><span class="op">)</span> <span class="co"># count the number of unique species</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'SiteCode'. You can override using the `.groups` argument.</span></span></code></pre></div>
<p>To map NatureCounts species richness and NDVI data:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Match the CRS</span></span>
<span><span class="va">mauricie_site_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">mauricie_site_summary</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">mauricie_sl_ndvi</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the dtm_mask raster</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mauricie_sl_ndvi</span>, main <span class="op">=</span> <span class="st">"NDVI with Species Diversity Summary Points across La Mauricie"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Overlay the National Park boundary in red</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">mauricie_boundary</span><span class="op">)</span>, col <span class="op">=</span> <span class="cn">NA</span>, border <span class="op">=</span> <span class="st">"red"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#scale the n_species column to range from 0-5 for plotting</span></span>
<span><span class="va">mauricie_site_summary</span><span class="op">$</span><span class="va">n_species_scale</span> <span class="op">&lt;-</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/rescale.html" class="external-link">rescale</a></span><span class="op">(</span><span class="va">mauricie_site_summary</span><span class="op">$</span><span class="va">n_species</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Overlay mauricie_site_summary points</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">mauricie_site_summary</span><span class="op">)</span>, </span>
<span>     add <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>     pch <span class="op">=</span> <span class="fl">19</span>,       <span class="co"># Solid circle</span></span>
<span>     col <span class="op">=</span> <span class="st">"black"</span>,   <span class="co"># Point color</span></span>
<span>     cex <span class="op">=</span> <span class="va">mauricie_site_summary</span><span class="op">$</span><span class="va">n_species_scale</span><span class="op">)</span>      <span class="co"># Point size based on total</span></span>
<span></span>
<span><span class="co"># Define legend values for the point size scale</span></span>
<span><span class="va">legend_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">mauricie_site_summary</span><span class="op">$</span><span class="va">n_species</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>                   <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">median</a></span><span class="op">(</span><span class="va">mauricie_site_summary</span><span class="op">$</span><span class="va">n_species</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">mauricie_site_summary</span><span class="op">$</span><span class="va">n_species</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">legend_sizes</span> <span class="op">&lt;-</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/rescale.html" class="external-link">rescale</a></span><span class="op">(</span><span class="va">legend_values</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add legend for the point size scale beside NDVI scale</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,                     <span class="co"># Position</span></span>
<span>       inset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.12</span>, <span class="fl">0</span><span class="op">)</span>,            <span class="co"># Moves the legend outside the map extent</span></span>
<span>       legend <span class="op">=</span> <span class="va">legend_values</span>, </span>
<span>       pch <span class="op">=</span> <span class="fl">19</span>, col <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>       pt.cex <span class="op">=</span> <span class="va">legend_sizes</span>, </span>
<span>       title <span class="op">=</span> <span class="st">"Species Richness"</span>,</span>
<span>       title.cex <span class="op">=</span> <span class="fl">0.6</span>,                <span class="co"># Adjust legend title size</span></span>
<span>       bty <span class="op">=</span> <span class="st">"y"</span>,                      <span class="co"># Place box around legend</span></span>
<span>       xpd <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>                     <span class="co"># Allows placing legend outside the plot</span></span></code></pre></div>
<p><img src="figures%2Fnc_sp6_ndvi_map-1.png" alt="Map depicts species diversity summary points and NDVI values in La Mauricie National Park"></p>
<p>Extract NDVI values for each survey site and append it to
<code>mauricie_birds</code>. First, make sure the CRS of both spatial
data match and then use <code><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">terra::extract()</a></code>.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mauricie_birds_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">mauricie_birds_sf</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">mauricie_sl_ndvi</span><span class="op">)</span><span class="op">)</span> <span class="co"># Match the CRS</span></span>
<span></span>
<span><span class="va">ndvi_values_sv</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">mauricie_sl_ndvi</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">mauricie_birds_sf</span><span class="op">)</span>, bind <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># Extracts the NDVI values for each point</span></span></code></pre></div>
<p>Convert the SpatVector containing the elevation values to an
<code>sf</code> object.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ndvi_values_sf</span> <span class="op">&lt;-</span> <span class="va">ndvi_values_sv</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># converts to sf object</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">SiteCode</span>, <span class="va">ndvi</span>, <span class="va">geometry</span><span class="op">)</span> <span class="co"># select relevant columns</span></span></code></pre></div>
<p>Assign a point id identifier to each location based on its unique
geometry and return the result as a dataframe.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ndvi_values_df</span> <span class="op">&lt;-</span> <span class="va">ndvi_values_sf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">SiteCode</span>, <span class="va">geometry</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>point_id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">cur_group_id</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">point_id</span>, <span class="va">ndvi</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  <span class="co"># drop the geometry column</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># convert to a regular dataframe</span></span>
<span></span>
<span></span>
<span><span class="co"># Note that usually the SiteCode is the unique identifier for each observation site. However, this was not the case for the Quebec Breeding Bird Atlas data. We therefore use the geometry to create a unique identifier for each point.</span></span></code></pre></div>
<p>OPTIONAL: To save the NDVI data as a <em>.csv</em> to your disk, use
the <code><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv()</a></code> function, specify the name of your .csv
file, and use the row.names = FALSE argument to exclude row numbers from
the output. <strong>The extracted NDVI values will be used in <a href="07-SummaryTools.Rmd">Chapter 7: Summary Tools</a></strong> We have
uploaded this file to the <a href="https://drive.google.com/drive/folders/1gLUC6fROl4kNBvTGselhZif-arPexZbY?usp=sharing" class="external-link"><strong>Google
Drive data folder</strong></a> for your convenience.</p>
<blockquote>
<p>To execute this code chunk, remove the #</p>
</blockquote>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># write.csv(ndvi_values_df, "data/env_covariates/ndvi_values_df.csv", row.names = FALSE)</span></span></code></pre></div>
<p>Now, let’s combine the NDVI dataframe with the NatureCounts summary
data you previously created in order to assess how NDVI influences your
metric of species diversity.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mauricie_site_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">mauricie_site_summary</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">mauricie_sl_ndvi</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the elevation values for each site</span></span>
<span><span class="va">ndvi_sitesum_sf</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">mauricie_sl_ndvi</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">mauricie_site_summary</span><span class="op">)</span>, bind <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the relationship between ndvi and species diversity </span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ndvi_sitesum_sf</span><span class="op">$</span><span class="va">ndvi</span>, <span class="va">ndvi_sitesum_sf</span><span class="op">$</span><span class="va">n_species</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"NDVI"</span>, ylab <span class="op">=</span> <span class="st">"Number of Species"</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"Species Diversity vs. NDVI"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures%2Fnc_sp6_richness_plots_ndvi-1.png" alt="Plot explores the relationship between species richness and NDVI"></p>
<p>Overall, the number of observations increases with NDVI. Areas of La
Mauricie National Park with better vegetation health seem to have a
slightly higher number of species however this relationship does not
appear to be strong.</p>
<hr>
<p><strong>Congratulations</strong>! You completed <strong>Chapter 6 -
Satellite Imagery</strong>. In this chapter, you successfully calculated
NDVI and NDWI spectral indices and extracted spectral index values over
vector data points. In <a href="07-SummaryTools.Rmd">Chapter 7</a>, you
can explore simple functions that will help you reclassify raster
objects and calculate raster summary statistics.</p>
</div>
<div class="section level2">
<h2 id="id_6-4CopernicusDataDownload">6.4 Copernicus Data Download<a class="anchor" aria-label="anchor" href="#id_6-4CopernicusDataDownload"></a>
</h2>
<p>The Copernicus Data Space Ecosystem Browser is the central hub for
accessing and exploring Earth observation and environmental data from
Copernicus satellites. You can <a href="https://documentation.dataspace.copernicus.eu/Registration.html" class="external-link">register</a>
for an account, read more <a href="https://documentation.dataspace.copernicus.eu/Applications/Browser.html#product-search" class="external-link">About
the Browser</a> (including <a href="https://documentation.dataspace.copernicus.eu/Applications/Browser.html#product-search" class="external-link">Product
Search</a>), and navigate to the <a href="https://browser.dataspace.copernicus.eu/?zoom=5&amp;lat=50.16282&amp;lng=20.78613&amp;visualizationUrl=U2FsdGVkX18pLKFF9fc91CA1u22Ai6SDDnfmD7NKnUTo9VEy0zAaaijJiGeg0RjaXy7sLHZpigJffz1REZVnF3BP1%2BaRJ8UQRjPdH4g5mSZmR4tNPleYMpU5qikJ2VAP&amp;datasetId=S2_L2A_CDAS&amp;demSource3D=%22MAPZEN%22&amp;cloudCoverage=30&amp;dateMode=SINGLE" class="external-link">Browser</a>
to continue with this tutorial.</p>
<ol style="list-style-type: decimal">
<li><p>Hover over the <strong>Create an area of interest</strong> tab,
symbolized by the pentagon shape in the upper righthand corner. Then,
select the <strong>Upload a file to create an area of interest</strong>
option, represented by the upward arrow on the pop out submenu. Upload
the KML National Park boundary file we created in Chapter 4, section 4.1
or grab it from the repository (data/mauricie).</p></li>
<li>
<p>In the <strong>Search</strong> tab (top, left side of window),
under <strong>Search Criteria</strong>, copy and paste the name of the
SENTINEL-2 image described below. Alternatively, you can select any
other image relevant to your research. Note that cloud cover will affect
our ability to calculate spectral indices so be mindful of this when
selecting your image and adjust your study area or time range
accordingly.</p>
<p><strong>Name</strong>:
S2A_MSIL2A_20200619T154911_N0500_R054_T18TXS_20230428T011527.SAFE</p>
<p><strong>Size</strong>: 1090MB</p>
<p><strong>Sensing time</strong>: 2020-06-19T15:49:11.024000Z</p>
<p><strong>Platform short name</strong>: SENTINEL-2</p>
<p><strong>Instrument short name</strong>: MSI</p>
</li>
<li><p>Click the info icon in the bottom right corner of your search
result and the <strong>Product info</strong> window will pop up. Once
here, verify that you have selected the satellite image you want and
then download it by clicking the <strong>Download</strong> option in the
lower righthand corner.</p></li>
</ol>
<p><img src="figures_other%2Fspatdata7.png" alt="Data download step 3." width="700px" style="display: block; margin: auto;"></p>
<p><img src="figures_other%2Fspatdata8.png" alt="Data download step 3." width="700px" style="display: block; margin: auto;"></p>
<p>Note: The <strong>Visualize</strong> tab will help you visualize your
satellite image using true color and false color composites and NDVI,
among other layers. These are based on a combination of bands stored in
our image download. This tutorial will guide you through custom
satellite image visualizations and spectral index calculation with
corrections.</p>
<p><img src="figures_other%2Fspatdata9.png" alt="Data download step 3." width="700px" style="display: block; margin: auto;"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Steffi LaZerte, Denis Lepage.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
