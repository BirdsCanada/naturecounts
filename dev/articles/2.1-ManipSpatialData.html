<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 1 - Manipulating Spatial Data in R • naturecounts</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Chapter 1 - Manipulating Spatial Data in R">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">naturecounts</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.4.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BirdsCanada/naturecounts/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Chapter 1 - Manipulating Spatial Data in R</h1>
                        <h4 data-toc-skip class="author">Dimitrios
Markou</h4>
            
            <h4 data-toc-skip class="date">2024-10-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/BirdsCanada/naturecounts/blob/docs-update/vignettes/articles/2.1-ManipSpatialData.Rmd" class="external-link"><code>vignettes/articles/2.1-ManipSpatialData.Rmd</code></a></small>
      <div class="d-none name"><code>2.1-ManipSpatialData.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="chapter-1-manipulating-spatial-data">Chapter 1: Manipulating Spatial Data<a class="anchor" aria-label="anchor" href="#chapter-1-manipulating-spatial-data"></a>
</h2>
<div class="section level6">
<h6 id="author-dimitrios-markou">Author: Dimitrios Markou<a class="anchor" aria-label="anchor" href="#author-dimitrios-markou"></a>
</h6>
<p>Mapping the spatial distribution of avian and environmental data is
critical to our understanding of ecological processes. Conservation
actions are most effective when focused on areas of ecological
importance. These areas typically host high levels of biodiversity,
concentrations of rare species, or species at risk.</p>
<p>By integrating NatureCounts data with spatial and environmental
layers, researchers can address key questions and prioritize future
conservation strategies over broad spatial and temporal scales. The <a href="https://github.com/BirdsCanada/NatureCounts_SpatialData_Tutorial" class="external-link">NatureCounts_SpatialData_Tutorial</a>
serves as a guide on how to visualize and analyse NatureCounts, spatial,
and environmental data in R to help users meet their conservation and
research goals.</p>
</div>
</div>
<div class="section level2">
<h2 id="learning-objectives">1.0 Learning Objectives<a class="anchor" aria-label="anchor" href="#learning-objectives"></a>
</h2>
<p>By the end of <strong>Chapter 1 - Manipulating Spatial Data</strong>,
users will know how to:</p>
<ul>
<li><p>Visualize NatureCounts data using spatio-temporal maps</p></li>
<li><p>Distinguish between types of spatial data (vector vs
raster)</p></li>
<li><p>Read and preprocess spatial vector data in R</p></li>
<li><p>Apply basic geoprocessing functions to spatial objects</p></li>
<li><p>Visualize NatureCounts data within areas of significant
conservation potential: <a href="https://kbacanada.org/about/" class="external-link">Key
Biodiversity Areas (KBAs)</a> and <a href="https://environmental-maps.canada.ca/CWS_Storylines/index-ca-en.html#/en/priority_places-lieux_prioritaires" class="external-link">Priority
Places for Species at Risk</a>.</p></li>
</ul>
<p>This R tutorial requires the following <strong>packages</strong>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/BirdsCanada/naturecounts" class="external-link">naturecounts</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://paleolimbot.github.io/ggspatial/" class="external-link">ggspatial</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/mapview" class="external-link">mapview</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/" class="external-link">leaflet</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/trafficonese/leaflet.extras" class="external-link">leaflet.extras</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet.providers/" class="external-link">leaflet.providers</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="spatial-data">1.1 Spatial Data<a class="anchor" aria-label="anchor" href="#spatial-data"></a>
</h2>
<p>Spatial data is any type of vector or raster data that represents a
feature or phenomena across geographic space.</p>
<div class="line-block">Vector data is used to represent features with
points, lines and polygons. This may include individual bird
observations, rivers, or conservation area boundaries.</div>
<div class="line-block">Raster data is used to represent spatially
continuous data with a grid, where each cell has one value. This may
include types of environmental data like elevation or temperature.</div>
<p>The most common format used to store vector data in a file on disk is
the <strong>ESRI Shapefile</strong> format <em>(.shp)</em>. Shapefiles
are always accompanied by files with <em>.dbf</em>, <em>.shx,</em> and
<em>.prj</em> extensions.</p>
<p>Raster data files are typically stored with TIFF or GeoTIFF files
with a <em>(.tif)</em> or <em>(.tiff)</em> extension. Raster data
manipulation will be in covered in subsequent chapters (see
02-ClimateData and 03-EnvironmentalData).</p>
<p>The data used in this tutorial are downloaded from NatureCounts using
R, the <a href="https://kbacanada.org/explore/map-viewer/" class="external-link">KBA Canada
Map Viewer</a>, and the <a href="https://open.canada.ca/data/en/dataset/91219d24-e877-4c8a-8bd2-b2b662e573e0" class="external-link">Priority
Places - Open Government Portal</a>.</p>
</div>
<div class="section level2">
<h2 id="spatio-temporal-mapping">1.2 Spatio-temporal mapping<a class="anchor" aria-label="anchor" href="#spatio-temporal-mapping"></a>
</h2>
<p>To download NatureCounts data you need to <a href="https://naturecounts.ca/nc/default/register.jsp" class="external-link">sign up</a> for a
<strong>free</strong> account.</p>
<blockquote>
<p>The data download will not work unless you replace
<code>"testuser"</code> with your actual user name. You will be prompted
to enter your password.</p>
</blockquote>
<p><em>Example 1</em>: You would like to visualize the spatio-temporal
distribution of Cedar Waxwing observations in June of each survey year
using data from the Maritimes Breeding Bird Atlas (2006-2010).</p>
<p>The <a href="#link">NatureCounts Introductory R Tutorial</a> is where
you should start if you’re new to the <code>naturecounts</code> R
package. It explains how to view, filter, manipulate, and visualize
NatureCounts data. We recommend reviewing this tutorial before
proceeding.</p>
<p>Let’s fetch the NatureCounts data.</p>
<p>First, we look to find the <code>collection</code> code for the
Maritimes Breeding Bird Atlas.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">collections</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/meta.html">meta_collections</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="fu"><a href="../reference/meta.html">meta_collections</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Second, we look to find the numeric species id.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/search_species.html">search_species</a></span><span class="op">(</span><span class="st">"cedar waxwing"</span><span class="op">)</span></span></code></pre></div>
<p>Now we can download the data. Don’t forget to change the
<code>username</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cedar_waxwing</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nc_data_dl.html">nc_data_dl</a></span><span class="op">(</span>collections <span class="op">=</span> <span class="st">"MBBA2PC"</span>, species <span class="op">=</span> <span class="fl">16330</span>, username <span class="op">=</span> <span class="st">"testuser"</span>, info <span class="op">=</span> <span class="st">"spatial_data_tutorial"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using filters: collections (MBBA2PC); species (16330); fields_set (BMDE2.00-min)</span></span>
<span><span class="co">#&gt; Collecting available records...</span></span>
<span><span class="co">#&gt;   collection nrecords</span></span>
<span><span class="co">#&gt; 1    MBBA2PC     1659</span></span>
<span><span class="co">#&gt; Total records: 1,659</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Downloading records for each collection:</span></span>
<span><span class="co">#&gt;   MBBA2PC</span></span>
<span><span class="co">#&gt;     Records 1 to 1659 / 1659</span></span></code></pre></div>
<p>Use the <code>format_dates</code> function to create date and
day-of-year (doy) columns.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cedar_waxwing</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/format_dates.html">format_dates</a></span><span class="op">(</span><span class="va">cedar_waxwing</span><span class="op">)</span></span></code></pre></div>
<p>Filter the data to only include observations from the month of
June.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cedar_waxwing_june</span> <span class="op">&lt;-</span> <span class="va">cedar_waxwing</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">survey_month</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<p>Convert the NatureCounts data to a spatial object using the point
count coordinates.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cedar_waxwing_june_sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">cedar_waxwing_june</span>,</span>
<span>                        coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span></code></pre></div>
<p>Finally, use <code>ggplot2</code> to visualize the spatio-temporal
distribution of Cedar Waxwing observations across the Maritime provinces
by color-coding the data points by <strong>survey_year</strong> and
creating a multi-panel plot based on this discrete variable:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cedar_waxwing_june_sf</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Select a basemap</span></span>
<span>  <span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_map_tile.html" class="external-link">annotation_map_tile</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"cartolight"</span>, zoom <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Plot the points, color-coded by survey_year</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/is.bool.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">survey_year</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Facet by survey_year to create the multi-paneled map</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">survey_year</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Customize the color scale</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span>, name <span class="op">=</span> <span class="st">"Survey Year"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Add a theme with a minimal design and change the font styles, to your preference</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># To make the points in the legend larger without affecting map points</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Define the title and axis names</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Cedar Waxwing June Observations by Survey Year"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Longitude"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Latitude"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Zoom: 5</span></span>
<span><span class="co">#&gt; Zoom: 5</span></span>
<span><span class="co">#&gt; Zoom: 5</span></span>
<span><span class="co">#&gt; Zoom: 5</span></span>
<span><span class="co">#&gt; Zoom: 5</span></span></code></pre></div>
<div class="float">
<img src="figures%2Fspatdatatutorial_cedarwaxwing_map-1.png" alt="plot of chunk cedarwaxwing_map"><div class="figcaption">plot of chunk cedarwaxwing_map</div>
</div>
<p>The map above provides a simple visualization of NatureCounts data
over a broad spatial and temporal scale. However, mapping data in
specific areas of ecological importance might also be relevant to your
work. The following sections (<strong>1.3</strong> -
<strong>1.7</strong>) work in sequence to help the user visualize
NatureCounts data using <a href="https://kbacanada.org/about/" class="external-link">Key
Biodiversity Areas (KBAs)</a> and <a href="https://environmental-maps.canada.ca/CWS_Storylines/index-ca-en.html#/en/priority_places-lieux_prioritaires" class="external-link">Priority
Places for Species at Risk</a> maps.</p>
</div>
<div class="section level2">
<h2 id="reading-in-spatial-data">1.3 Reading in spatial data<a class="anchor" aria-label="anchor" href="#reading-in-spatial-data"></a>
</h2>
<p>The <code>sf</code> package provides <a href="https://r-spatial.github.io/sf/" class="external-link">simple feature</a> access in R.
This package works best with spatial data (point, line, polygon,
multipolygon, etc) associated with tabular attributes (e.g shapefiles).
You may be familiar with the <code>sp</code> package that has similar
functionality in a different format, however, this package is no longer
in use as of 2023 and does not support integration with
<code>tidyverse</code> which is very popular among data scientists in
R.</p>
<p><em>Example 2</em>: You want to assess the spatial distribution of
Wood Ducks across the KBA’s in Ontario using Ontario Breeding Bird Atlas
data. Navigate to the <a href="https://kbacanada.org/explore/map-viewer/" class="external-link">KBA Canada Map
Viewer</a>, search for all the KBA’s in Ontario, and download the .shp
and .csv file to your working directory.</p>
<p>To view your working directory.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>It helps if you assign these files a meaningful name! We can read in
our KBA polygons using the <code>sf</code> package once it is in your
working directory.</p>
<pre><code><span><span class="co">#&gt; Reading layer `ontario_kba' from data source </span></span>
<span><span class="co">#&gt;   `/home/steffi/Projects/Business/Birds Canada/NatureCounts/naturecounts/misc/Data/kba/provontario_kba/ontario_kba.shp' </span></span>
<span><span class="co">#&gt;   using driver `ESRI Shapefile'</span></span>
<span><span class="co">#&gt; Simple feature collection with 198 features and 8 fields</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -94.52593 ymin: 42.22596 xmax: -75.79267 ymax: 51.95705</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ontario_kba</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="st">"ontario_kba.shp"</span><span class="op">)</span></span></code></pre></div>
<p><code>sf</code> objects are stored in R as a spatial dataframe which
contains the attribute table of the vector along with the geometry type.
When we examine the dataframe, it looks like there are many duplicate
entries including duplicate geometries (vertices). To clean this up, we
can apply the <code><a href="https://r-spatial.github.io/sf/reference/valid.html" class="external-link">st_make_valid()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct()</a></code>
functions to our spatial dataframe:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ontario_kba</span> <span class="op">&lt;-</span> <span class="va">ontario_kba</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html" class="external-link">st_make_valid</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Our spatial data is also accompanied by a CSV file that contains
additional useful attributes (landcover, species, etc) concerning our
KBAs. Let’s read in the accompanying CSV file for our KBA layer.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kba_attributes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"ontario_kba.csv"</span><span class="op">)</span></span></code></pre></div>
<p>Great! We can now join these dataframes using the handy
<code>tidyverse</code> package. However, we’ll want to select for
specific columns first to avoid redundancies before performing our
join:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kba_attributes</span> <span class="op">&lt;-</span> <span class="va">kba_attributes</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="st">"SiteCode"</span>,</span>
<span>         <span class="st">"DateAssessed"</span>,</span>
<span>         <span class="st">"PercentProtected"</span>,</span>
<span>         <span class="st">"BoundaryGeneralized"</span>,</span>
<span>         <span class="st">"Level"</span>,</span>
<span>         <span class="st">"CriteriaMet"</span>,</span>
<span>         <span class="st">"ConservationActions"</span>,</span>
<span>         <span class="st">"Landcover"</span>,</span>
<span>         <span class="st">"Province"</span>,</span>
<span>         <span class="st">"Species"</span><span class="op">)</span></span></code></pre></div>
<p>Both dataframes now contain unique columns, after our selection. We
apply the <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join()</a></code> function to hold all attributes
within one dataframe.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ontario_kba</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">ontario_kba</span>, <span class="va">kba_attributes</span>, by <span class="op">=</span> <span class="st">"SiteCode"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualizing-spatial-data-in-r">1.4 Visualizing spatial data in R<a class="anchor" aria-label="anchor" href="#visualizing-spatial-data-in-r"></a>
</h2>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Select the basemap</span></span>
<span>  <span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_map_tile.html" class="external-link">annotation_map_tile</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"cartolight"</span>, zoom <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Add the polygon data</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ontario_kba</span>, fill <span class="op">=</span> <span class="st">"red"</span>, color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>          size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Add the map components</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Ontario KBAs"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottomright"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Key Biodiversity Areas (KBAs) of Ontario"</span> ,</span>
<span>       x <span class="op">=</span> <span class="st">"Longitude"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Latitude"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Zoom: 4</span></span></code></pre></div>
<p><img src="figures%2Fspatdatatutorial_ontario_kbas-1.png" alt="test1"></p>
<p>We can visualize the <strong>ontario_kba</strong> data with an
interactive map, using the <code>leaflet</code> package.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rstudio.github.io/leaflet/reference/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span>width <span class="op">=</span> <span class="st">"100%"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addTiles</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addPolygons</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">ontario_kba</span>,color <span class="op">=</span> <span class="st">"black"</span>, weight <span class="op">=</span> <span class="fl">2</span>, smoothFactor <span class="op">=</span> <span class="fl">1</span>,opacity <span class="op">=</span> <span class="fl">1.0</span>, fillOpacity <span class="op">=</span> <span class="fl">0.5</span>, fillColor <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://trafficonese.github.io/leaflet.extras/reference/fullscreen.html" class="external-link">addFullscreenControl</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/addLegend.html" class="external-link">addLegend</a></span><span class="op">(</span>colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span><span class="op">)</span>,labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Ontario KBAs"</span><span class="op">)</span>,position <span class="op">=</span> <span class="st">"bottomright"</span><span class="op">)</span></span></code></pre></div>
<p>Similarly, the package <code>mapview</code> (based on leaflet) can
also be used to make interactive plots. We can represent specific
attributes like so:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mapview</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html" class="external-link">mapview</a></span><span class="op">(</span><span class="va">ontario_kba</span>, zcol <span class="op">=</span> <span class="st">"PercentProtected"</span><span class="op">)</span></span></code></pre></div>
<p>In this example, were interested in all the KBA polygons of Ontario.
However, if you were working with a larger data set, it is possible to
filter your dataframe to retrieve only specific polygons that meet
certain criteria relevant to your research. To do so, we can apply
filters based on a variable condition. For example, say we only wanted
KBA’s greater than 100km^2 in size:</p>
<blockquote>
<p>To execute this code chunk, remove the #</p>
</blockquote>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># kba_name &lt;- ontario_kba %&gt;% </span></span>
<span>  <span class="co"># dplyr::filter(Area &gt; 100) </span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reading-in-naturecounts-data">1.5 Reading in NatureCounts data<a class="anchor" aria-label="anchor" href="#reading-in-naturecounts-data"></a>
</h2>
<p>Let’s search NatureCounts for the Ontario Breeding Bird Atlas
(OBBA2PC, 2001-2005) dataset to assess Wood Duck distribution across
Ontario KBA’s. The steps here are similar to those you used in the Cedar
Waxwing example.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">collections</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/meta.html">meta_collections</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="fu"><a href="../reference/meta.html">meta_collections</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/search_species.html">search_species</a></span><span class="op">(</span><span class="st">"wood duck"</span><span class="op">)</span></span></code></pre></div>
<p>Then let’s filter and download data specifically for the Wood Ducks
in Ontario.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">atlas_on</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nc_data_dl.html">nc_data_dl</a></span><span class="op">(</span>collections <span class="op">=</span> <span class="st">"OBBA2PC"</span>, species <span class="op">=</span> <span class="fl">360</span>, username <span class="op">=</span> <span class="st">"testuser"</span>, info <span class="op">=</span> <span class="st">"spatial_data_tutorial"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using filters: collections (OBBA2PC); species (360); fields_set (BMDE2.00-min)</span></span>
<span><span class="co">#&gt; Collecting available records...</span></span>
<span><span class="co">#&gt;   collection nrecords</span></span>
<span><span class="co">#&gt; 1    OBBA2PC      290</span></span>
<span><span class="co">#&gt; Total records: 290</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Downloading records for each collection:</span></span>
<span><span class="co">#&gt;   OBBA2PC</span></span>
<span><span class="co">#&gt;     Records 1 to 290 / 290</span></span></code></pre></div>
<p>We can then convert our NatureCounts data into a spatial object. To
do so, we deploy the <code>st_as_sf</code> function and specify the
coordinate reference system (CRS).</p>
<p>The CRS of our KBA sf object can be returned with
<code><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs()</a></code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">ontario_kba</span><span class="op">)</span></span>
<span><span class="co">#&gt; Coordinate Reference System:</span></span>
<span><span class="co">#&gt;   User input: WGS 84 </span></span>
<span><span class="co">#&gt;   wkt:</span></span>
<span><span class="co">#&gt; GEOGCRS["WGS 84",</span></span>
<span><span class="co">#&gt;     DATUM["World Geodetic System 1984",</span></span>
<span><span class="co">#&gt;         ELLIPSOID["WGS 84",6378137,298.257223563,</span></span>
<span><span class="co">#&gt;             LENGTHUNIT["metre",1]]],</span></span>
<span><span class="co">#&gt;     PRIMEM["Greenwich",0,</span></span>
<span><span class="co">#&gt;         ANGLEUNIT["degree",0.0174532925199433]],</span></span>
<span><span class="co">#&gt;     CS[ellipsoidal,2],</span></span>
<span><span class="co">#&gt;         AXIS["latitude",north,</span></span>
<span><span class="co">#&gt;             ORDER[1],</span></span>
<span><span class="co">#&gt;             ANGLEUNIT["degree",0.0174532925199433]],</span></span>
<span><span class="co">#&gt;         AXIS["longitude",east,</span></span>
<span><span class="co">#&gt;             ORDER[2],</span></span>
<span><span class="co">#&gt;             ANGLEUNIT["degree",0.0174532925199433]],</span></span>
<span><span class="co">#&gt;     ID["EPSG",4326]]</span></span></code></pre></div>
<p>Our KBA sf object is stored with World Geodetic System 1984 (WGS 84)
coordinates, EPSG = 4326. Now we can convert our
<strong>atlas_on</strong> dataframe to an sf object using the same
CRS.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">atlas_on_sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">atlas_on</span>,</span>
<span>                        coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span></code></pre></div>
<p>Now let’s ensure that the conversion was successful. You’ll notice a
new geometry column where each observation is a point.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">atlas_on_sf</span><span class="op">)</span> <span class="co"># view the sf object</span></span>
<span><span class="co">#&gt; Classes 'sf' and 'data.frame':   290 obs. of  56 variables:</span></span>
<span><span class="co">#&gt;  $ record_id              : int  10339750 10340180 10342681 10343644 10344845 10351428 10353184 10354352 10355078 10357496 ...</span></span>
<span><span class="co">#&gt;  $ collection             : chr  "OBBA2PC" "OBBA2PC" "OBBA2PC" "OBBA2PC" ...</span></span>
<span><span class="co">#&gt;  $ project_id             : int  1007 1007 1007 1007 1007 1007 1007 1007 1007 1007 ...</span></span>
<span><span class="co">#&gt;  $ protocol_id            : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ protocol_type          : int  1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ species_id             : int  360 360 360 360 360 360 360 360 360 360 ...</span></span>
<span><span class="co">#&gt;  $ statprov_code          : chr  "ON" "ON" "ON" "ON" ...</span></span>
<span><span class="co">#&gt;  $ country_code           : chr  "CA" "CA" "CA" "CA" ...</span></span>
<span><span class="co">#&gt;  $ SiteCode               : chr  "17NJ64-14" "17MJ97-10" "17NH47-23" "17NJ31-6" ...</span></span>
<span><span class="co">#&gt;  $ bcr                    : int  13 13 13 13 13 13 13 12 13 13 ...</span></span>
<span><span class="co">#&gt;  $ subnational2_code      : chr  "CA.ON.WL" "CA.ON.BC" "CA.ON.BN" "CA.ON.WT" ...</span></span>
<span><span class="co">#&gt;  $ iba_site               : chr  "N/A" "N/A" "N/A" "N/A" ...</span></span>
<span><span class="co">#&gt;  $ utm_square             : chr  "17TNJ64" "17TMJ97" "17TNH47" "17TNJ31" ...</span></span>
<span><span class="co">#&gt;  $ survey_year            : int  2001 2001 2001 2001 2001 2001 2001 2001 2001 2001 ...</span></span>
<span><span class="co">#&gt;  $ survey_month           : int  6 5 5 6 6 6 6 6 6 6 ...</span></span>
<span><span class="co">#&gt;  $ survey_week            : int  3 4 4 3 1 4 4 1 4 2 ...</span></span>
<span><span class="co">#&gt;  $ survey_day             : int  21 31 31 24 4 28 28 2 27 15 ...</span></span>
<span><span class="co">#&gt;  $ breeding_rank          : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ GlobalUniqueIdentifier : chr  "URN:catalog:BSC-EOC:OBBA2PC:850-WODU" "URN:catalog:BSC-EOC:OBBA2PC:392-WODU" "URN:catalog:BSC-EOC:OBBA2PC:269-WODU" "URN:catalog:BSC-EOC:OBBA2PC:961-WODU" ...</span></span>
<span><span class="co">#&gt;  $ CatalogNumber          : chr  "850-WODU" "392-WODU" "269-WODU" "961-WODU" ...</span></span>
<span><span class="co">#&gt;  $ Locality               : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ TimeCollected          : chr  "5.7166667" "8.9333334" "7.1999998" "6.2833333" ...</span></span>
<span><span class="co">#&gt;  $ CollectorNumber        : chr  "356" "266" "1530" "1335" ...</span></span>
<span><span class="co">#&gt;  $ FieldNumber            : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ Remarks                : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ ProjectCode            : chr  "OBBA2" "OBBA2" "OBBA2" "OBBA2" ...</span></span>
<span><span class="co">#&gt;  $ ProtocolType           : chr  "Point Count" "Point Count" "Point Count" "Point Count" ...</span></span>
<span><span class="co">#&gt;  $ ProtocolCode           : chr  "PointCount" "PointCount" "PointCount" "PointCount" ...</span></span>
<span><span class="co">#&gt;  $ ProtocolURL            : chr  "http://www.bsc-eoc.org/norac/atlascont.htm" "http://www.bsc-eoc.org/norac/atlascont.htm" "http://www.bsc-eoc.org/norac/atlascont.htm" "http://www.bsc-eoc.org/norac/atlascont.htm" ...</span></span>
<span><span class="co">#&gt;  $ SurveyAreaIdentifier   : chr  "17NJ64-14" "17MJ97-10" "17NH47-23" "17NJ31-6" ...</span></span>
<span><span class="co">#&gt;  $ SamplingEventIdentifier: chr  "850" "392" "269" "961" ...</span></span>
<span><span class="co">#&gt;  $ SamplingEventStructure : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ RouteIdentifier        : chr  "17NJ64" "17MJ97" "17NH47" "17NJ31" ...</span></span>
<span><span class="co">#&gt;  $ TimeObservationsStarted: logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ TimeObservationsEnded  : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ DurationInHours        : chr  "0.08333333" "0.08333333" "0.08333333" "0.08333333" ...</span></span>
<span><span class="co">#&gt;  $ TimeIntervalStarted    : chr  "5.7166667" "8.9333334" "7.1999998" "6.2833333" ...</span></span>
<span><span class="co">#&gt;  $ TimeIntervalEnded      : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ TimeIntervalsAdditive  : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ NumberOfObservers      : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ NoObservations         : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ ObservationCount       : chr  "2" "1" "1" "3" ...</span></span>
<span><span class="co">#&gt;  $ ObservationDescriptor  : chr  "Total count" "Total count" "Total count" "Total count" ...</span></span>
<span><span class="co">#&gt;  $ ObservationCount2      : chr  NA "1" NA "3" ...</span></span>
<span><span class="co">#&gt;  $ ObservationDescriptor2 : chr  "0-100 m" "0-100 m" "0-100 m" "0-100 m" ...</span></span>
<span><span class="co">#&gt;  $ ObservationCount3      : chr  "2" NA "1" NA ...</span></span>
<span><span class="co">#&gt;  $ ObservationDescriptor3 : chr  "&gt;100 m" "&gt;100 m" "&gt;100 m" "&gt;100 m" ...</span></span>
<span><span class="co">#&gt;  $ ObservationCount4      : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ ObservationDescriptor4 : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ ObservationCount5      : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ ObservationDescriptor5 : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ ObservationCount6      : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ ObservationDescriptor6 : logi  NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ AllIndividualsReported : chr  "Yes" "Yes" "Yes" "Yes" ...</span></span>
<span><span class="co">#&gt;  $ AllSpeciesReported     : chr  "Yes" "Yes" "Yes" "Yes" ...</span></span>
<span><span class="co">#&gt;  $ geometry               :sfc_POINT of length 290; first list element:  'XY' num  -80.1 43.7</span></span>
<span><span class="co">#&gt;  - attr(*, "sf_column")= chr "geometry"</span></span>
<span><span class="co">#&gt;  - attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "names")= chr [1:55] "record_id" "collection" "project_id" "protocol_id" ...</span></span></code></pre></div>
<p>There are a few other useful functions that may be applied to sf
objects:</p>
<div class="line-block">
<code><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">sf::st_transform()</a></code> - transforms the
CRS of a specified CRS object<br><code><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">sf::st_drop_geometry()</a></code> - removes the geometry column of a
sf object</div>
<p>For example, <code><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform()</a></code> can be applied to project
our spatial object using a different CRS like NAD83 / UTM zone 16N (EPSG
= 26916).</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ontario_kba</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">ontario_kba</span>, crs <span class="op">=</span> <span class="fl">26916</span><span class="op">)</span> </span></code></pre></div>
<p>It can also be used to ensure that the CRS of our spatial objects
match.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">atlas_on_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">atlas_on_sf</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">ontario_kba</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="geoprocessing-functions">1.6 Geoprocessing functions<a class="anchor" aria-label="anchor" href="#geoprocessing-functions"></a>
</h2>
<p>Geoprocessing functions allow us to manipulate or compute spatial
objects based on interactions between their geometries. There are
several useful functions integrated into the <code>sf</code> package
including:</p>
<div class="line-block">
<code>st_intersection(x, y)</code> - creates
geometry of the shared portion of x and y<br><code>st_crop(x, y, ..., xmin, ymin, xmax, ymax)</code> - creates
geometry of x that intersects a specified range<br><code>st_difference(x, y)</code> - creates geometry from x that does not
intersect with y<br><code>st_area</code>, <code>st_length</code>, and
<code>st_distance</code> can also be used to compute geometric
measurements</div>
<p>More resources, including as <code>sf</code> package
<strong>cheatsheat</strong> can be found <a href="https://github.com/r-spatial/sf" class="external-link">here</a>.</p>
<p>To identify Wood Ducks observed in Ontario KBA’s, we can apply the
<code><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_intersection()</a></code> function.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wood_ducks_kba</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_intersection</a></span><span class="op">(</span><span class="va">ontario_kba</span>, <span class="va">atlas_on_sf</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: attribute variables are assumed to be spatially constant throughout all geometries</span></span></code></pre></div>
<p>You will get a <code>warning</code> message, which you can safely
ignore.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If need be, transform your spatial data back to EPSG:4326 to visualize with ggplot2 or leaflet</span></span>
<span><span class="va">ontario_kba</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">ontario_kba</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="va">wood_ducks_kba</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">wood_ducks_kba</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span></code></pre></div>
<p>Use ggplot2 to visualize the polygon data and point data for the Long
Point Peninsula and Marshes (SiteCode ON001):</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter the ontario_kba and wood_ducks_kba data by SiteCode </span></span>
<span><span class="va">ontario_kba_LP</span> <span class="op">&lt;-</span> <span class="va">ontario_kba</span><span class="op">[</span><span class="va">ontario_kba</span><span class="op">$</span><span class="va">SiteCode</span> <span class="op">==</span> <span class="st">"ON001"</span>, <span class="op">]</span></span>
<span><span class="va">wood_ducks_kba_LP</span> <span class="op">&lt;-</span> <span class="va">wood_ducks_kba</span><span class="op">[</span><span class="va">wood_ducks_kba</span><span class="op">$</span><span class="va">SiteCode</span> <span class="op">==</span> <span class="st">"ON001"</span>, <span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Select a basemap</span></span>
<span>  <span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_map_tile.html" class="external-link">annotation_map_tile</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"osm"</span>, zoom <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Plot the filtered KBA polygon (ON001)</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ontario_kba_LP</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Ontario KBA"</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Plot the Wood Duck observations that are within the KBA</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wood_ducks_kba_LP</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Wood Duck Observations"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Custom fill and color for the legend</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Ontario KBA"</span> <span class="op">=</span> <span class="st">"violet"</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Legend"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Wood Duck Observations"</span> <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Legend"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Automatically zoom to the extent of the ON001 polygon</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Map components</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottomright"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Key Biodiversity Area (KBA) - Long Point Peninsula and Marshes"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Longitude"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Latitude"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Zoom: 9</span></span></code></pre></div>
<p><img src="figures%2Fspatdatatutorial_longpoint_kba-1.png" alt="Test3"></p>
<p>Or use leaflet, this time using the <code>addCircleMarkers</code>
argument.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rstudio.github.io/leaflet/reference/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span>width <span class="op">=</span> <span class="st">"100%"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addTiles</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addPolygons</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ontario_kba</span>, color <span class="op">=</span> <span class="st">"black"</span>, weight <span class="op">=</span> <span class="fl">2</span>, smoothFactor <span class="op">=</span> <span class="fl">1</span>, </span>
<span>  opacity <span class="op">=</span> <span class="fl">1.0</span>, fillOpacity <span class="op">=</span> <span class="fl">0.5</span>, fillColor <span class="op">=</span> <span class="st">"violet"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addCircleMarkers</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wood_ducks_kba</span>, radius <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"orange"</span>, </span>
<span>                   stroke <span class="op">=</span> <span class="cn">FALSE</span>, fillOpacity <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://trafficonese.github.io/leaflet.extras/reference/fullscreen.html" class="external-link">addFullscreenControl</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/addLegend.html" class="external-link">addLegend</a></span><span class="op">(</span>colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"violet"</span>, <span class="st">"orange"</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Ontario KBA"</span>, <span class="st">"Wood Duck Observations"</span><span class="op">)</span>, position <span class="op">=</span> <span class="st">"bottomright"</span><span class="op">)</span></span></code></pre></div>
<p>After geoprocessing our data in R, we can write out any sf objects to
Shapefiles on a disk, where the argument delete_layer = TRUE is used to
overwrite a file.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># st_write(wood_ducks_kba,"wood_ducks_kba.shp", driver = "ESRI Shapefile", delete_layer = TRUE)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="priority-places-example">1.7 Priority Places Example<a class="anchor" aria-label="anchor" href="#priority-places-example"></a>
</h2>
<p><em>Example 3</em>: You want to assess Wood Duck distribution across
the Long Point Walsingham Forest Priority Place. Data for this section
may be downloaded from the <a href="https://open.canada.ca/data/en/dataset/91219d24-e877-4c8a-8bd2-b2b662e573e0" class="external-link">Priority
Places - Open Government Portal</a>.</p>
<p>First, lets create a path to our downloaded Priority Place file.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gdb_path</span> <span class="op">&lt;-</span> <span class="st">"priorityplaces.gdb"</span></span></code></pre></div>
<p>Then, let’s inspect the spatial data.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gdb_layers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_layers.html" class="external-link">st_layers</a></span><span class="op">(</span><span class="va">gdb_path</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">gdb_layers</span><span class="op">)</span></span>
<span><span class="co">#&gt; Driver: OpenFileGDB </span></span>
<span><span class="co">#&gt; Available layers:</span></span>
<span><span class="co">#&gt;               layer_name geometry_type features fields                     crs_name</span></span>
<span><span class="co">#&gt; 1 PriorityPlacesBoundary Multi Polygon       11     11 NAD83 / Canada Atlas Lambert</span></span>
<span><span class="co">#&gt; 2  PriorityPlacesProject   Multi Point       89     13 NAD83 / Canada Atlas Lambert</span></span></code></pre></div>
<p>To read in our spatial data object, we apply the <code>st_read</code>
function and specify our desired data layer.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">priori_place_polygons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="va">gdb_path</span>, layer <span class="op">=</span> <span class="st">"PriorityPlacesBoundary"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading layer `PriorityPlacesBoundary' from data source </span></span>
<span><span class="co">#&gt;   `/home/steffi/Projects/Business/Birds Canada/NatureCounts/naturecounts/misc/Data/priority_places/priorityplaces.gdb' </span></span>
<span><span class="co">#&gt;   using driver `OpenFileGDB'</span></span>
<span><span class="co">#&gt; Simple feature collection with 11 features and 11 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -2135754 ymin: -586679 xmax: 2450963 ymax: 2554209</span></span>
<span><span class="co">#&gt; Projected CRS: NAD83 / Canada Atlas Lambert</span></span></code></pre></div>
<p>Were interested in Wood Duck distribution across the Long Point
Walsingham Forest Priority Place. We’ll use <code>dplyr</code> to filter
based on a variable condition.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">long_point_polygon</span> <span class="op">&lt;-</span> <span class="va">priori_place_polygons</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Name</span> <span class="op">==</span> <span class="st">"Long Point Walsingham Forest"</span><span class="op">)</span> <span class="co"># filters based on multipolygon name </span></span></code></pre></div>
<p>Then reproject the Wood Duck data to match our Priority Place using
<code>st_transform</code>.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">atlas_on_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">atlas_on_sf</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">long_point_polygon</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Next, we’ll apply our geoprocessing function to find the Wood Duck
observations that intersect with our chosen Priority Place.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wood_ducks_longpoint</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_intersection</a></span><span class="op">(</span><span class="va">long_point_polygon</span>, <span class="va">atlas_on_sf</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: attribute variables are assumed to be spatially constant throughout all geometries</span></span></code></pre></div>
<p>Finally, we’ll transform our spatial objects one more time before
visualizing them.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">long_point_polygon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">long_point_polygon</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wood_ducks_longpoint</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">wood_ducks_longpoint</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span></code></pre></div>
<p>with <code>ggplot2</code>:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Select a basemap</span></span>
<span>  <span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_map_tile.html" class="external-link">annotation_map_tile</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"cartolight"</span>, zoom <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Plot the Long Point polygon</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">long_point_polygon</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Long Point Walsingham Forest"</span><span class="op">)</span>, </span>
<span>          color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Plot the Wood Duck observations</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wood_ducks_longpoint</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Wood Duck Observations"</span><span class="op">)</span>, </span>
<span>          size <span class="op">=</span> <span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Custom fill and color for the legend</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Long Point Walsingham Forest"</span> <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Legend"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Wood Duck Observations"</span> <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Legend"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Automatically zoom to the extent of the Long Point polygon</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Map components</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottomright"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Wood Duck Observations within Long Point Walsingham"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Longitude"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Latitude"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Zoom: 9</span></span></code></pre></div>
<p><img src="figures%2Fspatdatatutorial_longpoint_prioriplace-1.png" alt="test4"></p>
<p>With <code>leaflet</code>:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rstudio.github.io/leaflet/reference/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span>width <span class="op">=</span> <span class="st">"100%"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addTiles</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addPolygons</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">long_point_polygon</span>, color <span class="op">=</span> <span class="st">"black"</span>, weight <span class="op">=</span> <span class="fl">2</span>, smoothFactor <span class="op">=</span> <span class="fl">1</span>, </span>
<span>  opacity <span class="op">=</span> <span class="fl">1.0</span>, fillOpacity <span class="op">=</span> <span class="fl">0.5</span>, fillColor <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addCircleMarkers</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">wood_ducks_longpoint</span>, radius <span class="op">=</span> <span class="fl">5</span>, color <span class="op">=</span> <span class="st">"green"</span>, </span>
<span>                   stroke <span class="op">=</span> <span class="cn">FALSE</span>, fillOpacity <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://trafficonese.github.io/leaflet.extras/reference/fullscreen.html" class="external-link">addFullscreenControl</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/addLegend.html" class="external-link">addLegend</a></span><span class="op">(</span>colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"green"</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Long Point Walsingham Forest"</span>, <span class="st">"Wood Duck Observations"</span><span class="op">)</span>, position <span class="op">=</span> <span class="st">"bottomright"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Congratulations</strong>! You’ve completed <strong>Chapter 1
- Manipulating Spatial Data (Part 1)</strong>. Here, you’ve successfully
filtered and visualized NatureCounts data using spatio-temporal, KBA,
and Priority Place maps. In <a href="02-ManipSpatialData_Part2.Rmd">Chapter 2</a>, you will explore
more spatial data visualization while linking climate data to
NatureCounts observations.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Steffi LaZerte, Denis Lepage.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
