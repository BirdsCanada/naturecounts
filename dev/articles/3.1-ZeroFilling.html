<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 1 - Zero-filling • naturecounts</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Chapter 1 - Zero-filling">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">naturecounts</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.4.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/1.1-Introduction.html">Chapter 1 - Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/1.2-LoadPackage.html">Chapter 2 - Loading R Packages</a></li>
    <li><a class="dropdown-item" href="../articles/1.3-ViewData.html">Chapter 3 - Understanding and Viewing Data</a></li>
    <li><a class="dropdown-item" href="../articles/1.4-DownloadData.html">Chapter 4 - Downloading and Filtering Data</a></li>
    <li><a class="dropdown-item" href="../articles/1.5-ManipData.html">Chapter 5 - Data Manipulation</a></li>
    <li><a class="dropdown-item" href="../articles/1.6-VisualData.html">Chapter 6 - Data Visualization</a></li>
    <li><a class="dropdown-item" href="../articles/1.7-Answers.html">Chapter 7 - Answers</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BirdsCanada/naturecounts/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Chapter 1 - Zero-filling</h1>
            
            <h4 data-toc-skip class="date">2025-03-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/BirdsCanada/naturecounts/blob/docs-update/vignettes/articles/3.1-ZeroFilling.Rmd" class="external-link"><code>vignettes/articles/3.1-ZeroFilling.Rmd</code></a></small>
      <div class="d-none name"><code>3.1-ZeroFilling.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="chapter-1-zero-filling">Chapter 1: Zero-filling<a class="anchor" aria-label="anchor" href="#chapter-1-zero-filling"></a>
</h2>
<div class="section level6">
<h6 id="author-dimitrios-markou-steffi-lazerte-danielle-ethier">Author: Dimitrios Markou, Steffi LaZerte, Danielle Ethier<a class="anchor" aria-label="anchor" href="#author-dimitrios-markou-steffi-lazerte-danielle-ethier"></a>
</h6>
<blockquote>
<p>Including both zero and non-zero counts is important to describe
changes in bird distribution and abundance over time. Presence-only data
offers limited information on these trends which can be affected by
observer location bias and sampling effort. This chapter will cover
three zero-filling methods and demonstrate how to produce
presence/absence data for analysis.</p>
</blockquote>
<p>This tutorial assumes that you have a basic understanding of how to
access your data from NatureCounts. The <a href="https://github.com/BirdsCanada/NatureCounts_IntroTutorial.git" class="external-link">NatureCounts
Introductory R Tutorial</a> is where you should start if you’re new to
the <code>naturecounts</code> R package. It explains how to access,
view, filter, manipulate, and visualize NatureCounts data. We recommend
reviewing this tutorial before proceeding.</p>
</div>
</div>
<div class="section level2">
<h2 id="learning-objectives">1.0 Learning Objectives<a class="anchor" aria-label="anchor" href="#learning-objectives"></a>
</h2>
<p>By the end of <strong>Chapter 1 - Zero-filling</strong>, users will
know how to:</p>
<ul>
<li>Determine if their data is suitable for zero filling: <a href="#id_1.1zerofill">Intro to zero-filling</a>
</li>
<li>Zero-fill NatureCounts data and generate a presence/absence column:
<a href="#id_1.2format_zero_fill"><code>format_zero_fill</code>
function</a>
</li>
<li>Create an events data matrix to zero-fill data for select species:
<a href="#id_1.3events_matrix">Events matrix</a>
</li>
<li>Run a <code>for</code> loop to zero-fill data for multiple species
in sequence: <a href="#id_1.4events_matrix_loop">Events matrix
loop</a>
</li>
</ul>
<p>This R tutorial requires the following packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/BirdsCanada/naturecounts" class="external-link">naturecounts</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="id_1-1zerofill">1.1 Intro to Zero-filling<a class="anchor" aria-label="anchor" href="#id_1-1zerofill"></a>
</h2>
<p>When observers are collecting point count data in the field, they are
recording all the birds they see or hear. They are not recording the
birds that they do not see or hear. NatureCounts data set therefore
often lack zeros for species that were not detected during a survey.
Zero-filling assigns a count of zero to species that are not detected
during an observation period (<code>ObservationCount</code> = 0). Zeros
can indicate two things - the true absence of a species or failure to
detect a species.</p>
<p>Here are some important considerations to keep in mind when applying
zero-filling methods:</p>
<ul>
<li><p><strong>Biological Relevance</strong>: Ensure that the zeros you
are adding accurately reflect true absences rather than just missing
data. This distinction is crucial for valid interpretations.</p></li>
<li><p>Sampling Bias: Consider potential biases in your sampling
methods. If certain areas or times are under-sampled, zero-filling may
misrepresent the actual distribution and abundance of species.</p></li>
<li><p><strong>Data Structure</strong>: Understand the structure of your
dataset. Zero-filling may be more appropriate for certain types of data
(e.g., count data) than others (e.g., presence-only data).</p></li>
<li><p><strong>Statistical Methods</strong>: Choose appropriate
statistical methods that can handle zero-inflated data. Some models are
specifically designed for datasets with many zeros, while others may not
be suitable.</p></li>
<li><p><strong>Impact on Analysis</strong>: Assess how zero-filling will
affect your analysis outcomes. Adding zeros can influence mean values,
variances, and other statistical metrics, potentially leading to
misleading conclusions.</p></li>
<li><p><strong>Documentation</strong>: Clearly document your
zero-filling process, including the rationale for your chosen method and
any assumptions made. This transparency is essential for reproducibility
and for others to understand your analysis.</p></li>
<li><p><strong>Contextual Factors</strong>: Take into account
environmental or temporal factors that may influence species presence or
absence. These factors can help inform whether zeros are appropriate in
specific contexts.</p></li>
</ul>
<p>By carefully considering these factors, you can make more informed
decisions about zero-filling and its implications for your dataset and
subsequent analyses.</p>
<p>Good candidates for zero-filling are species that are reported
consistently at many sites within their ranges. What is considered “many
sites” depends on the species. Species that are rarely detected or are
considered outside of their range are likely poor candidates for
zero-filling.</p>
<p><strong>Note: Zero-filling, across all methods, assumes that at least
one species was detected at each survey point. This assumption is nearly
always true.</strong></p>
</div>
<div class="section level2">
<h2 id="id_1-2format_zero_fill">1.2 NatureCounts format_zero_fill function<a class="anchor" aria-label="anchor" href="#id_1-2format_zero_fill"></a>
</h2>
<p>The <code><a href="../reference/format_zero_fill.html">format_zero_fill()</a></code> function can help us infer
species absence when a species was not detected during a sampling event,
provided that all species were reported for that event
(i.e. <code>AllSpeciesReported</code> is “Yes”). Otherwise, the function
will return an error for invalid records. If your dataset produces an
error, you will need to filter your data to only
<code>SamplingEventIdentifiers</code> where all species were
recorded.</p>
<p>Browse the collections to find the Breeding Bird Surveys (BBS; 50
stops, Canada) dataset.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">collections</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/meta.html">meta_collections</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="fu"><a href="../reference/meta.html">meta_collections</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Let’s bring in the list of common names to append to the dataframe
for easier interpretation.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_species.html">search_species</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">sp.list</span> <span class="op">&lt;-</span> <span class="va">sp.list</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">species_id</span>, <span class="va">english_name</span><span class="op">)</span></span></code></pre></div>
<p>Read in the BBS data from NatureCounts from 2015 to 2020 from the
province of Saskatchewan as an example data set. Because we want to
zero-fill the dataframe, we need to download the full collection for the
given time period and geography of interest. NOT just the data for the
species of interest. This will ensure that all the sampling events are
correctly identified for zero-filling.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bbs50_can</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nc_data_dl.html">nc_data_dl</a></span><span class="op">(</span>collections <span class="op">=</span> <span class="st">"BBS50-CAN"</span>, years<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2015</span>,<span class="fl">2020</span><span class="op">)</span>, region<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>statprov<span class="op">=</span><span class="st">"SK"</span><span class="op">)</span>, username <span class="op">=</span> <span class="st">"testuser"</span>, info <span class="op">=</span> <span class="st">"zero fill example"</span><span class="op">)</span></span></code></pre></div>
<p>Append the english name to the BBS dataframe and ensure
<code>ObservationCount</code> is numeric.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bbs50_can</span> <span class="op">&lt;-</span> <span class="va">bbs50_can</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">sp.list</span>, by <span class="op">=</span> <span class="st">"species_id"</span><span class="op">)</span></span>
<span><span class="va">bbs50_can</span><span class="op">$</span><span class="va">ObservationCount</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">bbs50_can</span><span class="op">$</span><span class="va">ObservationCount</span><span class="op">)</span></span></code></pre></div>
<p>Determine if all species were reported in the dataset.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">bbs50_can</span>, <span class="va">AllSpeciesReported</span><span class="op">)</span></span>
<span><span class="co">#&gt;   AllSpeciesReported     n</span></span>
<span><span class="co">#&gt; 1                Yes 80385</span></span></code></pre></div>
<p>Yes! So, in this case, there is no need to filter the dataset because
all species were recorded for each sampling event.</p>
<p>Let’s apply the <code><a href="../reference/format_zero_fill.html">format_zero_fill()</a></code> function. Optionally,
you can specify columns to retain in the output dataframe using the
<code>extra_event</code> and/or <code>extra_species</code> arguments. By
default, the function zero fills by
<code>SamplingEventIdentifier</code>. However, the <code>by</code>
argument may also be used to specify how the data should be zero-filled
i.e. by <code>SamplingEventIdentifer</code>,
<code>SurveyAreaIdentifier</code>, <code>SiteCode</code>,
<code>utm_square</code>, etc. This is useful if you want to determine
whether a species has/has not been observed in a particular zone!</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bbs50_can_zero_fill</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/format_zero_fill.html">format_zero_fill</a></span><span class="op">(</span><span class="va">bbs50_can</span>, </span>
<span>                                 by <span class="op">=</span> <span class="st">"SamplingEventIdentifier"</span>,</span>
<span>                                 extra_event <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"latitude"</span>, <span class="st">"longitude"</span><span class="op">)</span>,</span>
<span>                                 extra_species <span class="op">=</span> <span class="st">"english_name"</span><span class="op">)</span></span></code></pre></div>
<p>While <code><a href="../reference/format_zero_fill.html">format_zero_fill()</a></code> adds 0’s to the
<code>ObservationCount</code> column by default, you can specify other
columns to zero fill. For example, you could create Presence/Absence
data by zero-filling a custom column.</p>
<p>First, select relevant columns from the original dataframe and create
a presence column based on <code>ObservationCount</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bbs50_can_presence</span> <span class="op">&lt;-</span> <span class="va">bbs50_can</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">AllSpeciesReported</span>, <span class="va">SamplingEventIdentifier</span>, <span class="va">species_id</span>, <span class="va">ObservationCount</span>, <span class="va">latitude</span>, <span class="va">longitude</span>, <span class="va">english_name</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>presence <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">ObservationCount</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Zero-fill the data while specifying the presence column in the
<code>fill</code> argument. This also converts the presence column from
logical to numeric.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bbs50_can_pres_filled</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/format_zero_fill.html">format_zero_fill</a></span><span class="op">(</span><span class="va">bbs50_can_presence</span>, </span>
<span>                                          fill <span class="op">=</span> <span class="st">"presence"</span>,</span>
<span>                                          by <span class="op">=</span> <span class="st">"SamplingEventIdentifier"</span>,</span>
<span>                                          extra_event <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"latitude"</span>, <span class="st">"longitude"</span><span class="op">)</span>, </span>
<span>                                          extra_species <span class="op">=</span> <span class="st">"english_name"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  - Converted 'fill' column (presence) from logical to numeric</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="id_1-3events_matrix">1.3 Zero-filling: Events matrix<a class="anchor" aria-label="anchor" href="#id_1-3events_matrix"></a>
</h2>
<p>In some instances, you may have a survey that does not record all
species (e.g., Nocturnal Owl Survey, Marsh Monitoring Program, Hawk
Watch), but rather targeted species specific to the programs protocol.
If <code>AllSpeciesRecorded</code> is not YES, you will want to
zero-fill your dataframe based on an <strong>events matrix</strong> that
specifies which sites were surveyed within a specific time frame and
geography. This matrix lists all survey events that took place,
regardless of how many or which species were observed.</p>
<p>To create the events matrix, we extract unique combinations of survey
time (e.g., <code>day</code>, <code>month</code>, <code>year</code>,
<code>TimeObservationStarted</code>, <code>TimeObservationEnded</code>)
and location (<code>SamplingAreaIdentifier</code>,
<code>RouteIdentifier</code>, <code>SiteCode</code>,
<code>latitude</code>, <code>longitude</code>). Which variables you
select will be specific to your analysis. Generally, the following
variables from the NatureCounts BMDE work well:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">events_matrix</span> <span class="op">&lt;-</span> <span class="va">bbs50_can</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">SiteCode</span>,</span>
<span>         <span class="va">survey_year</span>,</span>
<span>         <span class="va">survey_month</span>,</span>
<span>         <span class="va">survey_day</span>,</span>
<span>         <span class="va">latitude</span>, </span>
<span>         <span class="va">longitude</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>From this, you can see there are 9510 unique survey events in the BBS
dataset from 2015-2020 in Saskatchewan.</p>
<p>Filter the NatureCounts data for a species of interest and then merge
the events matrix with the species-specific data. This will result in NA
values for events where the species was not observed.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/search_species.html">search_species</a></span><span class="op">(</span><span class="st">"Chestnut-collared Longspur"</span><span class="op">)</span> <span class="co">#species_id = 19160</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 5</span></span>
<span><span class="co">#&gt;   species_id scientific_name   english_name               french_name                taxon_group</span></span>
<span><span class="co">#&gt;        &lt;int&gt; &lt;chr&gt;             &lt;chr&gt;                      &lt;chr&gt;                      &lt;chr&gt;      </span></span>
<span><span class="co">#&gt; 1      19160 Calcarius ornatus Chestnut-collared Longspur Plectrophane à ventre noir BIRDS</span></span>
<span></span>
<span><span class="va">longspur_events</span> <span class="op">&lt;-</span> <span class="va">bbs50_can</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">species_id</span> <span class="op">==</span> <span class="st">"19610"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">longspur_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">events_matrix</span>, <span class="va">longspur_events</span>,</span>
<span>                          by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SiteCode"</span>,</span>
<span>                               <span class="st">"survey_year"</span>,</span>
<span>                               <span class="st">"survey_month"</span>,</span>
<span>                               <span class="st">"survey_day"</span>,</span>
<span>                               <span class="st">"latitude"</span>,</span>
<span>                               <span class="st">"longitude"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Zero-fill for specific species. Here, we replace the NA values in the
<code>ObservationColumn</code> with 0 and select the column of interest
to inspect your data.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">longspur_zero_fill</span> <span class="op">&lt;-</span> <span class="va">longspur_events</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ObservationCount <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">ObservationCount</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">ObservationCount</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">SiteCode</span>, <span class="va">survey_day</span>, <span class="va">survey_month</span>, <span class="va">survey_year</span>, <span class="va">latitude</span>, <span class="va">longitude</span>, <span class="va">ObservationCount</span><span class="op">)</span> </span></code></pre></div>
<p>Plot a histogram of your zero-filled observation counts of
Chestnut-collared Longspur to see how the data are distributed.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">longspur_zero_fill</span><span class="op">$</span><span class="va">ObservationCount</span>, breaks <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures%2Fnc_at1_longspur_histogram-1.png" alt="Plot shows histogram of zero-filled Chestnut-collared Longspur observation counts."></p>
<p>Now your data frame is zero filled. You can repeat this process for
other species of interest or learn in the next section how to zero-fill
multiple species in sequence using a loop.</p>
</div>
<div class="section level2">
<h2 id="id_1-4events_matrix_loop">1.4 Zero-filling: Events matrix loops<a class="anchor" aria-label="anchor" href="#id_1-4events_matrix_loop"></a>
</h2>
<p>Oftentimes, when dealing with larger datasets, it might be more
effective to zero-fill across several species in sequence using a
loop.</p>
<ul>
<li><p><code>for</code> loops execute code until told to stop (i.e. for
a specified number of iterations)</p></li>
<li><p><code>while</code> loops execute code as long as a condition is
met</p></li>
</ul>
<p>First, extract the individual <code>species_id</code> values from the
BBS dataset.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">bbs50_can</span><span class="op">$</span><span class="va">species_id</span><span class="op">)</span></span></code></pre></div>
<p><strong>Optional</strong>: You can also create the list manually for
just a handful of species of interest rather than all the species in the
dataset. To execute the code chunk below, remove the #.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sp_ids &lt;- c(19160, 19170, 19180) # Chestnut-collared Longspur, Upland Sandpiper, Western Meadowlark</span></span></code></pre></div>
<p>Next, initialize an empty list to store our zero-filled data and
build the <code>for</code> loop step by step.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zero_filled_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Loop through each sp_ids</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">sp_ids</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Filter the BBS data for each species in a given loop</span></span>
<span>  <span class="va">all_species_data</span> <span class="op">&lt;-</span> <span class="va">bbs50_can</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">species_id</span> <span class="op">==</span> <span class="va">i</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Join the NatureCounts data with the events matrix</span></span>
<span>  <span class="va">all_species_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">events_matrix</span>, <span class="va">all_species_data</span>,</span>
<span>                                  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SiteCode"</span>, </span>
<span>                                         <span class="st">"survey_year"</span>, </span>
<span>                                         <span class="st">"survey_month"</span>,</span>
<span>                                         <span class="st">"survey_day"</span>, </span>
<span>                                         <span class="st">"latitude"</span>, </span>
<span>                                         <span class="st">"longitude"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Zero-fill the `ObservationCount` column for each species and across all events</span></span>
<span>  <span class="va">all_species_events</span> <span class="op">&lt;-</span> <span class="va">all_species_events</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ObservationCount <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">ObservationCount</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">ObservationCount</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Add the result to the list with species_id as the key</span></span>
<span>  <span class="va">zero_filled_data</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">all_species_events</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We can then combine the results from the loop into a single dataframe
which contains the zero-filled data for all species.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zero_filled_dataframe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">zero_filled_data</span>, .id <span class="op">=</span> <span class="st">"species_id"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Congratulations!</strong> You completed <strong>Chapter 1:
Zero-filling</strong>. Here, you explored three methods for zero-filling
observation counts and generated presence/absence data. For more
examples on zero-filling, see this <a href="https://birdscanada.github.io/naturecounts/articles/format-zero-fill.html#zero-filling">supplementary
article</a>. In <a href="02-AuxiliaryTables.Rmd">Chapter 2</a>, you can
explore how to access auxiliary datatables in the NatureCounts database
using the <code><a href="../reference/nc_query_table.html">nc_query_table()</a></code> function.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Steffi LaZerte, Denis Lepage.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
