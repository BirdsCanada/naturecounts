<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 4 - Downloading and Filtering Data • naturecounts</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Chapter 4 - Downloading and Filtering Data">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">naturecounts</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.4.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/1.1-Introduction.html">Chapter 1 - Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/1.2-LoadPackage.html">Chapter 2 - Loading R Packages</a></li>
    <li><a class="dropdown-item" href="../articles/1.3-ViewData.html">Chapter 3 - Understanding and Viewing Data</a></li>
    <li><a class="dropdown-item" href="../articles/1.4-DownloadData.html">Chapter 4 - Downloading and Filtering Data</a></li>
    <li><a class="dropdown-item" href="../articles/1.5-ManipData.html">Chapter 5 - Data Manipulation</a></li>
    <li><a class="dropdown-item" href="../articles/1.6-VisualData.html">Chapter 6 - Data Visualization</a></li>
    <li><a class="dropdown-item" href="../articles/1.7-Answers.html">Chapter 7 - Answers</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BirdsCanada/naturecounts/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Chapter 4 - Downloading and Filtering Data</h1>
            
            <h4 data-toc-skip class="date">2025-04-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/BirdsCanada/naturecounts/blob/main/vignettes/articles/1.4-DownloadData.Rmd" class="external-link"><code>vignettes/articles/1.4-DownloadData.Rmd</code></a></small>
      <div class="d-none name"><code>1.4-DownloadData.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="Download4">Downloading and Filtering Data<a class="anchor" aria-label="anchor" href="#Download4"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/BirdsCanada/naturecounts" class="external-link">naturecounts</a></span><span class="op">)</span></span></code></pre></div>
<p>This chapter jumps right into downloading NatureCounts data, which
builds directly on the skills developed in <a href="#Data3">Chapter
3</a>.</p>
<div class="section level3">
<h3 id="Download4-1">Downloading NatureCounts data<a class="anchor" aria-label="anchor" href="#Download4-1"></a>
</h3>
<p>To download data you need to <a href="https://naturecounts.ca/nc/default/register.jsp" class="external-link">sign up</a> for a
<strong>free</strong> account.</p>
<p>Let’s try fetching observational data across multiple collections
into a local data frame. To do so, we will use the
<code><a href="../reference/nc_data_dl.html">nc_data_dl()</a></code> download function. There is lots of data here,
so this could take a couple minutes.</p>
<p>First find the species id for the target species:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/search_species.html">search_species</a></span><span class="op">(</span><span class="st">"American Bittern"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 5</span></span></span>
<span><span class="co">##   species_id scientific_name       english_name     french_name      taxon_group</span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>       <span style="text-decoration: underline;">2</span>490 Botaurus lentiginosus American Bittern Butor d'Amérique BIRDS</span></span></code></pre>
<p>Then use this id with <code><a href="../reference/nc_data_dl.html">nc_data_dl()</a></code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bittern</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/nc_data_dl.html">nc_data_dl</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fl">2490</span>, username <span class="op">=</span> <span class="st">"testuser"</span>, info <span class="op">=</span> <span class="st">"tutorial example"</span><span class="op">)</span></span></code></pre></div>
<p>The bittern dataframe should now appear in the upper right panel of
RStudio under the <em>Environment</em> tab. Notice we specified the
<code>info</code> parameter which is a short description of what the
data is being downloaded for. This does not need to be specified when
using the <code><a href="../reference/nc_count.html">nc_count()</a></code> view function.</p>
<blockquote>
<p>The code in this Chapter will not work unless you replace
<code>"testuser"</code> with your actual user name. You will be prompted
to enter your password.</p>
</blockquote>
<p>Next we demonstrate how to download the Ontario Whip-poor-will
collection (WPWI), since it is Open Access (Level 5) and contains
relatively few records (n = 3012). Click <a href="https://naturecounts.ca/nc/default/datasets.jsp?code=WPWI" class="external-link">here</a>
for more information on this dataset.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">WPWI</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nc_data_dl.html">nc_data_dl</a></span><span class="op">(</span>collections <span class="op">=</span> <span class="st">"WPWI"</span>, username <span class="op">=</span> <span class="st">"testuser"</span>, info <span class="op">=</span> <span class="st">"tutorial example"</span><span class="op">)</span></span></code></pre></div>
<p>Our data download was more specific, and way faster! This will depend
on your research goals and data needs. Instead of specifying species id,
we filtered our data download by using the species alpha-numeric code
and the <code>collections</code> argument.</p>
<p>To access Level 3 or 4 collections you must <a href="https://naturecounts.ca/nc/default/nc_access_levels.jsp" class="external-link">sign
up</a> for a <strong>free</strong> account and request permission from
the data custodian. For a complete list of datasets and access level,
visit the <a href="https://naturecounts.ca/nc/default/datasets.jsp" class="external-link">NatureCounts
datasets</a> page or use the <code>meta_collection()</code> function.
Here you can browse information on each dataset prior to requesting
access.</p>
<p>To make a data request, use the NatureCounts <a href="https://naturecounts.ca/nc/default/searchquery.jsp" class="external-link">Download Data
query tool</a>. For step-by-step visual instructions, we encourage you
to watch: <a href="link%20to%20be%20provided">NatureCounts: An
Introductory Tutorial</a>. You will receive an email confirmation when
your request has been approved, which will contain your
<code>request_id</code>. This number will be used to download your newly
acquired dataset into R. There is also a build in function that allows
you to check the status of your request and retrieve your
<code>request_id</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/nc_requests.html">nc_requests</a></span><span class="op">(</span>username <span class="op">=</span> <span class="st">"testuser"</span><span class="op">)</span></span></code></pre></div>
<p>Here is sample code to download Access Level 3 or 4 data:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nc_data_dl.html">nc_data_dl</a></span><span class="op">(</span>request_id <span class="op">=</span> <span class="fl">000000</span>, username <span class="op">=</span> <span class="st">"USER"</span>,</span>
<span>                      info <span class="op">=</span> <span class="st">"MY REASON"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Note: This code is not functional and is here to serve as a
structural example. You will need to insert your
<code>request_id</code>, <code>username</code>, and <code>info</code> in
the code chunk above to make this work. If you applied filters to the
web portal data request (e.g., species, region, year), you will only
receive the subset of the dataset you requested.</strong></p>
</div>
<div class="section level3">
<h3 id="Download4-2">Applying Filters<a class="anchor" aria-label="anchor" href="#Download4-2"></a>
</h3>
<p>The filters applied in <a href="#Data3">Chapter 3</a> when using the
<code><a href="../reference/nc_count.html">nc_count()</a></code> view function are also used for the
<code><a href="../reference/nc_data_dl.html">nc_data_dl()</a></code> download function. Again, these options
include: <code>collections</code>, <code>project_id</code>,
<code>species</code>, <code>years</code>, <code>doy</code>
(day-of-year), <code>region</code>, and <code>site_type</code>. You may
also wish to specify which fields/columns to return using the
<code>field_set</code> and <code>fields</code> options in the
<code><a href="../reference/nc_data_dl.html">nc_data_dl()</a></code> function. For help with this feature, see the
naturecounts article <a href="https://birdstudiescanada.github.io/naturecounts/articles/selecting-fields.html" class="external-link">‘Selecting
columns and fields to download’</a>.</p>
<p>Please review the resources provided on <a href="#Data3.5">filter
metadata</a> prior to proceeding.</p>
<p>The users can specify up to 3 filter options in the download process
and should try to limit redundancies in filters. In most cases, one of
these options will be <code>collections</code>, since authorization is
given independently for each dataset (i.e., collection). If the user
chooses to select <code>species</code>, then only collections the user
has <em>authorization</em> to access will be used to retrieve
species-specific data. This differs from the <code><a href="../reference/nc_count.html">nc_count()</a></code>
function, which by default shows you <em>all</em> the records available
in each collection.</p>
</div>
<div class="section level3">
<h3 id="Download4-3">Examples<a class="anchor" aria-label="anchor" href="#Download4-3"></a>
</h3>
<p>Here are a few examples for you to work through to become familiar
with the <code><a href="../reference/nc_data_dl.html">nc_data_dl()</a></code> function.</p>
<p><em>Example 1</em>: We will use the Ontario Whip-poor-will collection
(WPWI) again for this example. After reviewing the online material, <a href="https://naturecounts.ca/nc/default/datasets.jsp?code=WPWI" class="external-link">here</a>,
you notice that the main survey ran from 2010 to 2012, but that
additional surveys were conducted between 2009 and 2013. For your
research, you only want data collected during the main survey window.
Further, the survey was Ontario-wide, but most effort and records are
from southern Ontario. Let’s further limit the data to those collected
south of the Canadian Shield, which is approximated with <a href="http://nabci-us.org/assets/images/bcr_map2.jpg" class="external-link">BCR</a> 13.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">WPWI_filter</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nc_data_dl.html">nc_data_dl</a></span><span class="op">(</span>collections <span class="op">=</span> <span class="st">"WPWI"</span>, years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2010</span>, <span class="fl">2012</span><span class="op">)</span>,region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bcr <span class="op">=</span> <span class="st">"13"</span><span class="op">)</span>, username <span class="op">=</span> <span class="st">"testuser"</span>, info <span class="op">=</span> <span class="st">"tutorial example"</span><span class="op">)</span></span></code></pre></div>
<p>You will notice that the number of records in the filtered WPWI
download (<code>WPWI_filter</code> = 754) is substantially less than the
number of records in the full dataset (<code>WPWI</code> = 3012)
downloaded in <a href="#Data3">Chapter 3</a>.</p>
<p><em>Example 2</em>: Rather than using BCR 13 to approximate the study
area, you are interested in just looking at records collected on the <a href="https://en.wikipedia.org/wiki/Bruce_Peninsula" class="external-link">Bruce Peninsula</a>
for the full time period. You decide to use <a href="https://birdstudiescanada.github.io/naturecounts/articles/region-spatial.html" class="external-link">spatial
data to filter observations</a>. Specifically, you create a <a href="https://birdstudiescanada.github.io/naturecounts/articles/region-codes.html" class="external-link">bounding
box</a>, using the <a href="https://naturecounts.ca/monitoring/georef_rec.jsp?lang=EN" class="external-link">Within
Coordinates</a> tool to help you retrieve custom coordinates for your
data query and/or download.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">WPWI_bp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nc_data_dl.html">nc_data_dl</a></span><span class="op">(</span>collections <span class="op">=</span> <span class="st">"WPWI"</span>, </span>
<span>                      region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>left <span class="op">=</span> <span class="op">-</span><span class="fl">81.7</span>, bottom <span class="op">=</span> <span class="fl">44.5</span>, </span>
<span>                                             right <span class="op">=</span> <span class="op">-</span><span class="fl">80.9</span>, top <span class="op">=</span> <span class="fl">45.3</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                      username <span class="op">=</span> <span class="st">"testuser"</span>, info <span class="op">=</span> <span class="st">"tutorial example"</span><span class="op">)</span></span></code></pre></div>
<p>You will notice there are now even fewer observation records
(<code>WPWI_bp</code> = 72)</p>
<p>Reminder that, through the naturecounts R package, data is downloaded
with a specific set of fields/columns by default. However, for more
advanced applications, users may wish to <a href="https://birdscanada.github.io/naturecounts/articles/selecting-fields.html">specify
which fields/columns to return</a>.</p>
</div>
<div class="section level3">
<h3 id="Download4-4">Exercises<a class="anchor" aria-label="anchor" href="#Download4-4"></a>
</h3>
<p>Now apply your newly acquired skills!</p>
<p><em>Exercise 1</em>: You are from the Northwest Territories and
interested in learning more about breeding birds in your region. First,
you identify the NatureCounts dataset most suitable for this exercise
using the <code><a href="../reference/nc_count.html">nc_count()</a></code> function. Next, you decide to focus
your download to only include Blackpoll Warbler data collected over the
past 5 years (2015-2020). How many observation records did you
download?</p>
<p>Answer: BBS50-CAN, 1756</p>
<p><em>Exercise 2</em>: You are birding in the <em>Beaverhill Lake</em>
Important Bird Area (iba) in May. You think you hear a Bobolink! You are
curious if this species has been detected here in the <a href="https://www.esrl.noaa.gov/gmd/grad/neubrew/Calendar.jsp" class="external-link">month of
May</a>. You choose to download the records you have authorization to
freely access from NatureCounts. How many observation records did you
download? What year are these records from?</p>
<p>Answer: 3, 1988 &amp; 1987</p>
<p>Answers to the exercises can be found in <a href="#Ans7.2">Chapter
7</a>.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Steffi LaZerte, Denis Lepage.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
