<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 2 - Auxiliary Tables • naturecounts</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Chapter 2 - Auxiliary Tables">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">naturecounts</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.4.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/1.1-Introduction.html">Chapter 1 - Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/1.2-LoadPackage.html">Chapter 2 - Loading R Packages</a></li>
    <li><a class="dropdown-item" href="../articles/1.3-ViewData.html">Chapter 3 - Understanding and Viewing Data</a></li>
    <li><a class="dropdown-item" href="../articles/1.4-DownloadData.html">Chapter 4 - Downloading and Filtering Data</a></li>
    <li><a class="dropdown-item" href="../articles/1.5-ManipData.html">Chapter 5 - Data Manipulation</a></li>
    <li><a class="dropdown-item" href="../articles/1.6-VisualData.html">Chapter 6 - Data Visualization</a></li>
    <li><a class="dropdown-item" href="../articles/1.7-Answers.html">Chapter 7 - Answers</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BirdsCanada/naturecounts/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Chapter 2 - Auxiliary Tables</h1>
            
            <h4 data-toc-skip class="date">2025-03-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/BirdsCanada/naturecounts/blob/docs-update/vignettes/articles/3.2-AuxiliaryTables.Rmd" class="external-link"><code>vignettes/articles/3.2-AuxiliaryTables.Rmd</code></a></small>
      <div class="d-none name"><code>3.2-AuxiliaryTables.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="chapter-2-auxiliary-tables-from-naturecounts">Chapter 2: Auxiliary Tables from NatureCounts<a class="anchor" aria-label="anchor" href="#chapter-2-auxiliary-tables-from-naturecounts"></a>
</h2>
<blockquote>
<p>In <a href="01-ZeroFilling.Rmd"><strong>Chapter 1:
Zero-filling</strong></a>, you explored three different methods that can
be used to zero-fill NatureCounts data and generate presence/absence
records. In this tutorial, you will explore custom table queries and
create basic data summaries and maps using the rNest auxiliary
table.</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="learning-objectives">2.0 Learning Objectives<a class="anchor" aria-label="anchor" href="#learning-objectives"></a>
</h2>
<p>By the end of Chapter 2 - Auxiliary Tables, users will know how
to:</p>
<ul>
<li>Access NatureCounts auxiliary tables: <a href="#id_2.1AuxTables">Access Auxiliary Tables</a>
</li>
<li>Filter and view NatureCounts auxiliary tables: <a href="#id_2.2FilterAuxTables">Filter Auxiliary Tables</a>
</li>
<li>Convert Julian dates to month, day, and time: <a href="#id_2.3rNest_dates">rNest - Initiation and Fledging Dates</a>
</li>
<li>Combine spatial data by attribute field: <a href="#id_2.4rNest_ecodistricts">rNest - Ecodistricts</a>
</li>
<li>Create basic data summaries: <a href="#id_2.5rNest_summary">rNest -
Data Summary</a>
</li>
<li>Map rNest data across ecodistricts: <a href="#id_2.6rNest_maps">rNest - Mapping</a>
</li>
</ul>
<p>This R tutorial requires the following packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/BirdsCanada/naturecounts" class="external-link">naturecounts</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="id_2-1AuxTables">2.1 Accessing Auxiliary Tables From <code>naturecounts</code><a class="anchor" aria-label="anchor" href="#id_2-1AuxTables"></a>
</h2>
<p>NatureCounts hosts a variety of useful datasets that exist outside of
the bird monitoring projects available for download <a href="https://naturecounts.ca/nc/default/datasets.jsp" class="external-link">online</a> or
through the <code><a href="../reference/nc_data_dl.html">nc_data_dl()</a></code> function in R.</p>
<p>To browse the list of available auxiliary data tables, we can use the
<code><a href="../reference/nc_query_table.html">nc_query_table()</a></code> function. Specify your
<code>naturecounts</code> username for the complete list based on your
access level. You will be prompted to enter your password.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/nc_query_table.html">nc_query_table</a></span><span class="op">(</span>username <span class="op">=</span> <span class="st">"testuser"</span><span class="op">)</span></span>
<span><span class="co">#&gt;              table_name                        filters required</span></span>
<span><span class="co">#&gt; 1    AtlasSquareSummary                 statprove_code       NA</span></span>
<span><span class="co">#&gt; 2 bmde_filter_bad_dates project_id,SiteCode,species_id       NA</span></span>
<span><span class="co">#&gt; 3                 Rnest                           &lt;NA&gt;       NA</span></span>
<span><span class="co">#&gt; 4    SpeciesLifeHistory                           &lt;NA&gt;       NA</span></span></code></pre></div>
<p>You’ll notice the <code>filters</code> and <code>required</code>
columns. The former refers to the unique filter arguments that may be
used for each table in your download queries. <em>what does the required
column signify?</em></p>
<p>To download a specific table like <strong>Rnest</strong> from the
list, specify the <code>table</code> argument.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rnest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nc_query_table.html">nc_query_table</a></span><span class="op">(</span>table <span class="op">=</span> <span class="st">"Rnest"</span>, username <span class="op">=</span> <span class="st">"testuser"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="id_2-2FilterAuxTables">2.2 Filtering Auxiliary Tables From <code>naturecounts</code><a class="anchor" aria-label="anchor" href="#id_2-2FilterAuxTables"></a>
</h2>
<p>Built-in filters can be useful to query specific datasets.</p>
<p>For example, you can query the <code>AtlasSquareSummary</code> table
by <code>statprov_code</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">atlas_square_summ_on</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nc_query_table.html">nc_query_table</a></span><span class="op">(</span>table <span class="op">=</span> <span class="st">"AtlasSquareSummary"</span>, username <span class="op">=</span> <span class="st">"testuser"</span>,</span>
<span>                                       statprov_code <span class="op">=</span> <span class="st">"ON"</span><span class="op">)</span> <span class="co"># filter data for Ontario</span></span></code></pre></div>
<p>You can also query the <code>bmde_filter_bad_dates</code> table by
<code>project_id</code>, <code>SiteCode</code>, or
<code>species_id</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bmde_fbd_query</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nc_query_table.html">nc_query_table</a></span><span class="op">(</span>table <span class="op">=</span> <span class="st">"bmde_filter_bad_dates"</span>, username <span class="op">=</span> <span class="st">"testuser"</span>, project_id <span class="op">=</span> <span class="st">"1013"</span><span class="op">)</span></span></code></pre></div>
<p>You can otherwise query any table by any relevant column after
download, like <code>species_id</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rnest_query</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">rnest</span>, <span class="va">speciesID</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15770</span>, <span class="fl">47674</span><span class="op">)</span><span class="op">)</span> <span class="co"># filter for the American Robin and Common Gull</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="id_2-3rNest_dates">2.3 rNest: Initiation and Fledging Dates<a class="anchor" aria-label="anchor" href="#id_2-3rNest_dates"></a>
</h2>
<p><code>rNest</code> is an R package that enables the backcalculation
of nest chronologies from nest observations. It helps describe nesting
phenology based on nest records held in the BirdsCanada database. The
development of this package aims to produce a robust description of bird
nesting phenology for 311 bird species across Canada. See the report <a href="https://publications.gc.ca/site/eng/9.843360/publication.html" class="external-link">here</a>.</p>
<blockquote>
<p><strong>Initiation</strong> date - estimated date when the first egg
was laid for each nest attempt.</p>
<p><strong>Fledging</strong> date - estimated date that the first
nestling leaves the nest, for each nest attempt.</p>
</blockquote>
<p>Let’s examine the rNest query we performed for the <strong>American
Robin</strong> and <strong>Common Gull</strong> in the last step. The
initiation and fledging dates use the Julian date format. We can convert
these dates to the day, month, and time-of-day for each event,
respectively.</p>
<p>Ensure that each column is in numeric format.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rnest_query</span> <span class="op">&lt;-</span> <span class="va">rnest_query</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">initiation</span>, <span class="va">fledging</span><span class="op">)</span>, <span class="va">as.numeric</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Create an arbitrary base date, assuming the event dates are not for a
leap year.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">base_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2025-01-01"</span><span class="op">)</span></span></code></pre></div>
<p>Create two new date columns by converting the Julian dates to
standard format.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rnest_query</span> <span class="op">&lt;-</span> <span class="va">rnest_query</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    initiation_date <span class="op">=</span> <span class="va">base_date</span> <span class="op">+</span> <span class="va">initiation</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>    fledging_date <span class="op">=</span> <span class="va">base_date</span> <span class="op">+</span> <span class="va">fledging</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Extract the fractional Julian dates and convert to time.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rnest_query</span> <span class="op">&lt;-</span> <span class="va">rnest_query</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    initiation_time <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">hours</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="op">(</span><span class="va">initiation</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">initiation</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">24</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    fledging_time <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">hours</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="op">(</span><span class="va">fledging</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">fledging</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">24</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Extract month and day using the <code><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month()</a></code> and
<code><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">day()</a></code> functions from the <code>lubridate</code>
package.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rnest_query</span> <span class="op">&lt;-</span> <span class="va">rnest_query</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    initiation_month <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="va">initiation_date</span><span class="op">)</span>,</span>
<span>    initiation_day <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">day</a></span><span class="op">(</span><span class="va">initiation_date</span><span class="op">)</span>,</span>
<span>    fledging_month <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="va">fledging_date</span><span class="op">)</span>,</span>
<span>    fledging_day <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">day</a></span><span class="op">(</span><span class="va">fledging_date</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">speciesID</span>,</span>
<span>    <span class="va">speciesEnglish</span>,</span>
<span>    <span class="va">speciesFrench</span>,</span>
<span>    <span class="va">initiation</span>,</span>
<span>    <span class="va">initiation_month</span>,</span>
<span>    <span class="va">initiation_day</span>,</span>
<span>    <span class="va">initiation_time</span>,</span>
<span>    <span class="va">fledging</span>,</span>
<span>    <span class="va">fledging_month</span>,</span>
<span>    <span class="va">fledging_day</span>,</span>
<span>    <span class="va">fledging_time</span>,</span>
<span>    <span class="va">districtID</span>,</span>
<span>    <span class="va">districtNameEn</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="id_2-4rNest_ecodistricts">2.4 rNest: Ecodistricts<a class="anchor" aria-label="anchor" href="#id_2-4rNest_ecodistricts"></a>
</h2>
<p>To help represent the rNest data visually, we’ll incorporate spatial
data from the The National Ecological Framework for Canada which is
available <a href="https://open.canada.ca/data/en/dataset/3ef8e8a9-8d05-4fea-a8bf-7f5023d2b6e1" class="external-link">here</a>.
For more in-depth examples on manipulating NatureCounts and spatial
data, see the <a href="https://github.com/BirdsCanada/NatureCounts_SpatialData_Tutorial.git" class="external-link">NatureCounts_SpatialData_Tutorial</a>
series.</p>
<blockquote>
<p>The rNest data contains the <code>districtID</code> field, which
refers to the ecodistrict where the observation event took place. An
<strong>ecodistrict</strong> is a subdivision of an ecoregion and is
characterized by distinctive assemblages of relief, landforms, geology,
soil, vegetation, water bodies and fauna.</p>
</blockquote>
<p>The Ecodistricts spatial data is available as a series of
pre-packaged GeoJSON files in this <a href="https://agriculture.canada.ca/atlas/data_donnees/nationalEcologicalFramework/data_donnees/geoJSON/ed/" class="external-link">subdirectory</a>.
Were interested in the base layer GeoJSON file, displayed in raw text
format at this <a href="https://agriculture.canada.ca/atlas/data_donnees/nationalEcologicalFramework/data_donnees/geoJSON/ed/nef_ca_ter_ecodistrict_v2_2.geojson" class="external-link">URL</a>.</p>
<p>Read in the Ecodistricts layer from the URL using the
<code><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read()</a></code> function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Copy-paste the URL to the Ecodistricts base-layer</span></span>
<span><span class="va">geojson_url</span> <span class="op">&lt;-</span> <span class="st">"https://agriculture.canada.ca/atlas/data_donnees/nationalEcologicalFramework/data_donnees/geoJSON/ed/nef_ca_ter_ecodistrict_v2_2.geojson"</span></span>
<span></span>
<span><span class="co"># Read the GeoJSON file directly from the URL</span></span>
<span><span class="va">ecodistricts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">geojson_url</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading layer `nef_ca_ter_ecodistrict_v2_2' from data source </span></span>
<span><span class="co">#&gt;   `https://agriculture.canada.ca/atlas/data_donnees/nationalEcologicalFramework/data_donnees/geoJSON/ed/nef_ca_ter_ecodistrict_v2_2.geojson' </span></span>
<span><span class="co">#&gt;   using driver `GeoJSON'</span></span>
<span><span class="co">#&gt; Simple feature collection with 1025 features and 7 fields</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -140.9994 ymin: 41.67355 xmax: -52.36457 ymax: 83.63317</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span></span>
<span><span class="co"># Inspect the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ecodistricts</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 1025 features and 7 fields</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -140.9994 ymin: 41.67355 xmax: -52.36457 ymax: 83.63317</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; First 10 features:</span></span>
<span><span class="co">#&gt;    OBJECTID ECODISTRICT_ID ECOREGION_ID ECOZONE_ID ECOPROVINCE_ID SHAPE_Length  SHAPE_Area                       geometry</span></span>
<span><span class="co">#&gt; 1         1            139           33          3            3.1    1607587.8 75412497241 POLYGON ((-132.2716 69.7853...</span></span>
<span><span class="co">#&gt; 2         2            134           32          3            3.1    1563994.4 62401339357 POLYGON ((-136.9713 69.3404...</span></span>
<span><span class="co">#&gt; 3         3            135           32          3            3.1     165084.9  1966035838 POLYGON ((-139.1093 69.6522...</span></span>
<span><span class="co">#&gt; 4         4            856          165         11           11.1    1141040.5 45812538986 POLYGON ((-139.8334 69.5159...</span></span>
<span><span class="co">#&gt; 5         5            863          167         11           11.2    1523135.0 42356398185 POLYGON ((-140.9974 68.1527...</span></span>
<span><span class="co">#&gt; 6         6            209           53          4            4.2     568436.5  2633988287 POLYGON ((-133.8711 67.5002...</span></span>
<span><span class="co">#&gt; 7         7            212           53          4            4.2    1018745.7 14794658824 POLYGON ((-133.7398 67.4543...</span></span>
<span><span class="co">#&gt; 8         8            213           53          4            4.2    1062059.6 35095791510 POLYGON ((-130.1416 66.8694...</span></span>
<span><span class="co">#&gt; 9         9            866          168         11           11.3    1154925.7 64356636287 POLYGON ((-136.2435 65.7265...</span></span>
<span><span class="co">#&gt; 10       10            897          175         12           12.2    2001852.3 97480332759 POLYGON ((-136.6212 63.1381...</span></span></code></pre></div>
<p>Rename the <code>districtID</code> field in the
<code>rnest_query</code> dataframe to match the one in the
<code>ecodistricts</code> layer.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rnest_query</span> <span class="op">&lt;-</span> <span class="va">rnest_query</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>ECODISTRICT_ID <span class="op">=</span> <span class="va">districtID</span><span class="op">)</span></span></code></pre></div>
<p>Combine the <code>rnest_query</code> data with the
<code>ecodistricts</code> data in a new dataframe called
<code>rnest_join</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rnest_join</span> <span class="op">&lt;-</span> <span class="va">rnest_query</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">ecodistricts</span>, by <span class="op">=</span> <span class="st">"ECODISTRICT_ID"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="id_2-5rNest_summary">2.5 rNest: Data Summary<a class="anchor" aria-label="anchor" href="#id_2-5rNest_summary"></a>
</h2>
<p>Filter for American Robin (speciesID = 15770)</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rnest_robin</span> <span class="op">&lt;-</span> <span class="va">rnest_join</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">speciesID</span> <span class="op">==</span> <span class="fl">15770</span><span class="op">)</span></span></code></pre></div>
<p>Calculate the mean fledge age of fledglings from each initiation
month, respectively, and create a boxplot.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate fledge age </span></span>
<span><span class="va">rnest_robin</span> <span class="op">&lt;-</span> <span class="va">rnest_robin</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    fledge_age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">fledging</span> <span class="op">-</span> <span class="va">initiation</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot fledge age (days) by initiation month</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">rnest_robin</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">initiation_month</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">fledge_age</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"orange"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"3"</span> <span class="op">=</span> <span class="st">"March"</span>, <span class="st">"4"</span> <span class="op">=</span> <span class="st">"April"</span>, <span class="st">"5"</span> <span class="op">=</span> <span class="st">"May"</span>, <span class="st">"6"</span> <span class="op">=</span> <span class="st">"June"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Initiation Month"</span>, y <span class="op">=</span> <span class="st">"Fledge Age (Days)"</span>, </span>
<span>       title <span class="op">=</span> <span class="st">"Mean Fledge Age of the American Robin by Initiation Month"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures%2Fnc_at2_fledge_age_boxplot-1.png" alt="Boxplot represents the mean fledge age from each initiation month."></p>
<p>The mean fledge age for the American Robin appears to decrease with
each subsequent initiation month.</p>
</div>
<div class="section level2">
<h2 id="id_2-6rNest_maps">2.6 rNest: Mapping<a class="anchor" aria-label="anchor" href="#id_2-6rNest_maps"></a>
</h2>
<p>Let’s visualize some potential nesting patterns using the combined
rNest and ecodistricts dataset. We can start by mapping the ecodistricts
to compare fledging dates for the <strong>American Robin</strong>.</p>
<p>Convert the <code>rnest_join</code> dataframe to an <code>sf</code>
object using the existing ‘geometry’ column</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rnest_robin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span><span class="va">rnest_robin</span><span class="op">)</span></span></code></pre></div>
<p>Assign a Coordinate Reference System (CRS) like
<strong>EPSG:4326</strong> (WGS84) to the combined data.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rnest_robin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">rnest_robin</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span></code></pre></div>
<p>Use <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot()</a></code> to visualize the Ecodistricts using a color
ramp that represents fledging date.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot ecodistricts with fledging date color ramp</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rnest_robin</span>, fill <span class="op">=</span> <span class="st">"grey80"</span>, color <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Base ecodistrict map</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rnest_robin</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">fledging</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span>, name <span class="op">=</span> <span class="st">"Fledging Date"</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Color ramp for fledging date</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Fledging Dates (Julian) by Ecodistrict for the American Robin"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Source: rNest and National Ecological Framework for Canada"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures%2Fnc_at2_ecodistricts-1.png" alt="Map visualizes the ecodistricts by fledging data using a color ramp."></p>
<p><strong>Congratulations!</strong> You completed <strong>Chapter 2:
Auxiliary Tables</strong>. Here, you accessed NatureCounts auxiliary
tables using the <code>nc_query_tables</code> function. You also created
basic data summaries and maps using rNest and ecodistricts data.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Steffi LaZerte, Denis Lepage.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
