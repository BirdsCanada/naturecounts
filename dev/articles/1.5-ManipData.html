<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 5 - Data Manipulation • naturecounts</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Chapter 5 - Data Manipulation">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">naturecounts</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.4.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/1.1-Introduction.html">Chapter 1 - Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/1.2-LoadPackage.html">Chapter 2 - Loading R Packages</a></li>
    <li><a class="dropdown-item" href="../articles/1.3-ViewData.html">Chapter 3 - Understanding and Viewing Data</a></li>
    <li><a class="dropdown-item" href="../articles/1.4-DownloadData.html">Chapter 4 - Downloading and Filtering Data</a></li>
    <li><a class="dropdown-item" href="../articles/1.5-ManipData.html">Chapter 5 - Data Manipulation</a></li>
    <li><a class="dropdown-item" href="../articles/1.6-VisualData.html">Chapter 6 - Data Visualization</a></li>
    <li><a class="dropdown-item" href="../articles/1.7-Answers.html">Chapter 7 - Answers</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BirdsCanada/naturecounts/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Chapter 5 - Data Manipulation</h1>
            
            <h4 data-toc-skip class="date">2025-03-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/BirdsCanada/naturecounts/blob/docs-update/vignettes/articles/1.5-ManipData.Rmd" class="external-link"><code>vignettes/articles/1.5-ManipData.Rmd</code></a></small>
      <div class="d-none name"><code>1.5-ManipData.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="Manip5">Data Manipulation<a class="anchor" aria-label="anchor" href="#Manip5"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/BirdsCanada/naturecounts" class="external-link">naturecounts</a></span><span class="op">)</span></span></code></pre></div>
<p>You have successfully downloaded your NatureCounts dataset and are
ready to explore and summarise the data. In this chapter we will
demonstrate how to do some basic data manipulations and summaries. The
possibilities are endless, so we try to focus on examples we think would
be most valuable to users. We intend to develop <code>collection</code>
and <code>protocol_id</code> specific data manipulation and analysis
code in the future. If you have specific requests or would like to
contribute your existing code, please contact <a href="mailto:dethier@birdscanada.org" class="email">dethier@birdscanada.org</a>.</p>
<blockquote>
<p>The code in this Chapter will not work unless you replace
<code>"testuser"</code> with your actual user name. You will be prompted
to enter your password.</p>
</blockquote>
<div class="section level3">
<h3 id="Manip5-1">Basic data wrangling<a class="anchor" aria-label="anchor" href="#Manip5-1"></a>
</h3>
<p>Recall in <a href="#Package2.2">Chapter 2</a> you installed the <a href="https://www.tidyverse.org/" class="external-link">tidyverse</a> package, which included
dplyr for data manipulations. You are encouraged to learn more about
this function by reviewing the <a href="https://r4ds.had.co.nz/transform.html" class="external-link">Data Transformations</a>
chapter in “R for Data Science” by Hadley Wickham and Garrett Grolemund.
We also recommend you download a copy of the RStudio <a href="https://rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf" class="external-link">Data
Wrangling</a> cheat sheet as a reference document.</p>
<p>We are going to apply three key dplyr functions which will give you
some of the basic tools needed to solve the vast majority of your data
manipulation challenges. These functions include:</p>
<ul>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code>: Pick variables by their names (columns)</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter()</a></code>: Pick observations by their values (rows)</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise()</a></code>: Collapse many values down to a single
summary (often with <code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by()</a></code>)</li>
</ul>
<p>Let’s continue using the full <a href="https://naturecounts.ca/nc/default/datasets.jsp?code=WPWI" class="external-link">Ontario
Whip-poor-will</a> collection for this chapter.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">WPWI</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nc_data_dl.html">nc_data_dl</a></span><span class="op">(</span>collections <span class="op">=</span> <span class="st">"WPWI"</span>, username <span class="op">=</span> <span class="st">"testuser"</span>, info <span class="op">=</span> <span class="st">"tutorial example"</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="Manip5-1-1">Select<a class="anchor" aria-label="anchor" href="#Manip5-1-1"></a>
</h4>
<p>You will notice that NatureCounts datasets have many fields (i.e.,
columns) available. Generally, you will only want a few of these fields
for your summary or analysis. Recall the complete version of the <a href="#Data3.1">BMDE</a> includes 265 fields. The number of variables
downloaded from the BMDE will depend on the <code>fields_set</code>,
which is by default “minimum” (57 fields). You can narrow in on the
variables you are interested in with the <code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code> function,
which allows you to subset the dataframe based on the names of the
variables.</p>
<p>For example, we are going to <code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code> a subset of
variables from the WPWI dataset that we need for our summary:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">WPWI_select</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">WPWI</span>, <span class="st">"SurveyAreaIdentifier"</span>, </span>
<span>                      <span class="st">"RouteIdentifier"</span>, <span class="st">"species_id"</span>, <span class="st">"latitude"</span>, </span>
<span>                      <span class="st">"longitude"</span>, <span class="st">"bcr"</span>, <span class="st">"survey_day"</span>, <span class="st">"survey_month"</span>, </span>
<span>                      <span class="st">"survey_year"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="Manip5-1-2">Filter<a class="anchor" aria-label="anchor" href="#Manip5-1-2"></a>
</h4>
<p>Often there are observational records in a database that are not
needed. We could have filtered these records out using the
<code><a href="../reference/nc_data_dl.html">nc_data_dl()</a></code> <a href="#Dowload4.2">filters</a>. However, we
can also use the <code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">dplyr::filter()</a></code> function, which allows us
to subset observations based on their row values. Observations are
selected using:</p>
<ul>
<li>Comparison operators:<code>&gt;</code>, <code>&gt;=</code>,
<code>&lt;</code>, <code>&lt;=</code>, <code>!=</code> (not equal),
<code>==</code> (equal)</li>
<li>Logical operators: <code>&amp;</code> (and), <code>|</code> (or),
<code>!</code> (is not)</li>
</ul>
<p>There are worked examples provided in the naturecounts article <a href="https://birdscanada.github.io/naturecounts/articles/filtering-data.html">Filtering
data after download</a> to get you started with applying filters. These
include:</p>
<ul>
<li>Categorical filters</li>
<li>Numerical filters</li>
<li>Date filters</li>
</ul>
<p>Here we provide a few additional examples for you to work with.
First, lets apply a simple <code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter()</a></code> that subsets the data
based on a single survey month:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">WPWI_June</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">WPWI_select</span>, <span class="va">survey_month</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<p>Now lets try multiple survey months by adding a logical operator:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">WPWI_JJ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">WPWI_select</span>, <span class="va">survey_month</span> <span class="op">==</span> <span class="fl">6</span> <span class="op">|</span> <span class="va">survey_month</span> <span class="op">==</span> <span class="fl">7</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Alternatively this can be written as:</span></span>
<span><span class="va">WPWI_JJ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">WPWI_select</span>, <span class="va">survey_month</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">7</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can continue to add to the complexity of our filter:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">WPWI_multi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">WPWI_select</span>, </span>
<span>                     <span class="va">survey_month</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">7</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">bcr</span> <span class="op">==</span> <span class="fl">12</span> <span class="op">&amp;</span> </span>
<span>                       <span class="va">survey_year</span> <span class="op">&gt;=</span> <span class="fl">2010</span> <span class="op">&amp;</span> <span class="va">survey_year</span> <span class="op">&lt;=</span> <span class="fl">2012</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="Manip5-1-3">Summarise<a class="anchor" aria-label="anchor" href="#Manip5-1-3"></a>
</h4>
<p>Now that we have selected the columns we need for our analysis we
will demonstrate how to summarise the data. The <code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise()</a></code>
function is most useful if paired with the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by()</a></code>
argument, because this changes the unit of analysis from the complete
dataset to individual groups.</p>
<p>For example, say we want to determine how many point count stops were
on each WPWI Route. We will want to group observations by
<code>RouteIdentifier</code> and summarise the number of distinct
<code>SurveyAreaIdentifier</code> entries using the
<code><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct()</a></code> function and creating a new column named
<code>Nstops</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">WPWI_Route</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">WPWI_select</span>, <span class="va">RouteIdentifier</span><span class="op">)</span></span>
<span><span class="va">WPWI_Route</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="va">WPWI_Route</span>, Nstops <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">SurveyAreaIdentifier</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>However, now that we’re getting on to more complex operations, we’ll
introduce the use of the pipe <code>%&gt;%</code>. Piping can be used to
chain a sequence of functions, in order to avoid creating multiple
intermediate objects which can clutter our Environment! This allows you
to pass (pipe) the output of one line as input to the next line.
Therefore, the previous code can be re-written as:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">WPWI_Route</span> <span class="op">&lt;-</span> <span class="va">WPWI_select</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">RouteIdentifier</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>Nstops <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">SurveyAreaIdentifier</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">WPWI_Route</span><span class="op">)</span></span></code></pre></div>
<p>Note that there is a pipe (<code>%&gt;%</code>) between each set of
lines and that the data (<code>WPWI_select</code>) is only referred to
once, at the very start. These two different codes achieve the exact
same result.</p>
<p>Back to our example, we might also want to know how many routes were
run in each year.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">WPWI_Year</span> <span class="op">&lt;-</span> <span class="va">WPWI_select</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">survey_year</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>Nroute <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">n_distinct</a></span><span class="op">(</span><span class="va">RouteIdentifier</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">WPWI_Year</span><span class="op">)</span></span></code></pre></div>
<p>Finally, lets look to see how many Observations of WPWI were made in
each year. Since each row of data represents a survey point, we want to
count the number of rows containing species_id = “7871” within each
unique year. We can do this by first removing the ‘NA’ using the
<code>filter</code> function, and then use the <code>group_by</code> and
<code>summarise</code> to determine the ‘length’ of the dataset (i.e.,
the number of rows with WPWI sightings).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">WPWI_Obs</span> <span class="op">&lt;-</span> <span class="va">WPWI_select</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span> <span class="op">(</span><span class="va">species_id</span> <span class="op">!=</span> <span class="st">"NA"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">survey_year</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>SumObs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">species_id</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">WPWI_Obs</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="Manip5-2">Combine datasets<a class="anchor" aria-label="anchor" href="#Manip5-2"></a>
</h3>
<p>There are many reasons to join two datatables. For example, if you
have species observations across several years you might want to
associate these with weather covariates to assess if they are
correlated. Or you might have observations over a specific geographic
region, which you wish to associate with land cover covariates. To do
this, you will want to join (merge) two tables. Looking at the <a href="https://rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf" class="external-link">Data
Wrangling</a> cheat sheet, you will notice there are several
<code>join</code> functions. In all instances, you will need to specify
the <strong>key</strong> variable, which is found in both tables, which
is used for binding the tables together.</p>
<p>Here we provide an example using metadata available to you in
naturecounts.</p>
<p>When you pull <code>collections</code> with the “minimum”
<code>fields_set</code> (default) you will notice you get the species_id
column, but not alpha species code. For example, let’s pull a small
amount of data from the second Alberta Breeding Bird Atlas (ABATLAS2)
from Beaverhill Lake Important Bird Area (AB001) in 2005.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">AB_Atlas</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/nc_data_dl.html">nc_data_dl</a></span><span class="op">(</span>collections<span class="op">=</span><span class="st">"ABATLAS2"</span>, region<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>iba <span class="op">=</span> <span class="st">"AB001"</span><span class="op">)</span>, years<span class="op">=</span><span class="fl">2005</span>, username <span class="op">=</span> <span class="st">"testuser"</span>, info <span class="op">=</span> <span class="st">"tutorial example"</span><span class="op">)</span></span></code></pre></div>
<p>Notice there are 57 variables, including is a numeric species_id, but
no alpha species code.</p>
<p>To rectify this, there are two options:</p>
<ol style="list-style-type: decimal">
<li>Set the <code>fields_set</code> argument to <em>extended</em>.</li>
</ol>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">AB_Atlas2</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/nc_data_dl.html">nc_data_dl</a></span><span class="op">(</span>collections<span class="op">=</span><span class="st">"ABATLAS2"</span>, region<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>iba <span class="op">=</span> <span class="st">"AB001"</span><span class="op">)</span>, years<span class="op">=</span><span class="fl">2005</span>, fields_set<span class="op">=</span><span class="st">"extended"</span>, username <span class="op">=</span> <span class="st">"testuser"</span>, info <span class="op">=</span> <span class="st">"tutorial example"</span><span class="op">)</span></span></code></pre></div>
<p>Notice you are now pulling 285 variables, including the CommonName.
However, for this particular dataset, there is still no alpha code
(SpeciesCode). Most datasets will have these in the BMDE, this one does
not. Lets add them using the an auxiliary table.</p>
<ol start="2" style="list-style-type: decimal">
<li>Create a species code table using the available metadata and then
join this to your existing data table.</li>
</ol>
<p>First, identify the appropriate taxonomic authority using the
metadata.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">authority</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/meta.html">meta_species_authority</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">authority</span><span class="op">)</span></span></code></pre></div>
<p>Second, pull the species code table, and filter for the “ABATLAS2”
authority.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">species</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/meta.html">meta_species_codes</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span></span>
<span><span class="va">species</span><span class="op">&lt;-</span><span class="va">species</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">authority</span><span class="op">==</span><span class="st">"ABATLAS2"</span><span class="op">)</span></span></code></pre></div>
<p>Third, join your tables so that it includes the desired species
information.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">AB_Atlas_sp</span><span class="op">&lt;-</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">AB_Atlas</span>, <span class="va">species</span>, by<span class="op">=</span><span class="st">"species_id"</span><span class="op">)</span></span></code></pre></div>
<p>Now your datatable contains the species code, which is familiar to
most birders. You can also try joining the Atlas data to the
meta_species_taxonomy() table if you wish to capture the english common,
french, or scientific names, among other fields.</p>
</div>
<div class="section level3">
<h3 id="Manip5-3">Helper functions<a class="anchor" aria-label="anchor" href="#Manip5-3"></a>
</h3>
<p>There are a few additional helper functions built into the
naturecounts R package that you may find useful. At present, they
include:</p>
<ul>
<li>
<a href="https://birdstudiescanada.github.io/naturecounts/reference/format_dates.html" class="external-link"><code>format_dates()</code></a>:Creates
and adds date and day-of-year (doy) field/columns to data</li>
<li>
<a href="https://birdstudiescanada.github.io/naturecounts/reference/format_zero_fill.html" class="external-link"><code>formate_zero_fill()</code></a>:
Zero-fill the species presence data by adding zero observations counts
(absences) to an existing NatureCounts dataset</li>
</ul>
<p>The zero-fill function is particularly important if you want to
ensure your dataset is complete!</p>
</div>
<div class="section level3">
<h3 id="Manip5-4">Exercies<a class="anchor" aria-label="anchor" href="#Manip5-4"></a>
</h3>
<p><em>Exercise 1</em>: You are doing a research project using the fall
migration monitoring data collected at <a href="https://naturecounts.ca/nc/default/datasets.jsp?code=CMMN-DET-VLBO" class="external-link">Vaseux
Lake Bird Observatory</a>, British Columbia. You request the open access
data from 2017-2020. After you request this subset of the collection,
you need to determine the number of unique days Gray catbirds were
records in each year?</p>
<p>Answer: 2017 = 54 2018 = 53</p>
<p><em>Exercise 2</em>: Building off the same dataset used in Exercise
1, you now want to zero-fill the dataframe to ensure it is complete for
your study on Gray catbirds. How many records (rows) are in the
zero-fill Gray catbird dataframe?</p>
<p>Answer: 152</p>
<p>Answers to the exercises can be found in <a href="#Ans7.3">Chapter
7</a>.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Steffi LaZerte, Denis Lepage.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
