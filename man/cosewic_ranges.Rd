% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cosewic_tools.R
\name{cosewic_ranges}
\alias{cosewic_ranges}
\title{Calculate COSEWIC IAO and EOO}
\usage{
cosewic_ranges(
  df_db,
  record_id = "record_id",
  coord_lon = "longitude",
  coord_lat = "latitude",
  iao_grid_size_km = 2,
  eoo_p = 0.95,
  plot = TRUE,
  spatial = TRUE
)
}
\arguments{
\item{df_db}{Either data frame or a connection to database with
\code{naturecounts} table.}

\item{record_id}{Character. Name of the column containing record
identification.}

\item{coord_lon}{Character. Name of the column containing longitude.}

\item{coord_lat}{Character. Name of the column containing latitude.}

\item{iao_grid_size_km}{Numeric. Size of grid (km) to use when calculating
IAO. Default is COSEWIC requirement (2). Use caution if changing.}

\item{eoo_p}{Numeric. The percentile to calculate the convex hull over.
Defaults to 0.95 for a 95\% convex hull to ensure outlier points do not
artificially inflate the EOO. Note that for a final COSEWIC report, this
may not be appropriate. Set to 1 to include all points.}

\item{plot}{Logical. Whether to return plot}

\item{spatial}{Logical. Whether to return sf spatial objects showing
calculations.}
}
\value{
Data frame or list containing data frame, and (optionally) plot,
and spatial data frames.
}
\description{
The COSEWIC Index of Area of Occupancy (IAO; also called Area of Occupancy,
AOO by the IUCN) and Extent of Occurrence (EOO; IUCN as well) are metrics
used to support status assessments for potentially endangered species.
}
\details{
Note that the while the IUCN calls this metric AOO, in COSEWIC, AOO is actually
a different measure, the \emph{biological} area of occupancy. See the
\href{https://cosewic.ca/index.php/en-ca/reports/preparing-status-reports/instructions-preparing-status-reports.html#Distribution}{Distribution}
section in 'Instructions for preparing COSEWIC status reports'
for more details.

By default the EOO is calculated only using the inner 95\% of points (based on
distance to the centroid). This is to ensure that a first-pass of the EOO
does not reject a species from consideration if there are any outlier
observations. However, for a final COSEWIC assessment report, it is likely
better to carefully explore the data to ensure there are no outliers and then
use the full data set (i.e. set \code{eoo_p = 1}).

The IAO is calculated by first assessing large grids (10x large than the
specified size). Only then are smaller grids created within large grid cells
containing observations. This speeds up the process by avoiding the creation
of grids in areas where there are no observations. This means that the plots
and spatial objects may not have grids over large areas lacking observations.
See examples.

Details on how IAO and EOO are calculated and used
\itemize{
\item COSEWIC - \href{https://www.cosewic.ca/index.php/en-ca/reports/preparing-status-reports/guidelines-index-area-occupancy.html}{Guidelines for use of the Index of Area of Occupancy in COSEWIC Assessments}
\item COSEWIC - \href{https://cosewic.ca/index.php/en-ca/reports/preparing-status-reports/instructions-preparing-status-reports.html}{Instructions for preparing COSEWIC status reports}
\item COSEWIC - \href{https://www.cosewic.ca/index.php/en-ca/assessment-process/wildlife-species-assessment-process-categories-guidelines/quantitative-criteria.html}{Table 2 COSEWIC quantitative criteria and guidelines for the status assessment of Wildlife Species}
}
}
\examples{

# Using the included, test data on black-capped chickadees

bcch # look at the data

r <- cosewic_ranges(bcch)
r <- cosewic_ranges(bcch, spatial = FALSE)
r <- cosewic_ranges(bcch, spatial = FALSE, plot = FALSE)

# Use multiple species
library(purrr)
library(dplyr)
library(tidyr)

# Get multiple species
mult <- rbind(bcch, hofi)

# Nest
mult <- nest(mult,  .by = species_id)
mult

# Calculate ranges for nested data
r <- mutate(mult, results = map(data, cosewic_ranges, plot = FALSE, spatial = FALSE))
r <- unnest(r, results)
r

# To also return plot and spatial
r <- mutate(mult, results = map(data, cosewic_ranges))
r <- unnest_wider(r, results) \%>\%
  unnest(ranges)
r

# Take a look at one specifically
r$plot[[1]]

}
