<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mapping Observations • naturecounts</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Mapping Observations">
<meta property="og:description" content="naturecounts">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">naturecounts</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.2.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/BirdStudiesCanada/naturecounts" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Mapping Observations</h1>
            
            <h4 data-toc-skip class="date">2022-02-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/BirdStudiesCanada/naturecounts/blob/HEAD/vignettes/articles/mapping-observations.Rmd" class="external-link"><code>vignettes/articles/mapping-observations.Rmd</code></a></small>
      <div class="hidden name"><code>mapping-observations.Rmd</code></div>

    </div>

    
    
<p>In this article we’ll walk through how to create various types of maps of the observations downloaded with <code>naturecounts</code> to get a sense of the spatial distribution.</p>
<blockquote>
<p>The following examples use the “testuser” user which is not available to you. You can quickly <a href="https://www.birdscanada.org/birdmon/default/register.jsp" class="external-link">sign up for a free account</a> of your own to access and play around with these examples.</p>
</blockquote>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>To do so we’re going to use the following packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/BirdStudiesCanada/naturecounts" class="external-link">naturecounts</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ropenscilabs/rnaturalearth" class="external-link">rnaturalearth</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dkahle/ggmap" class="external-link">ggmap</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/mapview" class="external-link">mapview</a></span><span class="op">)</span></code></pre></div>
<p>First we’ll use download some data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">house_finches</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nc_data_dl.html">nc_data_dl</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fl">20350</span>, region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>statprov <span class="op">=</span> <span class="st">"AB"</span><span class="op">)</span>, 
                            username <span class="op">=</span> <span class="st">"testuser"</span>, info <span class="op">=</span> <span class="st">"nc_tutorial"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Using filters: species (20350); fields_set (BMDE2.00-min); statprov (AB)</span></code></pre>
<pre><code><span class="co">## Collecting available records...</span></code></pre>
<pre><code><span class="co">##   collection nrecords</span>
<span class="co">## 1   ABATLAS1       10</span>
<span class="co">## 2   ABATLAS2      202</span>
<span class="co">## 3 ABBIRDRECS        4</span>
<span class="co">## 4        BBS       14</span>
<span class="co">## 5  BBS50-CAN       36</span>
<span class="co">## 6        PFW     6110</span>
<span class="co">## Total records: 6,376</span></code></pre>
<pre><code><span class="co">## </span>
<span class="co">## Downloading records for each collection:</span></code></pre>
<pre><code><span class="co">##   ABATLAS1</span></code></pre>
<pre><code><span class="co">##     Records 1 to 10 / 10</span></code></pre>
<pre><code><span class="co">##   ABATLAS2</span></code></pre>
<pre><code><span class="co">##     Records 1 to 202 / 202</span></code></pre>
<pre><code><span class="co">##   ABBIRDRECS</span></code></pre>
<pre><code><span class="co">##     Records 1 to 4 / 4</span></code></pre>
<pre><code><span class="co">##   BBS</span></code></pre>
<pre><code><span class="co">##     Records 1 to 14 / 14</span></code></pre>
<pre><code><span class="co">##   BBS50-CAN</span></code></pre>
<pre><code><span class="co">##     Records 1 to 36 / 36</span></code></pre>
<pre><code><span class="co">##   PFW</span></code></pre>
<pre><code><span class="co">##     Records 1 to 5000 / 6110</span></code></pre>
<pre><code><span class="co">##     Records 5001 to 6110 / 6110</span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">house_finches</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##   record_id collection project_id protocol_id protocol_type species_id</span>
<span class="co">## 1 225617858   ABATLAS1       1048          NA            NA      20350</span>
<span class="co">## 2 225620472   ABATLAS1       1048          NA            NA      20350</span>
<span class="co">## 3 225630776   ABATLAS1       1048          NA            NA      20350</span>
<span class="co">## 4 225655455   ABATLAS1       1048          NA            NA      20350</span>
<span class="co">## 5 225665275   ABATLAS1       1048          NA            NA      20350</span>
<span class="co">## 6 225671997   ABATLAS1       1048          NA            NA      20350</span>
<span class="co">##   statprov_code country_code SiteCode latitude longitude bcr subnational2_code</span>
<span class="co">## 1            AB           CA     1547 56.17056 -117.5639   6          CA.AB.19</span>
<span class="co">## 2            AB           CA     1548 56.26028 -117.5650   6          CA.AB.17</span>
<span class="co">## 3            AB           CA     2991 51.29972 -114.9200   6          CA.AB.15</span>
<span class="co">## 4            AB           CA     4156 50.03028 -113.5828  11          CA.AB.03</span>
<span class="co">## 5            AB           CA     5307 49.87333 -112.1828  11          CA.AB.02</span>
<span class="co">## 6            AB           CA     1536 56.07972 -117.7228   6          CA.AB.19</span>
<span class="co">##   iba_site utm_square survey_year survey_month survey_week survey_day</span>
<span class="co">## 1      N/A    11UMC62        1990            5           2         12</span>
<span class="co">## 2      N/A    11UMC63        1991            5           2         12</span>
<span class="co">## 3      N/A    11UPS48        1988            6           2         10</span>
<span class="co">## 4      N/A    12UUA14        1990            8           2          9</span>
<span class="co">## 5      N/A    12UVA12        1989            1           1          1</span>
<span class="co">## 6      N/A    11UMC51        1990           NA          NA         NA</span>
<span class="co">##   breeding_rank                GlobalUniqueIdentifier CatalogNumber Locality</span>
<span class="co">## 1            10 URN:NatureAlberta:ABATLAS1:I4063-HOFI    I4063-HOFI  11UMN62</span>
<span class="co">## 2            10 URN:NatureAlberta:ABATLAS1:I5194-HOFI    I5194-HOFI  11UMN63</span>
<span class="co">## 3            10 URN:NatureAlberta:ABATLAS1:C2013-HOFI    C2013-HOFI  11UPG48</span>
<span class="co">## 4             0 URN:NatureAlberta:ABATLAS1:A4101-HOFI    A4101-HOFI  12UUL14</span>
<span class="co">## 5             0 URN:NatureAlberta:ABATLAS1:B3021-HOFI    B3021-HOFI  12UVL12</span>
<span class="co">## 6            40 URN:NatureAlberta:ABATLAS1:I4060-HOFI    I4060-HOFI  11UMN51</span>
<span class="co">##   TimeCollected CollectorNumber FieldNumber Remarks ProjectCode</span>
<span class="co">## 1          &lt;NA&gt;            1960          NA    &lt;NA&gt;    ABATLAS1</span>
<span class="co">## 2          &lt;NA&gt;            1960          NA    &lt;NA&gt;    ABATLAS1</span>
<span class="co">## 3          &lt;NA&gt;            1317          NA    &lt;NA&gt;    ABATLAS1</span>
<span class="co">## 4          &lt;NA&gt;            1128          NA    &lt;NA&gt;    ABATLAS1</span>
<span class="co">## 5          &lt;NA&gt;            1250          NA    &lt;NA&gt;    ABATLAS1</span>
<span class="co">## 6          &lt;NA&gt;            1941          NA    &lt;NA&gt;    ABATLAS1</span>
<span class="co">##          ProtocolType ProtocolCode ProtocolURL SurveyAreaIdentifier</span>
<span class="co">## 1 Breeding Bird Atlas         &lt;NA&gt;        &lt;NA&gt;                 1547</span>
<span class="co">## 2 Breeding Bird Atlas         &lt;NA&gt;        &lt;NA&gt;                 1548</span>
<span class="co">## 3 Breeding Bird Atlas         &lt;NA&gt;        &lt;NA&gt;                 2991</span>
<span class="co">## 4 Breeding Bird Atlas         &lt;NA&gt;        &lt;NA&gt;                 4156</span>
<span class="co">## 5 Breeding Bird Atlas         &lt;NA&gt;        &lt;NA&gt;                 5307</span>
<span class="co">## 6 Breeding Bird Atlas         &lt;NA&gt;        &lt;NA&gt;                 1536</span>
<span class="co">##   SamplingEventIdentifier SamplingEventStructure RouteIdentifier</span>
<span class="co">## 1                   I4063                     NA            &lt;NA&gt;</span>
<span class="co">## 2                   I5194                     NA            &lt;NA&gt;</span>
<span class="co">## 3                   C2013                     NA            &lt;NA&gt;</span>
<span class="co">## 4                   A4101                     NA            &lt;NA&gt;</span>
<span class="co">## 5                   B3021                     NA            &lt;NA&gt;</span>
<span class="co">## 6                   I4060                     NA            &lt;NA&gt;</span>
<span class="co">##   TimeObservationsStarted TimeObservationsEnded DurationInHours</span>
<span class="co">## 1                    &lt;NA&gt;                  &lt;NA&gt;            &lt;NA&gt;</span>
<span class="co">## 2                    &lt;NA&gt;                  &lt;NA&gt;            &lt;NA&gt;</span>
<span class="co">## 3                    &lt;NA&gt;                  &lt;NA&gt;            &lt;NA&gt;</span>
<span class="co">## 4                    &lt;NA&gt;                  &lt;NA&gt;            &lt;NA&gt;</span>
<span class="co">## 5                    &lt;NA&gt;                  &lt;NA&gt;            &lt;NA&gt;</span>
<span class="co">## 6                    &lt;NA&gt;                  &lt;NA&gt;            &lt;NA&gt;</span>
<span class="co">##   TimeIntervalStarted TimeIntervalEnded TimeIntervalsAdditive NumberOfObservers</span>
<span class="co">## 1                  NA                NA                    NA                 0</span>
<span class="co">## 2                  NA                NA                    NA                 0</span>
<span class="co">## 3                  NA                NA                    NA                 1</span>
<span class="co">## 4                  NA                NA                    NA                 0</span>
<span class="co">## 5                  NA                NA                    NA                 0</span>
<span class="co">## 6                  NA                NA                    NA                 0</span>
<span class="co">##   NoObservations ObservationCount ObservationDescriptor ObservationCount2</span>
<span class="co">## 1             NA             &lt;NA&gt;                  &lt;NA&gt;              &lt;NA&gt;</span>
<span class="co">## 2             NA             &lt;NA&gt;                  &lt;NA&gt;              &lt;NA&gt;</span>
<span class="co">## 3             NA             &lt;NA&gt;                  &lt;NA&gt;              &lt;NA&gt;</span>
<span class="co">## 4             NA             &lt;NA&gt;                  &lt;NA&gt;              &lt;NA&gt;</span>
<span class="co">## 5             NA             &lt;NA&gt;                  &lt;NA&gt;              &lt;NA&gt;</span>
<span class="co">## 6             NA             &lt;NA&gt;                  &lt;NA&gt;              &lt;NA&gt;</span>
<span class="co">##   ObservationDescriptor2 ObservationCount3 ObservationDescriptor3</span>
<span class="co">## 1                   &lt;NA&gt;              &lt;NA&gt;                   &lt;NA&gt;</span>
<span class="co">## 2                   &lt;NA&gt;              &lt;NA&gt;                   &lt;NA&gt;</span>
<span class="co">## 3                   &lt;NA&gt;              &lt;NA&gt;                   &lt;NA&gt;</span>
<span class="co">## 4                   &lt;NA&gt;              &lt;NA&gt;                   &lt;NA&gt;</span>
<span class="co">## 5                   &lt;NA&gt;              &lt;NA&gt;                   &lt;NA&gt;</span>
<span class="co">## 6                   &lt;NA&gt;              &lt;NA&gt;                   &lt;NA&gt;</span>
<span class="co">##   ObservationCount4 ObservationDescriptor4 ObservationCount5</span>
<span class="co">## 1              &lt;NA&gt;                   &lt;NA&gt;              &lt;NA&gt;</span>
<span class="co">## 2              &lt;NA&gt;                   &lt;NA&gt;              &lt;NA&gt;</span>
<span class="co">## 3              &lt;NA&gt;                   &lt;NA&gt;              &lt;NA&gt;</span>
<span class="co">## 4              &lt;NA&gt;                   &lt;NA&gt;              &lt;NA&gt;</span>
<span class="co">## 5              &lt;NA&gt;                   &lt;NA&gt;              &lt;NA&gt;</span>
<span class="co">## 6              &lt;NA&gt;                   &lt;NA&gt;              &lt;NA&gt;</span>
<span class="co">##   ObservationDescriptor5 ObservationCount6 ObservationDescriptor6</span>
<span class="co">## 1                   &lt;NA&gt;              &lt;NA&gt;                   &lt;NA&gt;</span>
<span class="co">## 2                   &lt;NA&gt;              &lt;NA&gt;                   &lt;NA&gt;</span>
<span class="co">## 3                   &lt;NA&gt;              &lt;NA&gt;                   &lt;NA&gt;</span>
<span class="co">## 4                   &lt;NA&gt;              &lt;NA&gt;                   &lt;NA&gt;</span>
<span class="co">## 5                   &lt;NA&gt;              &lt;NA&gt;                   &lt;NA&gt;</span>
<span class="co">## 6                   &lt;NA&gt;              &lt;NA&gt;                   &lt;NA&gt;</span>
<span class="co">##   AllIndividualsReported AllSpeciesReported</span>
<span class="co">## 1                   &lt;NA&gt;            Unknown</span>
<span class="co">## 2                   &lt;NA&gt;            Unknown</span>
<span class="co">## 3                   &lt;NA&gt;            Unknown</span>
<span class="co">## 4                   &lt;NA&gt;            Unknown</span>
<span class="co">## 5                   &lt;NA&gt;            Unknown</span>
<span class="co">## 6                   &lt;NA&gt;            Unknown</span></code></pre>
</div>
<div class="section level2">
<h2 id="simple-maps">Simple Maps<a class="anchor" aria-label="anchor" href="#simple-maps"></a>
</h2>
<p>The quickest way to look at the spatial distribution is probably to use Stamen maps through the <code>ggmap</code> package.</p>
<p>First let’s get an idea of how many distinct points there are (often multiple observations are recorded for the same location).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">house_finches</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 6376</span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">house_finches</span>, <span class="va">longitude</span>, <span class="va">latitude</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 509</span></code></pre>
<p>So we have 509 sites for 6376 observations.</p>
<p>Next let’s convert our data to spatial data so we can extract the spatial extent. Note that we’re using CRS EPSG code of 4326 because that’s reflects unprojected, GPS data in lat/lon. First we omit <code>NA</code>s.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">house_finches</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html" class="external-link">drop_na</a></span><span class="op">(</span><span class="va">house_finches</span>, <span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>
<span class="va">house_finches_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">house_finches</span>, 
                             coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></code></pre></div>
<p>We can extract the spatial extent (<strong>b</strong>ounding <strong>box</strong>) with the <code><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox()</a></code> function.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">house_finches_sf</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##       xmin       ymin       xmax       ymax </span>
<span class="co">## -118.80042   49.12844 -110.07241   56.73562</span></code></pre>
<p>Now we’re ready to make a map of the distribution of observations. First we get the baselayer map.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/get_stamenmap.html" class="external-link">get_stamenmap</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">house_finches_sf</span><span class="op">)</span><span class="op">)</span>, zoom <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Source : http://tile.stamen.com/terrain/5/5/9.png</span></code></pre>
<pre><code><span class="co">## Source : http://tile.stamen.com/terrain/5/6/9.png</span></code></pre>
<pre><code><span class="co">## Source : http://tile.stamen.com/terrain/5/5/10.png</span></code></pre>
<pre><code><span class="co">## Source : http://tile.stamen.com/terrain/5/6/10.png</span></code></pre>
<p>Now we can add our observations. Note that for <code>ggmap</code>, we’ll use non-sf data frame.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html" class="external-link">ggmap</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">house_finches</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="mapping-observations_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Let’s count our observations for each site.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html" class="external-link">ggmap</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_count.html" class="external-link">geom_count</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">house_finches</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="mapping-observations_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="interactive-maps">Interactive Maps<a class="anchor" aria-label="anchor" href="#interactive-maps"></a>
</h2>
<p>If we want to get fancy we can also create interactive maps using the <code>mapview</code> packages (see also the <a href="https://rstudio.github.io/leaflet/" class="external-link"><code>leaflet</code> for R package</a>).</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/mapview/man/mapView.html" class="external-link">mapview</a></span><span class="op">(</span><span class="va">house_finches_sf</span>, zcol <span class="op">=</span> <span class="st">"survey_year"</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1965</span>, <span class="fl">2005</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
        map.types <span class="op">=</span> <span class="st">"Esri.WorldImagery"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="more-complex-maps">More Complex Maps<a class="anchor" aria-label="anchor" href="#more-complex-maps"></a>
</h2>
<p>For more complex, or detailed maps, we can use a variety of spatial data files to layer our data over maps of the area.</p>
<p>For this we’ll get some outlines of Canada and it’s Provinces and Territories from <code>rnaturalearth</code>.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">canada</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rnaturalearth/man/ne_states.html" class="external-link">ne_states</a></span><span class="op">(</span>country <span class="op">=</span> <span class="st">"canada"</span>, returnclass <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">3347</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">canada</span><span class="op">)</span></code></pre></div>
<p><img src="mapping-observations_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Let’s add our observations (note that the data are transformed to match the projection of the first layer, here the <code>canada</code> data).</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">canada</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">house_finches_sf</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p><img src="mapping-observations_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>We can also focus on Alberta</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">canada</span>, <span class="va">name</span> <span class="op">==</span> <span class="st">"Alberta"</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">house_finches_sf</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p><img src="mapping-observations_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>Perhaps we should see how many of these observations were made in parks.</p>
<p>First we’ll download and extract the Park shapefiles available from the <a href="https://www.albertaparks.ca/albertaparksca/library/downloadable-data-sets/" class="external-link">Alberta Parks</a> website.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://www.albertaparks.ca/media/2941843/parks_and_protected_areas_alberta.zip"</span>
<span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">url</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="st">"parks_and_protected_areas_alberta.zip"</span><span class="op">)</span>

<span class="va">parks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="st">"Parks_Protected_Areas_Alberta.shp"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Reading layer `Parks_Protected_Areas_Alberta' from data source </span>
<span class="co">##   `/home/steffi/Projects/Business/Bird Studies/NatureCounts/naturecounts/vignettes/articles/article_files/Parks_Protected_Areas_Alberta.shp' </span>
<span class="co">##   using driver `ESRI Shapefile'</span>
<span class="co">## Simple feature collection with 477 features and 18 fields</span>
<span class="co">## Geometry type: MULTIPOLYGON</span>
<span class="co">## Dimension:     XY</span>
<span class="co">## Bounding box:  xmin: 170844.3 ymin: 5425575 xmax: 860845.9 ymax: 6659216</span>
<span class="co">## Projected CRS: NAD83 / Alberta 10-TM (Forest)</span></code></pre>
<p>Add this layer to our plot.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">parks</span>, colour <span class="op">=</span> <span class="st">"darkgreen"</span>, fill <span class="op">=</span> <span class="st">"forestgreen"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">house_finches_sf</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p><img src="mapping-observations_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<p>Well it’s actually a bit difficult to tell, there are lots of small parks!</p>
<p>To solve this problem, we can merge our observations with the parks and plot those inside parks separately from those outside parks.</p>
<p>First we’ll transform our observation data to match the CRS of <code>parks</code>, then we’ll join the park information to our observations, based on whether the observations overlap a park polygon (by default this is a left join), and finally we’ll create a new column <code>outside_park</code> that is a category for out or in the park, based on whether the observation was joined to a park name (<code>OC_NAME</code>).</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">house_finches_sf</span> <span class="op">&lt;-</span> <span class="va">house_finches_sf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">parks</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_join</a></span><span class="op">(</span><span class="va">parks</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>outside_park <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">OC_NAME</span><span class="op">)</span>, <span class="st">"Outside Park"</span>, <span class="st">"Inside Park"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>And now we can see that there are quite a few, if not more, observations outside of parks than in.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">parks</span>, colour <span class="op">=</span> <span class="st">"darkgreen"</span>, fill <span class="op">=</span> <span class="st">"forestgreen"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">house_finches_sf</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">outside_park</span><span class="op">)</span></code></pre></div>
<p><img src="mapping-observations_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>We might also be interested in observations over time.</p>
<p>First we’ll bin our yearly observations</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">house_finches_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">house_finches_sf</span>, 
                           years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">survey_year</span>, 
                                       breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1960</span>, <span class="fl">2010</span>, <span class="fl">10</span><span class="op">)</span>, 
                                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1960</span>, <span class="fl">2000</span>, <span class="fl">10</span><span class="op">)</span>, right <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We’ll also want to see how many sample years there are per decade.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">years</span> <span class="op">&lt;-</span> <span class="va">house_finches_sf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">years</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">survey_year</span><span class="op">)</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></code></pre></div>
<p>Now we can see how House Finch observations change over the years</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ab</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">parks</span>, colour <span class="op">=</span> <span class="st">"darkgreen"</span>, fill <span class="op">=</span> <span class="st">"forestgreen"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">house_finches_sf</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf_text</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">years</span>, x <span class="op">=</span> <span class="fl">4427134</span>, y <span class="op">=</span> <span class="fl">2965275</span>, hjust <span class="op">=</span> <span class="fl">0</span>, vjust <span class="op">=</span> <span class="fl">1</span>, 
               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"n = "</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">years</span><span class="op">)</span></code></pre></div>
<p><img src="mapping-observations_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="presenceabsence">Presence/Absence<a class="anchor" aria-label="anchor" href="#presenceabsence"></a>
</h2>
<p>We can also use some of the <code>naturecounts</code> helper functions to create presence/absence maps.</p>
<p>Here we download data from the <code>RCBIOTABASE</code> collection, make sure to keep only observations where all species and the location were reported, create a new <code>presence</code> column which is either TRUE, FALSE, or NA for each sampling event. Finally we use the <code><a href="../reference/format_zero_fill.html">format_zero_fill()</a></code> function to fill in sampling events where cardinals (<code>species_id</code> 19360) were not detected (presence would then be 0).</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cardinals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nc_data_dl.html">nc_data_dl</a></span><span class="op">(</span>collection <span class="op">=</span> <span class="st">"RCBIOTABASE"</span>, username <span class="op">=</span> <span class="st">"testuser"</span>, 
                        info <span class="op">=</span> <span class="st">"nc_tutorial"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Using filters: collections (RCBIOTABASE); fields_set (BMDE2.00-min)</span></code></pre>
<pre><code><span class="co">## Collecting available records...</span></code></pre>
<pre><code><span class="co">##    collection nrecords</span>
<span class="co">## 1 RCBIOTABASE    12811</span>
<span class="co">## Total records: 12,811</span></code></pre>
<pre><code><span class="co">## </span>
<span class="co">## Downloading records for each collection:</span></code></pre>
<pre><code><span class="co">##   RCBIOTABASE</span></code></pre>
<pre><code><span class="co">##     Records 1 to 5000 / 12811</span></code></pre>
<pre><code><span class="co">##     Records 5001 to 10000 / 12811</span></code></pre>
<pre><code><span class="co">##     Records 10001 to 12811 / 12811</span></code></pre>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cardinals_zf</span> <span class="op">&lt;-</span> <span class="va">cardinals</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">AllSpeciesReported</span> <span class="op">==</span> <span class="st">"Yes"</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">latitude</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">longitude</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">species_id</span>, <span class="va">AllSpeciesReported</span>, <span class="va">SamplingEventIdentifier</span>, <span class="va">latitude</span>, <span class="va">longitude</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>presence <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">ObservationCount</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/format_zero_fill.html">format_zero_fill</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fl">19360</span>,
                   by <span class="op">=</span> <span class="st">"SamplingEventIdentifier"</span>,
                   extra_event <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"latitude"</span>, <span class="st">"longitude"</span><span class="op">)</span>,
                   fill <span class="op">=</span> <span class="st">"presence"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  - Converted 'fill' column (presence) from logical to numeric</span></code></pre>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cardinals_zf</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##   SamplingEventIdentifier species_id presence latitude longitude</span>
<span class="co">## 1     RCBIOTABASE-10000-1      19360        0 45.58604 -77.48721</span>
<span class="co">## 2     RCBIOTABASE-10001-1      19360        0 45.51110 -77.50533</span>
<span class="co">## 3     RCBIOTABASE-10002-1      19360        0 45.50803 -77.50786</span>
<span class="co">## 4     RCBIOTABASE-10003-1      19360        0 45.51110 -77.50533</span>
<span class="co">## 5     RCBIOTABASE-10004-1      19360        0 45.51110 -77.50533</span>
<span class="co">## 6     RCBIOTABASE-10005-1      19360        0 45.51110 -77.50533</span></code></pre>
<p>Now that we have our presence/absence data for cardinals, we can create a map.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">cardinals_zf</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/get_stamenmap.html" class="external-link">get_stamenmap</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="va">.</span>, zoom <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Source : http://tile.stamen.com/terrain/8/72/90.png</span></code></pre>
<pre><code><span class="co">## Source : http://tile.stamen.com/terrain/8/73/90.png</span></code></pre>
<pre><code><span class="co">## Source : http://tile.stamen.com/terrain/8/72/91.png</span></code></pre>
<pre><code><span class="co">## Source : http://tile.stamen.com/terrain/8/73/91.png</span></code></pre>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html" class="external-link">ggmap</a></span><span class="op">(</span><span class="va">map</span>, base_layer <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cardinals_zf</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_count.html" class="external-link">geom_count</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.75</span>,
             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span>, colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">presence</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Presence/Absence"</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yellow"</span>, <span class="st">"purple"</span><span class="op">)</span>, 
                      labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span> <span class="op">=</span> <span class="st">"Present"</span>, <span class="st">"0"</span> <span class="op">=</span> <span class="st">"Absent"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_continuous</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Number of Sampling Events"</span>, range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Presence/Absence of Cardinals in the RCBIOTABASE collection"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="mapping-observations_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="see-also">See Also<a class="anchor" aria-label="anchor" href="#see-also"></a>
</h2>
<ul>
<li><a href="region-spatial.html">Using spatial data to filter observations</a></li>
<li><a href="../region-areas.html">Exploring regional filters</a></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Steffi LaZerte, Denis LePage.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
